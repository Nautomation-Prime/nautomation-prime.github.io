
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Production-ready Python script for automated Day 0 provisioning of Cisco Catalyst switches with serial-based configuration, structured logging, and enterprise-grade reliability.">
      
      
        <meta name="author" content="Christopher Davies">
      
      
        <link rel="canonical" href="https://nautomation-prime.github.io/coming-soon/Cisco%20IOS-XE%20Zero%20Touch%20Provisioning/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../IOS-XE%20Software%20Upgrade%20Orchestrator/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Cisco IOS-XE Zero Touch Provisioning (ZTP) - Nautomation Prime</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cisco-ios-xe-zero-touch-provisioning-ztp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nautomation Prime" class="md-header__button md-logo" aria-label="Nautomation Prime" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nautomation Prime
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cisco IOS-XE Zero Touch Provisioning (ZTP)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Nautomation-Prime/Nautomation-Prime.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../services/" class="md-tabs__link">
        
  
  
    
  
  Services

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../deep-dives/" class="md-tabs__link">
          
  
  
    
  
  Technical Resources

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../scripts/" class="md-tabs__link">
        
  
  
    
  
  Script Library

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Coming Soon

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../legal/privacy-policy/" class="md-tabs__link">
          
  
  
    
  
  Legal

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nautomation Prime" class="md-nav__button md-logo" aria-label="Nautomation Prime" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Nautomation Prime
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Nautomation-Prime/Nautomation-Prime.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../deep-dives/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Technical Resources
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Technical Resources
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dives/cdp-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CDP Network Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deep-dives/access-switch-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Switch Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Script Library
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Coming Soon
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Coming Soon
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Cisco IOS-XE Zero Touch Provisioning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Cisco IOS-XE Zero Touch Provisioning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-zero-touch-provisioning-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Zero Touch Provisioning Matters
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why Zero Touch Provisioning Matters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-day-0-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Day 0 Challenge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#business-impact" class="md-nav__link">
    <span class="md-ellipsis">
      
        Business Impact
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-workflow-stages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detailed Workflow Stages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Workflow Stages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage-0-pre-execution-automatic-cisco-native-ztp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 0: Pre-Execution (Automatic - Cisco Native ZTP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-1-device-identification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 1: Device Identification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-2-configuration-download-with-retry-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 2: Configuration Download with Retry Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-3-configuration-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 3: Configuration Application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-4-ssh-key-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 4: SSH Key Generation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-5-save-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 5: Save Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stage-6-optional-reporting-and-telemetry" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stage 6: Optional Reporting and Telemetry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Infrastructure Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-server-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        DHCP Server Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DHCP Server Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isc-dhcp-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        ISC DHCP (Linux)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-dhcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows DHCP Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cisco-iosios-xe-dhcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cisco IOS/IOS-XE DHCP Server
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-server-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Server Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Server Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-apache-ubuntudebian" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option A: Apache (Ubuntu/Debian)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-nginx-ubuntudebian" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option B: Nginx (Ubuntu/Debian)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-c-python-simplehttpserver-testing-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option C: Python SimpleHTTPServer (Testing Only)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysloggraylog-configuration-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Syslog/Graylog Configuration (Optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration File Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration File Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filename-convention-critical" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filename Convention (Critical)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-file-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration File Template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-config-files-at-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generating Config Files at Scale
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script Configuration Options
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Script Configuration Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-server-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Server Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Policy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Persistence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysloggraylog-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Syslog/Graylog Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Device Reporting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment-one-time-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Deployment (One-Time Setup)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-device-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Device Deployment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-guide" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Guide
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Issues and Solutions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Issues and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-ztp-doesnt-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 1: ZTP Doesn't Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-http-404-error-config-file-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 2: HTTP 404 Error (Config File Not Found)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-network-timeout-retry-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 3: Network Timeout / Retry Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-4-configuration-syntax-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 4: Configuration Syntax Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-5-ssh-connection-refused-post-ztp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 5: SSH Connection Refused Post-ZTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-6-config-not-saved-re-ztp-on-reboot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 6: Config Not Saved (Re-ZTP on Reboot)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threat-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Threat Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-isolated-management-vlan" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Use Isolated Management VLAN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-enable-dhcp-snooping" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Enable DHCP Snooping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-restrict-http-server-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Restrict HTTP Server Access
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-disable-ztp-after-provisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Disable ZTP After Provisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-secure-credential-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Secure Credential Storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-audit-trail-and-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Audit Trail and Compliance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Topics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-platform-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Platform Support
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stackwise-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        StackWise Considerations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-support-custom-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTPS Support (Custom Implementation)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-netboxipam" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with NetBox/IPAM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-native-ztp-vs-manual-provisioning-vs-pnp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comparison: Native ZTP vs. Manual Provisioning vs. PnP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comparison: Native ZTP vs. Manual Provisioning vs. PnP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-comparison-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feature Comparison Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-each-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Each Approach
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-lessons-learned" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices and Lessons Learned
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices and Lessons Learned">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operational-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operational Considerations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Benchmarks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-execution-times-catalyst-9300" class="md-nav__link">
    <span class="md-ellipsis">
      
        Typical Execution Times (Catalyst 9300)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalability-testing-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability Testing Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements (Roadmap)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-decision-tree" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Decision Tree
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support-and-contributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Support and Contributions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IOS-XE%20Software%20Upgrade%20Orchestrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IOS-XE Upgrade Orchestrator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Legal
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Legal
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/privacy-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Privacy Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/terms-of-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terms of Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/licensing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Licensing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/disclaimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disclaimer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/brand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Brand & Logo Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
      
        <span class="md-tag">Automation</span>
      
    
      
      
      
      
        <span class="md-tag">Catalyst</span>
      
    
      
      
      
      
        <span class="md-tag">Day 0</span>
      
    
      
      
      
      
        <span class="md-tag">IOS-XE</span>
      
    
      
      
      
      
        <span class="md-tag">Python</span>
      
    
      
      
      
      
        <span class="md-tag">ZTP</span>
      
    
      
      
      
      
        <span class="md-tag">Zero Touch Provisioning</span>
      
    
  </nav>


  
  


<h1 id="cisco-ios-xe-zero-touch-provisioning-ztp">Cisco IOS-XE Zero Touch Provisioning (ZTP)<a class="headerlink" href="#cisco-ios-xe-zero-touch-provisioning-ztp" title="Anchor link to this section">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Project Status</p>
<p><strong>Current Phase:</strong> <img alt="ðŸ§ª" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f9ea.svg" title=":test_tube:" /> <strong>Testing &amp; Validation</strong></p>
<p>This script is production-ready and currently undergoing comprehensive testing across multiple Catalyst platforms and deployment scenarios. Core functionality is complete with structured logging, retry logic, and enterprise-grade error handling.</p>
</div>
<hr />
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Anchor link to this section">&para;</a></h2>
<p>A production-ready ZTP script for <strong>Day 0</strong> provisioning of Cisco Catalyst switches running IOS-XE. Automatically downloads and applies device-specific configurations when switches boot without a startup-config, enabling <strong>hands-free</strong> deployment at scale.</p>
<p><strong>Key Differentiators:</strong></p>
<ul>
<li><strong>Serial-based configuration lookup</strong> â€” Each device fetches its own config (<code>&lt;SERIAL&gt;.cfg</code>) from HTTP server</li>
<li><strong>Retry logic with exponential backoff</strong> â€” Handles transient network issues gracefully (3 attempts)</li>
<li><strong>Structured JSON logging to Graylog/Syslog</strong> â€” Real-time ZTP monitoring with searchable device context</li>
<li><strong>Automatic SSH key generation</strong> â€” Enables secure remote access immediately post-provisioning</li>
<li><strong>Rotating file logs on flash</strong> â€” Persistent debugging (5MB max, 2 backups)</li>
<li><strong>Secure file cleanup</strong> â€” Removes sensitive config files after merging to running-config</li>
<li><strong>JSON device reports</strong> â€” Optional inventory data export for automation pipelines</li>
</ul>
<hr />
<h2 id="why-zero-touch-provisioning-matters">Why Zero Touch Provisioning Matters<a class="headerlink" href="#why-zero-touch-provisioning-matters" title="Anchor link to this section">&para;</a></h2>
<h3 id="the-day-0-challenge">The Day 0 Challenge<a class="headerlink" href="#the-day-0-challenge" title="Anchor link to this section">&para;</a></h3>
<p>Traditional Cisco switch deployment requires manual intervention:</p>
<ol>
<li><strong>Console Access</strong> â€” Physical connection to configure initial management IP</li>
<li><strong>Manual Configuration</strong> â€” Type (or paste) base config via console</li>
<li><strong>Error-Prone</strong> â€” Human typing errors, inconsistent configurations</li>
<li><strong>Time-Consuming</strong> â€” 15-30 minutes per switch for experienced engineers</li>
<li><strong>Scalability Bottleneck</strong> â€” 100 new switches = 25-50 hours of manual labor</li>
</ol>
<p><strong>ZTP Solution:</strong> Switch powers on â†’ DHCP provides IP + script URL â†’ Script downloads device-specific config â†’ Device is production-ready in ~90 seconds.</p>
<h3 id="business-impact">Business Impact<a class="headerlink" href="#business-impact" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Manual Provisioning</th>
<th>ZTP Automation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time per device</td>
<td>15-30 minutes</td>
<td>60-90 seconds</td>
</tr>
<tr>
<td>Error rate</td>
<td>5-10% (typos, omissions)</td>
<td>&lt;0.1% (config file validated beforehand)</td>
</tr>
<tr>
<td>100-device deployment</td>
<td>25-50 hours</td>
<td>2.5 hours (mostly hands-off)</td>
</tr>
<tr>
<td>Skill level required</td>
<td>Senior engineer</td>
<td>Junior tech (power + cable)</td>
</tr>
<tr>
<td>Audit trail</td>
<td>Manual notes, inconsistent</td>
<td>Structured logs in Graylog, searchable</td>
</tr>
</tbody>
</table>
<div class="admonition success">
<p class="admonition-title">ROI Example</p>
<p>A 1,000-switch campus refresh project:</p>
<ul>
<li><strong>Manual:</strong> 250-500 hours @ Â£60/hour = Â£15,000-Â£30,000 labour cost</li>
<li><strong>ZTP:</strong> 25 hours setup + validation + 25 hours oversight = Â£3,000 labour cost</li>
<li><strong>Savings:</strong> Â£12,000-Â£27,000 + reduced error remediation costs</li>
<li><strong>Payback:</strong> Immediate (first-use ROI)</li>
</ul>
</div>
<hr />
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Anchor link to this section">&para;</a></h2>
<h3 id="high-level-workflow">High-Level Workflow<a class="headerlink" href="#high-level-workflow" title="Anchor link to this section">&para;</a></h3>
<pre class="mermaid"><code>graph TD
    A[Switch Powers On&lt;br/&gt;No Startup-Config] --&gt; B[DHCP Request]
    B --&gt; C[DHCP Server]
    C --&gt; D[IP Address + Option 67&lt;br/&gt;ZTP Script URL]
    D --&gt; E[Native ZTP Agent]
    E --&gt; F[Download Python Script&lt;br/&gt;from HTTP Server]
    F --&gt; G[Execute in Guestshell]
    G --&gt; H[Extract Serial Number]
    H --&gt; I[Download SERIAL.cfg&lt;br/&gt;from HTTP Server]
    I --&gt; J{File Transfer&lt;br/&gt;Successful?}
    J --&gt;|No| K[Retry with Backoff&lt;br/&gt;Up to 3 Attempts]
    K --&gt; J
    J --&gt;|Yes| L[Merge Config to&lt;br/&gt;Running-Config]
    L --&gt; M[Generate SSH Keys]
    M --&gt; N[Save to Startup-Config]
    N --&gt; O[Production Ready]
    J --&gt;|Failure After 3 Retries| P[Log Error + Exit]</code></pre>
<h3 id="component-architecture">Component Architecture<a class="headerlink" href="#component-architecture" title="Anchor link to this section">&para;</a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph Infrastructure["Infrastructure Components"]
        DHCP[DHCP Server&lt;br/&gt;Options 66/67]
        HTTP[HTTP Server&lt;br/&gt;Apache/Nginx]
        SYSLOG[Syslog/Graylog&lt;br/&gt;Optional]
    end

    subgraph Switch["Catalyst Switch"]
        ZTP[Native ZTP Agent]
        GS[Guestshell Environment]
        SCRIPT[day_0_provisioning.py]
        FLASH[Flash Storage]
    end

    subgraph HTTPServer["HTTP Server Structure"]
        SCRIPTDIR[scripts directory&lt;br/&gt;day_0_provisioning.py]
        FILESDIR[files directory&lt;br/&gt;SERIAL.cfg files]
    end

    DHCP --&gt;|IP + Script URL| ZTP
    ZTP --&gt;|Download Script| HTTP
    HTTP --&gt; SCRIPTDIR
    SCRIPTDIR --&gt; GS
    GS --&gt; SCRIPT
    SCRIPT --&gt;|Download Config| FILESDIR
    FILESDIR --&gt; FLASH
    SCRIPT --&gt;|JSON Logs| SYSLOG

    style Infrastructure fill:#fff4e6
    style Switch fill:#e1f5ff
    style HTTPServer fill:#f3e5f5</code></pre>
<hr />
<h2 id="detailed-workflow-stages">Detailed Workflow Stages<a class="headerlink" href="#detailed-workflow-stages" title="Anchor link to this section">&para;</a></h2>
<h3 id="stage-0-pre-execution-automatic-cisco-native-ztp">Stage 0: Pre-Execution (Automatic - Cisco Native ZTP)<a class="headerlink" href="#stage-0-pre-execution-automatic-cisco-native-ztp" title="Anchor link to this section">&para;</a></h3>
<p>Cisco IOS-XE devices include a built-in ZTP agent that activates automatically when:</p>
<ol>
<li>Switch boots without a <code>startup-config</code> file</li>
<li>No manual console interaction occurs during bootup timer (default 5 minutes)</li>
</ol>
<p><strong>ZTP Agent Behavior:</strong></p>
<ul>
<li>Sends DHCP request with vendor-specific options</li>
<li>Looks for <strong>DHCP Option 67</strong> (Boot File Name) containing HTTP URL</li>
<li>Downloads script from URL (typically <code>.py</code> or <code>.cfg</code> file)</li>
<li>For Python scripts: Activates Guestshell and executes script</li>
<li>For config files: Applies directly to running-config</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Why We Use Python Scripts vs. Config Files</p>
<p><strong>Direct Config File (Option 1):</strong> DHCP Option 67 points to <code>.cfg</code> file, ZTP applies it directly.</p>
<ul>
<li><strong>Limitation:</strong> All devices get the same file. Not suitable for device-specific configs.</li>
</ul>
<p><strong>Python Script (Option 2 - Our Approach):</strong> DHCP Option 67 points to Python script, script determines device identity and fetches appropriate config.</p>
<ul>
<li><strong>Advantage:</strong> Each device can fetch a unique configuration based on serial number, hostname, or other attributes.</li>
<li><strong>Flexibility:</strong> Pre-checks, validation, logging, error handling, post-config actions (SSH keys, save config, etc.)</li>
</ul>
</div>
<h3 id="stage-1-device-identification">Stage 1: Device Identification<a class="headerlink" href="#stage-1-device-identification" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Script queries device facts using IOS-XE Python &#39;cli&#39; module</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>              <span class="c1"># Extract model (C9300-48U, etc.)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">serial</span> <span class="o">=</span> <span class="n">get_serial</span><span class="p">()</span>            <span class="c1"># Extract serial number</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="n">version</span> <span class="o">=</span> <span class="n">get_version</span><span class="p">()</span>          <span class="c1"># Extract IOS-XE version</span>
</code></pre></div></td></tr></table></div>
<p><strong>Key Operations:</strong></p>
<ul>
<li>Execute <code>show version</code> command via Guestshell <code>cli()</code> function</li>
<li>Parse output using regex to extract:<ul>
<li><strong>Model Number:</strong> <code>C9300-48U</code>, <code>C9200-24P</code>, <code>C9400</code>, etc.</li>
<li><strong>Serial Number:</strong> <code>FCW2144L045</code> (used as configuration filename)</li>
<li><strong>IOS-XE Version:</strong> <code>17.3.1</code>, <code>17.6.4</code>, etc.</li>
</ul>
</li>
</ul>
<p><strong>Logging Initialization:</strong></p>
<ul>
<li>Create rotating log file on flash: <code>/flash/guest-share/ztp.log</code></li>
<li>Configure JSON formatter for syslog (if enabled)</li>
<li>Add device context to every log message (serial, model, session ID)</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Serial Number is Critical</p>
<p>The serial number must exactly match the configuration filename on the HTTP server. Mismatches cause HTTP 404 errors and ZTP failure.</p>
<p><strong>Verification Command:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>Switch# show version | include Serial
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>System Serial Number : FCW2144L045
</code></pre></div></td></tr></table></div></p>
<p><strong>HTTP Server File:</strong> <code>FCW2144L045.cfg</code> (exact match required)</p>
</div>
<h3 id="stage-2-configuration-download-with-retry-logic">Stage 2: Configuration Download with Retry Logic<a class="headerlink" href="#stage-2-configuration-download-with-retry-logic" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">config_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">.cfg&quot;</span>  <span class="c1"># Build filename</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">file_transfer_with_retry</span><span class="p">(</span><span class="n">HTTP_SERVER</span><span class="p">,</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Retry Schedule (Exponential Backoff):</strong></p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Delay Before Attempt</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Immediate</td>
<td>First try</td>
</tr>
<tr>
<td>2</td>
<td>2 seconds</td>
<td>Base backoff</td>
</tr>
<tr>
<td>3</td>
<td>4 seconds</td>
<td>2x base backoff</td>
</tr>
</tbody>
</table>
<p><strong>Why Retry Logic Matters:</strong></p>
<ul>
<li><strong>Network Transients:</strong> Spanning tree convergence, switch uplink negotiation</li>
<li><strong>HTTP Server Load:</strong> Concurrent requests from multiple switches during mass deployment</li>
<li><strong>DHCP Timing:</strong> IP address acquisition may still be stabilizing</li>
</ul>
<p><strong>Verification After Each Attempt:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Don&#39;t just trust the copy command - verify file exists</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">if</span> <span class="n">check_file_exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="n">log_and_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&#39; successfully downloaded and verified.&quot;</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
<div class="admonition danger">
<p class="admonition-title">Common Failure: Network Not Ready</p>
<p>During mass deployments (100+ switches powered on simultaneously), early ZTP attempts may fail due to:</p>
<ul>
<li><strong>Spanning tree convergence</strong> â€” Uplink not forwarding yet (30-50 seconds)</li>
<li><strong>Port-channel negotiation</strong> â€” LACP bundle not formed (10-30 seconds)</li>
<li><strong>DHCP exhaustion</strong> â€” Server overwhelmed, slow responses</li>
</ul>
<p><strong>Mitigation:</strong> Exponential backoff gives network time to stabilize. Consider staggered power-on in very large deployments.</p>
</div>
<h3 id="stage-3-configuration-application">Stage 3: Configuration Application<a class="headerlink" href="#stage-3-configuration-application" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">configure_merge</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>     <span class="c1"># Merge config to running-config</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">secure_delete</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>       <span class="c1"># Remove temporary file for security</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">hostname</span> <span class="o">=</span> <span class="n">get_hostname</span><span class="p">()</span>        <span class="c1"># Extract configured hostname for logging</span>
</code></pre></div></td></tr></table></div>
<p><strong>Configuration Merge Process:</strong></p>
<ol>
<li>Execute <code>copy flash:SERIAL.cfg running-config</code></li>
<li>IOS-XE merges configuration (additive operation)</li>
<li>Validate merge success by querying hostname from running-config</li>
<li>Delete configuration file from flash (security best practice)</li>
</ol>
<p><strong>Why Delete Config Files?</strong></p>
<p>Configuration files contain sensitive data:</p>
<ul>
<li><strong>Local user passwords</strong> (even if hashed, still sensitive)</li>
<li><strong>SNMP community strings</strong></li>
<li><strong>TACACS+ / RADIUS shared secrets</strong></li>
<li><strong>VTY passwords</strong></li>
</ul>
<p>Leaving these files on flash creates a security risk. The <code>secure_delete()</code> function removes them immediately after applying.</p>
<div class="admonition tip">
<p class="admonition-title">Configuration File Best Practices</p>
<p><strong>Include in Config Files:</strong></p>
<ul>
<li>Hostname (for identification in logs)</li>
<li>Management VLAN and IP address</li>
<li>Default gateway</li>
<li>NTP servers</li>
<li>Syslog servers</li>
<li>AAA configuration (TACACS+ / RADIUS)</li>
<li>Local emergency admin account</li>
<li>SSH VTY access restrictions</li>
</ul>
<p><strong>Avoid in Config Files:</strong></p>
<ul>
<li>Port-specific configurations (unless known in advance)</li>
<li>Access-layer VLANs (typically managed post-ZTP via automation)</li>
<li>Complex QoS policies (deploy via templates later)</li>
</ul>
</div>
<h3 id="stage-4-ssh-key-generation">Stage 4: SSH Key Generation<a class="headerlink" href="#stage-4-ssh-key-generation" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">generate_crypto_keys</span><span class="p">()</span>  <span class="c1"># Create 2048-bit RSA keys</span>
</code></pre></div></td></tr></table></div>
<p><strong>Operation:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>crypto key generate rsa label ZTP_Key_General modulus 2048
</code></pre></div></td></tr></table></div>
<p><strong>Why This Matters:</strong></p>
<ul>
<li><strong>SSH Server Activation:</strong> IOS-XE doesn't enable SSH until crypto keys exist</li>
<li><strong>Immediate Remote Access:</strong> Network engineers can SSH to device as soon as ZTP completes</li>
<li><strong>Time Savings:</strong> Manual key generation takes 10-30 seconds per device (automated here)</li>
</ul>
<p><strong>Performance Impact:</strong></p>
<ul>
<li><strong>Key Generation Time:</strong> 15-30 seconds (varies by platform)</li>
<li><strong>CPU Usage:</strong> Brief spike during key creation (normal, non-disruptive)</li>
</ul>
<div class="admonition info">
<p class="admonition-title">RSA Key Size Considerations</p>
<p><strong>2048-bit (Default):</strong> Industry-standard, balances security and performance. Supported on all modern IOS-XE platforms.</p>
<p><strong>4096-bit:</strong> Higher security, but significantly slower key generation (60-90 seconds) and SSH handshake performance impact. Rarely necessary for enterprise campus switches.</p>
<p><strong>1024-bit:</strong> Deprecated, insecure. Do not use.</p>
</div>
<h3 id="stage-5-save-configuration">Stage 5: Save Configuration<a class="headerlink" href="#stage-5-save-configuration" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">save_configuration</span><span class="p">()</span>  <span class="c1"># Write memory</span>
</code></pre></div></td></tr></table></div>
<p><strong>Critical Importance:</strong></p>
<ul>
<li>Running-config is <strong>volatile</strong> â€” lost on reload</li>
<li>Startup-config is <strong>persistent</strong> (NVRAM) â€” survives reboots</li>
<li>If not saved, device re-enters ZTP mode on next boot</li>
</ul>
<p><strong>Verification:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>Switch# show startup-config | include hostname
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>hostname SW-ACCESS-01
</code></pre></div></td></tr></table></div>
<p>If hostname appears in startup-config, configuration save succeeded.</p>
<h3 id="stage-6-optional-reporting-and-telemetry">Stage 6: Optional Reporting and Telemetry<a class="headerlink" href="#stage-6-optional-reporting-and-telemetry" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">if</span> <span class="n">ENABLE_REPORT_UPLOAD</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="n">facts</span> <span class="o">=</span> <span class="n">collect_device_facts</span><span class="p">()</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span class="n">push_report_file</span><span class="p">(</span><span class="n">facts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>JSON Report Structure:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C9300-48U&quot;</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="nt">&quot;serial_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCW2144L045&quot;</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;17.3.1&quot;</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SW-ACCESS-01&quot;</span><span class="p">,</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-06 14:21:45&quot;</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">  </span><span class="nt">&quot;ztp_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Use Cases:</strong></p>
<ul>
<li><strong>Inventory Automation:</strong> NetBox, CMDB auto-population</li>
<li><strong>Compliance Validation:</strong> Verify device matches expected model/version</li>
<li><strong>Audit Trails:</strong> Maintain deployment records for compliance</li>
</ul>
<hr />
<h2 id="infrastructure-requirements">Infrastructure Requirements<a class="headerlink" href="#infrastructure-requirements" title="Anchor link to this section">&para;</a></h2>
<h3 id="component-checklist">Component Checklist<a class="headerlink" href="#component-checklist" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Required?</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DHCP Server</strong></td>
<td>IP addressing + ZTP script URL (Option 67)</td>
<td>âœ… Required</td>
<td>ISC DHCP, Windows DHCP, Cisco IOS DHCP</td>
</tr>
<tr>
<td><strong>HTTP Server</strong></td>
<td>Host ZTP script and config files</td>
<td>âœ… Required</td>
<td>Apache, Nginx, IIS, Python SimpleHTTPServer</td>
</tr>
<tr>
<td><strong>Syslog/Graylog</strong></td>
<td>Centralized ZTP monitoring</td>
<td>âŒ Optional</td>
<td>Highly recommended for &gt;10 devices</td>
</tr>
<tr>
<td><strong>Management VLAN</strong></td>
<td>Isolated network for provisioning</td>
<td>âœ… Recommended</td>
<td>Security best practice</td>
</tr>
<tr>
<td><strong>NTP Server</strong></td>
<td>Accurate timestamps in logs</td>
<td>âœ… Recommended</td>
<td>Required for Graylog correlation</td>
</tr>
</tbody>
</table>
<h3 id="dhcp-server-configuration">DHCP Server Configuration<a class="headerlink" href="#dhcp-server-configuration" title="Anchor link to this section">&para;</a></h3>
<h4 id="isc-dhcp-linux">ISC DHCP (Linux)<a class="headerlink" href="#isc-dhcp-linux" title="Anchor link to this section">&para;</a></h4>
<p><strong>File:</strong> <code>/etc/dhcp/dhcpd.conf</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>subnet<span class="w"> </span><span class="m">192</span>.168.1.0<span class="w"> </span>netmask<span class="w"> </span><span class="m">255</span>.255.255.0<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span>range<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">192</span>.168.1.200<span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span>option<span class="w"> </span>routers<span class="w"> </span><span class="m">192</span>.168.1.1<span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span>option<span class="w"> </span>domain-name-servers<span class="w"> </span><span class="m">8</span>.8.8.8,<span class="w"> </span><span class="m">8</span>.8.4.4<span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="c1"># ZTP Configuration (Option 67 - Boot File Name)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">    </span>option<span class="w"> </span>bootfile-name<span class="w"> </span><span class="s2">&quot;http://192.168.1.235/scripts/day_0_provisioning.py&quot;</span><span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="c1"># Optional: Option 66 (TFTP Server - not used but some devices check it)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="c1"># option tftp-server-name &quot;192.168.1.235&quot;;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Restart DHCP:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>isc-dhcp-server
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>isc-dhcp-server<span class="w">  </span><span class="c1"># Verify running</span>
</code></pre></div></td></tr></table></div>
<h4 id="windows-dhcp-server">Windows DHCP Server<a class="headerlink" href="#windows-dhcp-server" title="Anchor link to this section">&para;</a></h4>
<p><strong>PowerShell Method:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c"># Set DHCP Option 67 (Boot File Name)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nb">Set-DhcpServerv4OptionValue</span> <span class="n">-OptionId</span> <span class="n">67</span> <span class="p">`</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="n">-Value</span> <span class="s2">&quot;http://192.168.1.235/scripts/day_0_provisioning.py&quot;</span> <span class="p">`</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="n">-ScopeId</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="c"># Verify configuration</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="nb">Get-DhcpServerv4OptionValue</span> <span class="n">-OptionId</span> <span class="n">67</span> <span class="n">-ScopeId</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span>
</code></pre></div></td></tr></table></div>
<p><strong>GUI Method:</strong></p>
<ol>
<li>Open <strong>DHCP Management Console</strong></li>
<li>Navigate to <strong>Scope</strong> â†’ <strong>Scope Options</strong></li>
<li><strong>Configure Option 67</strong> (Bootfile Name):<ul>
<li><strong>String Value:</strong> <code>http://192.168.1.235/scripts/day_0_provisioning.py</code></li>
</ul>
</li>
<li>Click <strong>Apply</strong> and <strong>OK</strong></li>
</ol>
<h4 id="cisco-iosios-xe-dhcp-server">Cisco IOS/IOS-XE DHCP Server<a class="headerlink" href="#cisco-iosios-xe-dhcp-server" title="Anchor link to this section">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>ip dhcp pool ZTP_POOL
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>   network 192.168.1.0 255.255.255.0
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>   default-router 192.168.1.1
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>   dns-server 8.8.8.8 8.8.4.4
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>   option 67 ascii http://192.168.1.235/scripts/day_0_provisioning.py
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>!
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>ip dhcp excluded-address 192.168.1.1 192.168.1.99
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">DHCP Option 67 Syntax</p>
<p><strong>Correct:</strong> <code>http://192.168.1.235/scripts/day_0_provisioning.py</code></p>
<p><strong>Incorrect (common mistakes):</strong></p>
<ul>
<li><code>https://...</code> â€” HTTPS not supported in native ZTP (plain HTTP only)</li>
<li><code>192.168.1.235/scripts/...</code> â€” Missing <code>http://</code> prefix</li>
<li><code>http://192.168.1.235:8080/...</code> â€” Non-standard ports may not work on all platforms</li>
</ul>
</div>
<h3 id="http-server-setup">HTTP Server Setup<a class="headerlink" href="#http-server-setup" title="Anchor link to this section">&para;</a></h3>
<h4 id="option-a-apache-ubuntudebian">Option A: Apache (Ubuntu/Debian)<a class="headerlink" href="#option-a-apache-ubuntudebian" title="Anchor link to this section">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Install Apache</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apache2
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="c1"># Create directory structure</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/www/html/scripts
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/www/html/files
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="c1"># Copy ZTP script</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>sudo<span class="w"> </span>cp<span class="w"> </span>day_0_provisioning.py<span class="w"> </span>/var/www/html/scripts/
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="c1"># Copy device configuration files</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>sudo<span class="w"> </span>cp<span class="w"> </span>*.cfg<span class="w"> </span>/var/www/html/files/
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="c1"># Set permissions</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/var/www/html
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>/var/www/html/scripts/day_0_provisioning.py
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>/var/www/html/files/*.cfg
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="c1"># Restart Apache</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>apache2
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="c1"># Verify (should return Python script content)</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>curl<span class="w"> </span>http://localhost/scripts/day_0_provisioning.py
</code></pre></div></td></tr></table></div>
<p><strong>Expected Directory Structure:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span>
<span class="normal"><a href="#__codelineno-16-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>/var/www/html/
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>â”œâ”€â”€ scripts/
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>â”‚   â””â”€â”€ day_0_provisioning.py
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>â””â”€â”€ files/
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>    â”œâ”€â”€ FCW2144L045.cfg
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>    â”œâ”€â”€ FDO2129Y06B.cfg
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>    â””â”€â”€ FOC2201X0QY.cfg
</code></pre></div></td></tr></table></div>
<h4 id="option-b-nginx-ubuntudebian">Option B: Nginx (Ubuntu/Debian)<a class="headerlink" href="#option-b-nginx-ubuntudebian" title="Anchor link to this section">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># Install Nginx</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nginx
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="c1"># Create directory structure</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/usr/share/nginx/html/scripts
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/usr/share/nginx/html/files
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="c1"># Copy files</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>sudo<span class="w"> </span>cp<span class="w"> </span>day_0_provisioning.py<span class="w"> </span>/usr/share/nginx/html/scripts/
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>sudo<span class="w"> </span>cp<span class="w"> </span>*.cfg<span class="w"> </span>/usr/share/nginx/html/files/
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="c1"># Set permissions</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/usr/share/nginx/html
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>/usr/share/nginx/html/scripts/*.py
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>/usr/share/nginx/html/files/*.cfg
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="c1"># Restart Nginx</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="c1"># Test</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a>curl<span class="w"> </span>http://localhost/scripts/day_0_provisioning.py
</code></pre></div></td></tr></table></div>
<h4 id="option-c-python-simplehttpserver-testing-only">Option C: Python SimpleHTTPServer (Testing Only)<a class="headerlink" href="#option-c-python-simplehttpserver-testing-only" title="Anchor link to this section">&para;</a></h4>
<div class="admonition danger">
<p class="admonition-title">Not for Production</p>
<p>Python's built-in HTTP server is single-threaded and insecure. Use only for lab testing with 1-5 devices. Production deployments require Apache/Nginx.</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Create directory structure</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>ztp-server/<span class="o">{</span>scripts,files<span class="o">}</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nb">cd</span><span class="w"> </span>ztp-server
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="c1"># Copy files</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>cp<span class="w"> </span>/path/to/day_0_provisioning.py<span class="w"> </span>scripts/
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>cp<span class="w"> </span>/path/to/*.cfg<span class="w"> </span>files/
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1"># Start server (Python 3)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">80</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="c1"># Verify from another terminal</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>curl<span class="w"> </span>http://localhost/scripts/day_0_provisioning.py
</code></pre></div></td></tr></table></div>
<h3 id="sysloggraylog-configuration-optional">Syslog/Graylog Configuration (Optional)<a class="headerlink" href="#sysloggraylog-configuration-optional" title="Anchor link to this section">&para;</a></h3>
<p><strong>Why Centralized Logging?</strong></p>
<ul>
<li><strong>Search by Serial Number</strong> â€” Find specific device logs without knowing IP address</li>
<li><strong>Real-Time Monitoring</strong> â€” Watch ZTP progress across entire deployment</li>
<li><strong>Alerting</strong> â€” Trigger notifications on ZTP failures</li>
<li><strong>Compliance</strong> â€” Maintain audit trail of all provisioning activities</li>
</ul>
<p><strong>Graylog Input Configuration:</strong></p>
<ol>
<li>Navigate to <strong>System â†’ Inputs</strong></li>
<li>Select <strong>Syslog UDP</strong> input type</li>
<li><strong>Bind address:</strong> <code>0.0.0.0</code></li>
<li><strong>Port:</strong> <code>514</code></li>
<li>Click <strong>Launch Input</strong></li>
</ol>
<p><strong>Graylog Search Examples:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a># Find specific device by serial number
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>serial_number:FCW2144L045
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a># Find all C9300 provisioning events
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>device_model:C9300*
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a># Find successful completions
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>message:&quot;ZTP PROCESS COMPLETE&quot;
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a># Find failures
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>message:&quot;FAILED&quot; OR level:CRITICAL
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a># Find events from specific ZTP session
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>ztp_session:FCW2144L045_1675891234
</code></pre></div></td></tr></table></div>
<p><strong>Alerting Example:</strong></p>
<p>Create alert for ZTP failures:</p>
<ul>
<li><strong>Condition:</strong> <code>message:"FAILED" OR level:CRITICAL</code></li>
<li><strong>Action:</strong> Send email to network-ops@company.com</li>
<li><strong>Threshold:</strong> 1 message in 5 minutes</li>
</ul>
<hr />
<h2 id="configuration-file-management">Configuration File Management<a class="headerlink" href="#configuration-file-management" title="Anchor link to this section">&para;</a></h2>
<h3 id="filename-convention-critical">Filename Convention (Critical)<a class="headerlink" href="#filename-convention-critical" title="Anchor link to this section">&para;</a></h3>
<p><strong>Rule:</strong> Configuration files MUST be named <code>&lt;SERIAL_NUMBER&gt;.cfg</code> exactly.</p>
<p><strong>Finding Serial Numbers:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>Switch# show version | include Serial
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>System Serial Number : FCW2144L045
</code></pre></div></td></tr></table></div>
<p><strong>Configuration Filename:</strong> <code>FCW2144L045.cfg</code></p>
<div class="admonition danger">
<p class="admonition-title">Common Filename Errors</p>
<p><strong>Wrong:</strong></p>
<ul>
<li><code>fcw2144l045.cfg</code> â€” Lowercase (serial numbers are case-sensitive)</li>
<li><code>FCW2144L045.txt</code> â€” Wrong extension (must be <code>.cfg</code>)</li>
<li><code>switch1.cfg</code> â€” Not based on serial number</li>
<li><code>FCW 2144 L045.cfg</code> â€” Spaces not allowed</li>
</ul>
<p><strong>Correct:</strong></p>
<ul>
<li><code>FCW2144L045.cfg</code> â€” Exact match required</li>
</ul>
</div>
<h3 id="configuration-file-template">Configuration File Template<a class="headerlink" href="#configuration-file-template" title="Anchor link to this section">&para;</a></h3>
<p><strong>Minimal Production Config:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span>
<span class="normal"><a href="#__codelineno-21-28">28</a></span>
<span class="normal"><a href="#__codelineno-21-29">29</a></span>
<span class="normal"><a href="#__codelineno-21-30">30</a></span>
<span class="normal"><a href="#__codelineno-21-31">31</a></span>
<span class="normal"><a href="#__codelineno-21-32">32</a></span>
<span class="normal"><a href="#__codelineno-21-33">33</a></span>
<span class="normal"><a href="#__codelineno-21-34">34</a></span>
<span class="normal"><a href="#__codelineno-21-35">35</a></span>
<span class="normal"><a href="#__codelineno-21-36">36</a></span>
<span class="normal"><a href="#__codelineno-21-37">37</a></span>
<span class="normal"><a href="#__codelineno-21-38">38</a></span>
<span class="normal"><a href="#__codelineno-21-39">39</a></span>
<span class="normal"><a href="#__codelineno-21-40">40</a></span>
<span class="normal"><a href="#__codelineno-21-41">41</a></span>
<span class="normal"><a href="#__codelineno-21-42">42</a></span>
<span class="normal"><a href="#__codelineno-21-43">43</a></span>
<span class="normal"><a href="#__codelineno-21-44">44</a></span>
<span class="normal"><a href="#__codelineno-21-45">45</a></span>
<span class="normal"><a href="#__codelineno-21-46">46</a></span>
<span class="normal"><a href="#__codelineno-21-47">47</a></span>
<span class="normal"><a href="#__codelineno-21-48">48</a></span>
<span class="normal"><a href="#__codelineno-21-49">49</a></span>
<span class="normal"><a href="#__codelineno-21-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>!
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>! Minimal ZTP Configuration Template
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>! Device: Cisco Catalyst 9300
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>! Purpose: Day 0 provisioning via ZTP
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>!
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>hostname SW-ACCESS-01
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>!
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>! Enable secret (Cisco Type 5 hash)
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>enable secret YourEnablePassword
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>!
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>! Management user (privilege 15 = full admin)
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>username admin privilege 15 secret YourAdminPassword
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>!
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>! DNS domain (required for SSH key generation)
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>ip domain-name company.local
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>!
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>! Management VLAN
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>vlan 10
<a id="__codelineno-21-19" name="__codelineno-21-19"></a> name MGMT
<a id="__codelineno-21-20" name="__codelineno-21-20"></a>!
<a id="__codelineno-21-21" name="__codelineno-21-21"></a>interface Vlan10
<a id="__codelineno-21-22" name="__codelineno-21-22"></a> description Management VLAN
<a id="__codelineno-21-23" name="__codelineno-21-23"></a> ip address 10.1.10.50 255.255.255.0
<a id="__codelineno-21-24" name="__codelineno-21-24"></a> no shutdown
<a id="__codelineno-21-25" name="__codelineno-21-25"></a>!
<a id="__codelineno-21-26" name="__codelineno-21-26"></a>ip default-gateway 10.1.10.1
<a id="__codelineno-21-27" name="__codelineno-21-27"></a>!
<a id="__codelineno-21-28" name="__codelineno-21-28"></a>! NTP Configuration
<a id="__codelineno-21-29" name="__codelineno-21-29"></a>ntp server 10.1.1.1
<a id="__codelineno-21-30" name="__codelineno-21-30"></a>!
<a id="__codelineno-21-31" name="__codelineno-21-31"></a>! Syslog Configuration
<a id="__codelineno-21-32" name="__codelineno-21-32"></a>logging host 10.1.1.31
<a id="__codelineno-21-33" name="__codelineno-21-33"></a>logging trap informational
<a id="__codelineno-21-34" name="__codelineno-21-34"></a>!
<a id="__codelineno-21-35" name="__codelineno-21-35"></a>! VTY Access (SSH only, local authentication)
<a id="__codelineno-21-36" name="__codelineno-21-36"></a>line vty 0 15
<a id="__codelineno-21-37" name="__codelineno-21-37"></a> transport input ssh
<a id="__codelineno-21-38" name="__codelineno-21-38"></a> login local
<a id="__codelineno-21-39" name="__codelineno-21-39"></a> exec-timeout 15 0
<a id="__codelineno-21-40" name="__codelineno-21-40"></a>!
<a id="__codelineno-21-41" name="__codelineno-21-41"></a>! Console settings
<a id="__codelineno-21-42" name="__codelineno-21-42"></a>line con 0
<a id="__codelineno-21-43" name="__codelineno-21-43"></a> exec-timeout 15 0
<a id="__codelineno-21-44" name="__codelineno-21-44"></a> logging synchronous
<a id="__codelineno-21-45" name="__codelineno-21-45"></a>!
<a id="__codelineno-21-46" name="__codelineno-21-46"></a>! Disable ZTP after first provision (prevents re-ZTP after &#39;write erase&#39;)
<a id="__codelineno-21-47" name="__codelineno-21-47"></a>! Uncomment if you want ZTP permanently disabled:
<a id="__codelineno-21-48" name="__codelineno-21-48"></a>! no service dhcp
<a id="__codelineno-21-49" name="__codelineno-21-49"></a>!
<a id="__codelineno-21-50" name="__codelineno-21-50"></a>end
</code></pre></div></td></tr></table></div>
<p><strong>Advanced Configuration (AAA + TACACS+):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span>
<span class="normal"><a href="#__codelineno-22-54">54</a></span>
<span class="normal"><a href="#__codelineno-22-55">55</a></span>
<span class="normal"><a href="#__codelineno-22-56">56</a></span>
<span class="normal"><a href="#__codelineno-22-57">57</a></span>
<span class="normal"><a href="#__codelineno-22-58">58</a></span>
<span class="normal"><a href="#__codelineno-22-59">59</a></span>
<span class="normal"><a href="#__codelineno-22-60">60</a></span>
<span class="normal"><a href="#__codelineno-22-61">61</a></span>
<span class="normal"><a href="#__codelineno-22-62">62</a></span>
<span class="normal"><a href="#__codelineno-22-63">63</a></span>
<span class="normal"><a href="#__codelineno-22-64">64</a></span>
<span class="normal"><a href="#__codelineno-22-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>!
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>! Advanced ZTP Configuration with AAA
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>!
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>hostname SW-CORE-01
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>!
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>! AAA Configuration
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>aaa new-model
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>aaa authentication login default group tacacs+ local
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>aaa authorization exec default group tacacs+ local
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>aaa authorization commands 15 default group tacacs+ local
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>aaa accounting exec default start-stop group tacacs+
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>aaa accounting commands 15 default start-stop group tacacs+
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>!
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>! TACACS+ Server
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>tacacs server ISE-TACACS
<a id="__codelineno-22-16" name="__codelineno-22-16"></a> address ipv4 10.1.1.20
<a id="__codelineno-22-17" name="__codelineno-22-17"></a> key 7 YourEncryptedTACACSKey
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>!
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>! Fallback local account (emergency access)
<a id="__codelineno-22-20" name="__codelineno-22-20"></a>username admin privilege 15 secret YourStrongPassword
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>!
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>ip domain-name company.local
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>!
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>! Management VLAN
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>vlan 10
<a id="__codelineno-22-26" name="__codelineno-22-26"></a> name MGMT
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>!
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>interface Vlan10
<a id="__codelineno-22-29" name="__codelineno-22-29"></a> description Management Interface
<a id="__codelineno-22-30" name="__codelineno-22-30"></a> ip address 10.1.10.100 255.255.255.0
<a id="__codelineno-22-31" name="__codelineno-22-31"></a> no shutdown
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>!
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>ip default-gateway 10.1.10.1
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>!
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>! NTP with authentication
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>ntp authenticate
<a id="__codelineno-22-37" name="__codelineno-22-37"></a>ntp authentication-key 1 md5 YourNTPKey
<a id="__codelineno-22-38" name="__codelineno-22-38"></a>ntp trusted-key 1
<a id="__codelineno-22-39" name="__codelineno-22-39"></a>ntp server 10.1.1.1 key 1
<a id="__codelineno-22-40" name="__codelineno-22-40"></a>!
<a id="__codelineno-22-41" name="__codelineno-22-41"></a>! SNMP (read-only)
<a id="__codelineno-22-42" name="__codelineno-22-42"></a>snmp-server community YourROCommunity RO
<a id="__codelineno-22-43" name="__codelineno-22-43"></a>snmp-server location Building-A Floor-3 IDF-1
<a id="__codelineno-22-44" name="__codelineno-22-44"></a>snmp-server contact network-ops@company.com
<a id="__codelineno-22-45" name="__codelineno-22-45"></a>!
<a id="__codelineno-22-46" name="__codelineno-22-46"></a>! Syslog
<a id="__codelineno-22-47" name="__codelineno-22-47"></a>logging host 10.1.1.31 transport udp port 514
<a id="__codelineno-22-48" name="__codelineno-22-48"></a>logging trap notifications
<a id="__codelineno-22-49" name="__codelineno-22-49"></a>logging source-interface Vlan10
<a id="__codelineno-22-50" name="__codelineno-22-50"></a>!
<a id="__codelineno-22-51" name="__codelineno-22-51"></a>! VTY hardening
<a id="__codelineno-22-52" name="__codelineno-22-52"></a>ip access-list standard VTY-ACCESS
<a id="__codelineno-22-53" name="__codelineno-22-53"></a> permit 10.1.0.0 0.0.255.255
<a id="__codelineno-22-54" name="__codelineno-22-54"></a> deny any log
<a id="__codelineno-22-55" name="__codelineno-22-55"></a>!
<a id="__codelineno-22-56" name="__codelineno-22-56"></a>line vty 0 15
<a id="__codelineno-22-57" name="__codelineno-22-57"></a> access-class VTY-ACCESS in
<a id="__codelineno-22-58" name="__codelineno-22-58"></a> transport input ssh
<a id="__codelineno-22-59" name="__codelineno-22-59"></a> exec-timeout 15 0
<a id="__codelineno-22-60" name="__codelineno-22-60"></a>!
<a id="__codelineno-22-61" name="__codelineno-22-61"></a>! Disable unused services
<a id="__codelineno-22-62" name="__codelineno-22-62"></a>no ip http server
<a id="__codelineno-22-63" name="__codelineno-22-63"></a>no ip http secure-server
<a id="__codelineno-22-64" name="__codelineno-22-64"></a>!
<a id="__codelineno-22-65" name="__codelineno-22-65"></a>end
</code></pre></div></td></tr></table></div>
<h3 id="generating-config-files-at-scale">Generating Config Files at Scale<a class="headerlink" href="#generating-config-files-at-scale" title="Anchor link to this section">&para;</a></h3>
<p><strong>For Small Deployments (1-20 devices):</strong> Manual creation or Excel-based templating</p>
<p><strong>For Medium Deployments (20-100 devices):</strong> Python/Jinja2 templating</p>
<p><strong>For Large Deployments (100+ devices):</strong> NetBox + CI/CD pipeline</p>
<p><strong>Example: Python + Jinja2 Templating</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Template</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">openpyxl</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="c1"># Load Excel inventory (columns: Serial, Hostname, IP, Gateway, VLAN)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="s1">&#39;device_inventory.xlsx&#39;</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="c1"># Jinja2 template</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="n">template_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="s2">hostname {{ hostname }}</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="s2">!</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="s2">enable secret {{ enable_password }}</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="s2">username admin privilege 15 secret {{ admin_password }}</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="s2">!</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="s2">ip domain-name company.local</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="s2">!</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="s2">vlan {{ mgmt_vlan }}</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="s2"> name MGMT</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="s2">!</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="s2">interface Vlan{{ mgmt_vlan }}</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="s2"> description Management VLAN</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="s2"> ip address {{ mgmt_ip }} {{ mgmt_mask }}</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="s2"> no shutdown</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="s2">!</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="s2">ip default-gateway {{ default_gateway }}</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="s2">!</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="s2">line vty 0 15</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="s2"> transport input ssh</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="s2"> login local</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="s2">!</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="s2">end</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template_str</span><span class="p">)</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a><span class="c1"># Generate config for each device</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>    <span class="n">serial</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">mgmt_ip</span><span class="p">,</span> <span class="n">gateway</span><span class="p">,</span> <span class="n">vlan</span> <span class="o">=</span> <span class="n">row</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>        <span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>        <span class="n">enable_password</span><span class="o">=</span><span class="s1">&#39;YourEnableSecret&#39;</span><span class="p">,</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>        <span class="n">admin_password</span><span class="o">=</span><span class="s1">&#39;YourAdminSecret&#39;</span><span class="p">,</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>        <span class="n">mgmt_vlan</span><span class="o">=</span><span class="n">vlan</span><span class="p">,</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>        <span class="n">mgmt_ip</span><span class="o">=</span><span class="n">mgmt_ip</span><span class="p">,</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>        <span class="n">mgmt_mask</span><span class="o">=</span><span class="s1">&#39;255.255.255.0&#39;</span><span class="p">,</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>        <span class="n">default_gateway</span><span class="o">=</span><span class="n">gateway</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>    <span class="p">)</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>    <span class="c1"># Write to file named by serial number</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;configs/</span><span class="si">{</span><span class="n">serial</span><span class="si">}</span><span class="s1">.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated: </span><span class="si">{</span><span class="n">serial</span><span class="si">}</span><span class="s1">.cfg (</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="script-configuration-options">Script Configuration Options<a class="headerlink" href="#script-configuration-options" title="Anchor link to this section">&para;</a></h2>
<p>All configurable parameters are located at the top of <code>day_0_provisioning.py</code>:</p>
<h3 id="http-server-settings">HTTP Server Settings<a class="headerlink" href="#http-server-settings" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">HTTP_SERVER</span> <span class="o">=</span> <span class="s2">&quot;192.0.2.235&quot;</span>  <span class="c1"># IP or hostname of HTTP server</span>
</code></pre></div></td></tr></table></div>
<p><strong>Change this to:</strong> Your HTTP server's IP address or DNS hostname</p>
<p><strong>Note:</strong> DNS hostname requires functioning DNS resolution on management VLAN</p>
<h3 id="logging-settings">Logging Settings<a class="headerlink" href="#logging-settings" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">LOG_TO_FILE</span> <span class="o">=</span> <span class="kc">True</span>                       <span class="c1"># Enable persistent flash logging</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">LOG_PATH_PRIMARY</span> <span class="o">=</span> <span class="s2">&quot;/flash/guest-share/ztp.log&quot;</span>  <span class="c1"># Preferred log location</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">LOG_PATH_FALLBACK</span> <span class="o">=</span> <span class="s2">&quot;/flash/ztp.log&quot;</span>     <span class="c1"># Fallback if guest-share unavailable</span>
</code></pre></div></td></tr></table></div>
<p><strong>Log Rotation:</strong></p>
<ul>
<li><strong>Max Size:</strong> 5MB per log file</li>
<li><strong>Backups:</strong> 2 (ztp.log.1, ztp.log.2)</li>
<li><strong>Format:</strong> <code>2026-02-06 14:20:03 :: INFO :: Message</code></li>
</ul>
<h3 id="retry-policy">Retry Policy<a class="headerlink" href="#retry-policy" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">MAX_COPY_ATTEMPTS</span> <span class="o">=</span> <span class="mi">3</span>      <span class="c1"># Number of download attempts</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">BASE_BACKOFF_SECONDS</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1"># Base delay for exponential backoff</span>
</code></pre></div></td></tr></table></div>
<p><strong>Retry Schedule:</strong></p>
<ul>
<li>Attempt 1: Immediate</li>
<li>Attempt 2: Wait 2 seconds</li>
<li>Attempt 3: Wait 4 seconds</li>
</ul>
<p><strong>Increasing Retries (High-Latency Networks):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">MAX_COPY_ATTEMPTS</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">BASE_BACKOFF_SECONDS</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 5s, 10s, 20s, 40s</span>
</code></pre></div></td></tr></table></div>
<h3 id="configuration-persistence">Configuration Persistence<a class="headerlink" href="#configuration-persistence" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="n">WRITE_MEMORY</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># MUST BE TRUE for production</span>
</code></pre></div></td></tr></table></div>
<div class="admonition danger">
<p class="admonition-title">Critical Setting</p>
<p><strong>Never set <code>WRITE_MEMORY = False</code> in production!</strong></p>
<p>If disabled, running-config is not saved to startup-config. Device will re-enter ZTP mode on next reboot, causing configuration loss.</p>
<p><strong>Valid use case for False:</strong> Lab testing where you want devices to re-run ZTP on each boot.</p>
</div>
<h3 id="sysloggraylog-integration">Syslog/Graylog Integration<a class="headerlink" href="#sysloggraylog-integration" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">ENABLE_SYSLOG</span> <span class="o">=</span> <span class="kc">False</span>              <span class="c1"># Set to True to enable</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">SYSLOG_SERVER</span> <span class="o">=</span> <span class="s2">&quot;192.0.2.50&quot;</span>       <span class="c1"># Graylog/Syslog server IP</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="n">SYSLOG_PORT</span> <span class="o">=</span> <span class="mi">514</span>                  <span class="c1"># UDP port (514 = standard syslog)</span>
</code></pre></div></td></tr></table></div>
<p><strong>JSON Log Structure:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-06 14:21:45&quot;</span><span class="p">,</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Configuration merge completed&quot;</span><span class="p">,</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">  </span><span class="nt">&quot;script&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cisco_ztp&quot;</span><span class="p">,</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">  </span><span class="nt">&quot;serial_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCW2144L045&quot;</span><span class="p">,</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">  </span><span class="nt">&quot;device_model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C9300-48U&quot;</span><span class="p">,</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">  </span><span class="nt">&quot;ztp_session&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCW2144L045_1675891234&quot;</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="device-reporting">Device Reporting<a class="headerlink" href="#device-reporting" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">ENABLE_REPORT_UPLOAD</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set to True to enable local JSON reports</span>
</code></pre></div></td></tr></table></div>
<p>When enabled, creates <code>/flash/ztp_report_&lt;SERIAL&gt;.json</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span>
<span class="normal"><a href="#__codelineno-32-7">7</a></span>
<span class="normal"><a href="#__codelineno-32-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C9300-48U&quot;</span><span class="p">,</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="nt">&quot;serial_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FCW2144L045&quot;</span><span class="p">,</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;17.3.1&quot;</span><span class="p">,</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">  </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SW-ACCESS-01&quot;</span><span class="p">,</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-06 14:21:45&quot;</span><span class="p">,</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">  </span><span class="nt">&quot;ztp_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Use Case:</strong> Post-ZTP automation (Ansible/AWX) can collect these JSON files and populate CMDB/NetBox.</p>
<hr />
<h2 id="deployment-workflow">Deployment Workflow<a class="headerlink" href="#deployment-workflow" title="Anchor link to this section">&para;</a></h2>
<h3 id="pre-deployment-one-time-setup">Pre-Deployment (One-Time Setup)<a class="headerlink" href="#pre-deployment-one-time-setup" title="Anchor link to this section">&para;</a></h3>
<ol>
<li>
<p><strong>Prepare Infrastructure</strong></p>
<ul>
<li>Deploy HTTP server (Apache/Nginx)</li>
<li>Configure DHCP server with Option 67</li>
<li>(Optional) Set up Graylog/Syslog server</li>
</ul>
</li>
<li>
<p><strong>Customize Script</strong></p>
<ul>
<li>Edit <code>HTTP_SERVER</code> variable in <code>day_0_provisioning.py</code></li>
<li>Enable syslog if desired</li>
<li>Upload script to HTTP server: <code>/var/www/html/scripts/day_0_provisioning.py</code></li>
</ul>
</li>
<li>
<p><strong>Create Configuration Files</strong></p>
<ul>
<li>Generate device-specific <code>.cfg</code> files (manual or scripted)</li>
<li>Upload to HTTP server: <code>/var/www/html/files/&lt;SERIAL&gt;.cfg</code></li>
</ul>
</li>
<li>
<p><strong>Validate Infrastructure</strong></p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span>
<span class="normal"><a href="#__codelineno-33-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># Test HTTP server accessibility</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>curl<span class="w"> </span>http://192.168.1.235/scripts/day_0_provisioning.py
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>curl<span class="w"> </span>http://192.168.1.235/files/FCW2144L045.cfg
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="c1"># Verify DHCP Option 67</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="c1"># (From DHCP client test or switch console)</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>show<span class="w"> </span>dhcp<span class="w"> </span>lease<span class="w">  </span><span class="c1"># Should show Option 67 with script URL</span>
</code></pre></div></td></tr></table></div>
<h3 id="per-device-deployment">Per-Device Deployment<a class="headerlink" href="#per-device-deployment" title="Anchor link to this section">&para;</a></h3>
<ol>
<li><strong>Verify Serial Number</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>Switch# show version | include Serial
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>System Serial Number : FCW2144L045
</code></pre></div></td></tr></table></div>
<ol>
<li>
<p><strong>Create Matching Config File</strong></p>
</li>
<li>
<p>Filename: <code>FCW2144L045.cfg</code></p>
</li>
<li>
<p>Upload to HTTP server: <code>/var/www/html/files/FCW2144L045.cfg</code></p>
</li>
<li>
<p><strong>Erase Existing Config (If Re-Provisioning)</strong></p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span>
<span class="normal"><a href="#__codelineno-35-6">6</a></span>
<span class="normal"><a href="#__codelineno-35-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>Switch# write erase
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>Erasing the nvram filesystem will remove all configuration files! Continue? [confirm]
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>[OK]
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>Erase of nvram: complete
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>Switch# reload
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>Proceed with reload? [confirm]
</code></pre></div></td></tr></table></div>
<ol>
<li>
<p><strong>Connect to Network and Power On</strong></p>
</li>
<li>
<p>Connect management port or uplink to network with DHCP access</p>
</li>
<li>Power on switch</li>
<li>
<p><strong>Do not touch console</strong> â€” ZTP needs uninterrupted boot</p>
</li>
<li>
<p><strong>Monitor Progress</strong></p>
</li>
</ol>
<p><strong>Option A: Console Monitoring</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>###### STARTING ZTP SCRIPT ######
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>Device Model: C9300-48U
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>Serial Number: FCW2144L045
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>IOS-XE Version: 17.3.1
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>--- Stage 1: Downloading Device Configuration ---
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>Downloading &#39;FCW2144L045.cfg&#39; from server 192.168.1.235...
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>File &#39;FCW2144L045.cfg&#39; successfully downloaded and verified.
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>--- Stage 2: Applying Configuration ---
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>Merging &#39;FCW2144L045.cfg&#39; with running-config...
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>Configuration merge completed.
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>Device configured with hostname: SW-ACCESS-01
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>--- Stage 3: Generating SSH Keys ---
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>Generating new 2048-bit RSA keys...
<a id="__codelineno-36-18" name="__codelineno-36-18"></a>New RSA keys generated successfully.
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>--- Stage 4: Saving Configuration ---
<a id="__codelineno-36-21" name="__codelineno-36-21"></a>Writing config to Memory...
<a id="__codelineno-36-22" name="__codelineno-36-22"></a>Configuration saved successfully.
<a id="__codelineno-36-23" name="__codelineno-36-23"></a>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a>###### ZTP PROCESS COMPLETE ######
</code></pre></div></td></tr></table></div>
<p><strong>Option B: Graylog Monitoring</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a># Real-time search (auto-refresh every 5 seconds)
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>serial_number:FCW2144L045
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a># Successful completion indicator
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>message:&quot;ZTP PROCESS COMPLETE&quot; AND serial_number:FCW2144L045
</code></pre></div></td></tr></table></div>
<p><strong>Option C: Flash Log Review (Post-ZTP)</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span>
<span class="normal"><a href="#__codelineno-38-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>Switch# more flash:guest-share/ztp.log
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>2026-02-06 14:20:03 :: INFO :: ###### STARTING ZTP SCRIPT ######
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>2026-02-06 14:20:04 :: INFO :: Device Model: C9300-48U
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>2026-02-06 14:20:04 :: INFO :: Serial Number: FCW2144L045
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>...
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>2026-02-06 14:21:45 :: INFO :: ###### ZTP PROCESS COMPLETE ######
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>Post-Provisioning Verification</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a>! Verify SSH keys exist
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>Switch# show crypto key mypubkey rsa
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>% Key pair was generated at: 14:21:30 UTC Feb 6 2026
<a id="__codelineno-39-4" name="__codelineno-39-4"></a>Key name: ZTP_Key_General
<a id="__codelineno-39-5" name="__codelineno-39-5"></a>Storage Device: not specified
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>Usage: General Purpose Key
<a id="__codelineno-39-7" name="__codelineno-39-7"></a>Key is not exportable.
<a id="__codelineno-39-8" name="__codelineno-39-8"></a>Key Data:
<a id="__codelineno-39-9" name="__codelineno-39-9"></a>[...key data...]
<a id="__codelineno-39-10" name="__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a>! Verify startup-config saved
<a id="__codelineno-39-12" name="__codelineno-39-12"></a>Switch# show startup-config | include hostname
<a id="__codelineno-39-13" name="__codelineno-39-13"></a>hostname SW-ACCESS-01
<a id="__codelineno-39-14" name="__codelineno-39-14"></a>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a>! Test SSH access (from management workstation)
<a id="__codelineno-39-16" name="__codelineno-39-16"></a>ssh admin@10.1.10.50
<a id="__codelineno-39-17" name="__codelineno-39-17"></a>Password:
<a id="__codelineno-39-18" name="__codelineno-39-18"></a>SW-ACCESS-01#
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="troubleshooting-guide">Troubleshooting Guide<a class="headerlink" href="#troubleshooting-guide" title="Anchor link to this section">&para;</a></h2>
<h3 id="common-issues-and-solutions">Common Issues and Solutions<a class="headerlink" href="#common-issues-and-solutions" title="Anchor link to this section">&para;</a></h3>
<h4 id="issue-1-ztp-doesnt-start">Issue 1: ZTP Doesn't Start<a class="headerlink" href="#issue-1-ztp-doesnt-start" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Switch boots normally, prompts for initial configuration dialog</li>
<li>No ZTP activity visible in logs</li>
</ul>
<p><strong>Causes:</strong></p>
<table>
<thead>
<tr>
<th>Cause</th>
<th>Verification</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Startup-config exists</td>
<td><code>show startup-config</code></td>
<td><code>write erase</code> + <code>reload</code></td>
</tr>
<tr>
<td>DHCP not available</td>
<td><code>show ip interface brief</code> (no IP)</td>
<td>Verify DHCP server reachability</td>
</tr>
<tr>
<td>DHCP Option 67 not configured</td>
<td><code>show dhcp lease</code> (no Option 67)</td>
<td>Configure DHCP Option 67</td>
</tr>
<tr>
<td>Console interaction during boot</td>
<td>N/A</td>
<td>Don't press any keys during boot timer</td>
</tr>
</tbody>
</table>
<p><strong>Verification Steps:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>! Check if ZTP is enabled (should be enabled by default)
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>Switch# show boot | include ZTP
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>ZTP is enabled
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a>! Verify DHCP lease and Option 67
<a id="__codelineno-40-6" name="__codelineno-40-6"></a>Switch# show dhcp lease
<a id="__codelineno-40-7" name="__codelineno-40-7"></a>Temp IP addr: 192.168.1.105 for peer on Interface: GigabitEthernet1/0/1
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>Temp sub net mask: 255.255.255.0
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>DHCP Lease server: 192.168.1.1, state: 5 Bound
<a id="__codelineno-40-10" name="__codelineno-40-10"></a>...
<a id="__codelineno-40-11" name="__codelineno-40-11"></a>Option 67 = &quot;http://192.168.1.235/scripts/day_0_provisioning.py&quot;
</code></pre></div></td></tr></table></div>
<h4 id="issue-2-http-404-error-config-file-not-found">Issue 2: HTTP 404 Error (Config File Not Found)<a class="headerlink" href="#issue-2-http-404-error-config-file-not-found" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a>File &#39;FCW2144L045.cfg&#39; not found.
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>Failed to transfer &#39;FCW2144L045.cfg&#39; after 3 attempts.
</code></pre></div></td></tr></table></div>
<p><strong>Causes:</strong></p>
<table>
<thead>
<tr>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Config file doesn't exist on HTTP server</td>
<td>Create file: <code>/var/www/html/files/FCW2144L045.cfg</code></td>
</tr>
<tr>
<td>Filename mismatch (wrong serial)</td>
<td>Verify: <code>show version \| include Serial</code></td>
</tr>
<tr>
<td>Case sensitivity error</td>
<td>Ensure uppercase matches: <code>FCW2144L045.cfg</code></td>
</tr>
<tr>
<td>Wrong HTTP server path</td>
<td>Verify script points to correct server IP</td>
</tr>
</tbody>
</table>
<p><strong>Verification:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span>
<span class="normal"><a href="#__codelineno-42-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># From HTTP server</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/www/html/files/<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>FCW2144L045
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>www-data<span class="w"> </span>www-data<span class="w"> </span><span class="m">1234</span><span class="w"> </span>Feb<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">09</span>:30<span class="w"> </span>FCW2144L045.cfg
<a id="__codelineno-42-4" name="__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="c1"># Test HTTP access from another machine</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>curl<span class="w"> </span>http://192.168.1.235/files/FCW2144L045.cfg
</code></pre></div></td></tr></table></div>
<h4 id="issue-3-network-timeout-retry-failures">Issue 3: Network Timeout / Retry Failures<a class="headerlink" href="#issue-3-network-timeout-retry-failures" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a>Attempt 1 failed: Network timeout
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>Attempt 2 failed: Network timeout
<a id="__codelineno-43-3" name="__codelineno-43-3"></a>Attempt 3 failed: Network timeout
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>Failed to transfer &#39;FCW2144L045.cfg&#39; after 3 attempts.
</code></pre></div></td></tr></table></div>
<p><strong>Causes:</strong></p>
<table>
<thead>
<tr>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spanning tree convergence delay</td>
<td>Increase <code>MAX_COPY_ATTEMPTS = 5</code> and <code>BASE_BACKOFF_SECONDS = 5</code></td>
</tr>
<tr>
<td>HTTP server unreachable</td>
<td><code>ping 192.168.1.235</code> from switch</td>
</tr>
<tr>
<td>Firewall blocking HTTP</td>
<td>Verify firewall rules allow port 80 from management VLAN</td>
</tr>
<tr>
<td>HTTP server overloaded</td>
<td>Stagger switch power-on (don't boot 100 simultaneously)</td>
</tr>
</tbody>
</table>
<p><strong>Mitigation:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># In day_0_provisioning.py, increase retry attempts</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="n">MAX_COPY_ATTEMPTS</span> <span class="o">=</span> <span class="mi">5</span>        <span class="c1"># Up from 3</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="n">BASE_BACKOFF_SECONDS</span> <span class="o">=</span> <span class="mi">5</span>     <span class="c1"># Up from 2 (gives STP more time)</span>
</code></pre></div></td></tr></table></div>
<h4 id="issue-4-configuration-syntax-errors">Issue 4: Configuration Syntax Errors<a class="headerlink" href="#issue-4-configuration-syntax-errors" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>% Invalid input detected at &#39;^&#39; marker.
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>Configuration merge completed.  # But not all commands applied
</code></pre></div></td></tr></table></div>
<p><strong>Causes:</strong></p>
<ul>
<li>Invalid IOS-XE commands in <code>.cfg</code> file</li>
<li>Commands not supported on device platform</li>
<li>Syntax errors (typos, missing keywords)</li>
</ul>
<p><strong>Solution:</strong></p>
<ol>
<li><strong>Pre-validate config files:</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a>! Test config on lab device first
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>Switch# configure terminal
<a id="__codelineno-46-3" name="__codelineno-46-3"></a>Switch(config)# [paste entire config]
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>Switch(config)# end
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>Switch# show running-config
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>Common syntax errors:</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span>
<span class="normal"><a href="#__codelineno-47-3">3</a></span>
<span class="normal"><a href="#__codelineno-47-4">4</a></span>
<span class="normal"><a href="#__codelineno-47-5">5</a></span>
<span class="normal"><a href="#__codelineno-47-6">6</a></span>
<span class="normal"><a href="#__codelineno-47-7">7</a></span>
<span class="normal"><a href="#__codelineno-47-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>! WRONG: Missing &#39;no shutdown&#39; on SVI
<a id="__codelineno-47-2" name="__codelineno-47-2"></a>interface Vlan10
<a id="__codelineno-47-3" name="__codelineno-47-3"></a> ip address 10.1.10.50 255.255.255.0
<a id="__codelineno-47-4" name="__codelineno-47-4"></a>!
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>! CORRECT: Always include &#39;no shutdown&#39; on SVIs
<a id="__codelineno-47-6" name="__codelineno-47-6"></a>interface Vlan10
<a id="__codelineno-47-7" name="__codelineno-47-7"></a> ip address 10.1.10.50 255.255.255.0
<a id="__codelineno-47-8" name="__codelineno-47-8"></a> no shutdown
</code></pre></div></td></tr></table></div>
<h4 id="issue-5-ssh-connection-refused-post-ztp">Issue 5: SSH Connection Refused Post-ZTP<a class="headerlink" href="#issue-5-ssh-connection-refused-post-ztp" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>ZTP completes successfully</li>
<li>Cannot SSH to device: "Connection refused"</li>
</ul>
<p><strong>Causes:</strong></p>
<table>
<thead>
<tr>
<th>Cause</th>
<th>Verification</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>SSH keys not generated</td>
<td><code>show crypto key mypubkey rsa</code></td>
<td>Manually run: <code>crypto key generate rsa modulus 2048</code></td>
</tr>
<tr>
<td>IP domain-name not configured</td>
<td><code>show run \| include ip domain</code></td>
<td>Add to config file: <code>ip domain-name company.local</code></td>
</tr>
<tr>
<td>VTY lines not configured for SSH</td>
<td><code>show run \| section line vty</code></td>
<td>Add to config file: <code>line vty 0 15</code> + <code>transport input ssh</code></td>
</tr>
<tr>
<td>VTY access-class blocking source</td>
<td><code>show run \| include access-class</code></td>
<td>Verify source IP allowed in ACL</td>
</tr>
</tbody>
</table>
<p><strong>Manual Fix:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a>! Configure IP domain (prerequisite for SSH)
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>Switch(config)# ip domain-name company.local
<a id="__codelineno-48-3" name="__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>! Generate RSA keys
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>Switch(config)# crypto key generate rsa modulus 2048
<a id="__codelineno-48-6" name="__codelineno-48-6"></a>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>! Configure VTY for SSH
<a id="__codelineno-48-8" name="__codelineno-48-8"></a>Switch(config)# line vty 0 15
<a id="__codelineno-48-9" name="__codelineno-48-9"></a>Switch(config-line)# transport input ssh
<a id="__codelineno-48-10" name="__codelineno-48-10"></a>Switch(config-line)# login local
<a id="__codelineno-48-11" name="__codelineno-48-11"></a>Switch(config-line)# end
<a id="__codelineno-48-12" name="__codelineno-48-12"></a>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a>! Verify SSH enabled
<a id="__codelineno-48-14" name="__codelineno-48-14"></a>Switch# show ip ssh
<a id="__codelineno-48-15" name="__codelineno-48-15"></a>SSH Enabled - version 2.0
</code></pre></div></td></tr></table></div>
<h4 id="issue-6-config-not-saved-re-ztp-on-reboot">Issue 6: Config Not Saved (Re-ZTP on Reboot)<a class="headerlink" href="#issue-6-config-not-saved-re-ztp-on-reboot" title="Anchor link to this section">&para;</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>ZTP completes successfully</li>
<li>Device reboots and re-runs ZTP</li>
</ul>
<p><strong>Cause:</strong></p>
<ul>
<li><code>WRITE_MEMORY = False</code> in script (wrong setting)</li>
<li><code>write memory</code> command failed silently</li>
</ul>
<p><strong>Verification:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span>
<span class="normal"><a href="#__codelineno-49-5">5</a></span>
<span class="normal"><a href="#__codelineno-49-6">6</a></span>
<span class="normal"><a href="#__codelineno-49-7">7</a></span>
<span class="normal"><a href="#__codelineno-49-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>! Check if startup-config matches running-config
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>Switch# show startup-config | include hostname
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>hostname SW-ACCESS-01  # Should match running-config
<a id="__codelineno-49-4" name="__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>! If missing, manually save
<a id="__codelineno-49-6" name="__codelineno-49-6"></a>Switch# write memory
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>Building configuration...
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>[OK]
</code></pre></div></td></tr></table></div>
<p><strong>Fix:</strong></p>
<p>Ensure <code>WRITE_MEMORY = True</code> in <code>day_0_provisioning.py</code> (default setting)</p>
<hr />
<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Anchor link to this section">&para;</a></h2>
<h3 id="threat-model">Threat Model<a class="headerlink" href="#threat-model" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Threat</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DHCP Spoofing</strong></td>
<td>Rogue DHCP server provides malicious ZTP script URL</td>
<td>DHCP Snooping on access layer</td>
</tr>
<tr>
<td><strong>HTTP MITM Attack</strong></td>
<td>Attacker intercepts and modifies config files</td>
<td>Isolated management VLAN, consider HTTPS (custom impl)</td>
</tr>
<tr>
<td><strong>Config File Exposure</strong></td>
<td>Sensitive data in URLs/logs</td>
<td>Use HTTPS for HTTP server, restrict log access</td>
</tr>
<tr>
<td><strong>Unsecured Flash Logs</strong></td>
<td>Passwords visible in flash logs</td>
<td>Script deletes config files after merge</td>
</tr>
<tr>
<td><strong>Unauthorized ZTP Re-Trigger</strong></td>
<td>Attacker resets device to factory and re-provisions</td>
<td>Physical security, disable ZTP after provisioning</td>
</tr>
</tbody>
</table>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Anchor link to this section">&para;</a></h3>
<h4 id="1-use-isolated-management-vlan">1. Use Isolated Management VLAN<a class="headerlink" href="#1-use-isolated-management-vlan" title="Anchor link to this section">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span>
<span class="normal"><a href="#__codelineno-50-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>! Trunk only management VLAN to ZTP devices
<a id="__codelineno-50-2" name="__codelineno-50-2"></a>interface GigabitEthernet1/0/48
<a id="__codelineno-50-3" name="__codelineno-50-3"></a> description ZTP Uplink
<a id="__codelineno-50-4" name="__codelineno-50-4"></a> switchport mode trunk
<a id="__codelineno-50-5" name="__codelineno-50-5"></a> switchport trunk allowed vlan 10
<a id="__codelineno-50-6" name="__codelineno-50-6"></a> spanning-tree portfast trunk
</code></pre></div></td></tr></table></div>
<p><strong>Why:</strong> Prevents ZTP traffic from reaching production VLANs</p>
<h4 id="2-enable-dhcp-snooping">2. Enable DHCP Snooping<a class="headerlink" href="#2-enable-dhcp-snooping" title="Anchor link to this section">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span>
<span class="normal"><a href="#__codelineno-51-3">3</a></span>
<span class="normal"><a href="#__codelineno-51-4">4</a></span>
<span class="normal"><a href="#__codelineno-51-5">5</a></span>
<span class="normal"><a href="#__codelineno-51-6">6</a></span>
<span class="normal"><a href="#__codelineno-51-7">7</a></span>
<span class="normal"><a href="#__codelineno-51-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>! On distribution/access switches
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>ip dhcp snooping
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>ip dhcp snooping vlan 10
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>! Trust port connected to legitimate DHCP server
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>interface GigabitEthernet1/0/1
<a id="__codelineno-51-7" name="__codelineno-51-7"></a> description Trunk to DHCP Server
<a id="__codelineno-51-8" name="__codelineno-51-8"></a> ip dhcp snooping trust
</code></pre></div></td></tr></table></div>
<p><strong>Why:</strong> Prevents rogue DHCP servers from hijacking ZTP</p>
<h4 id="3-restrict-http-server-access">3. Restrict HTTP Server Access<a class="headerlink" href="#3-restrict-http-server-access" title="Anchor link to this section">&para;</a></h4>
<p><strong>Firewall Rule (Linux iptables):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># Allow HTTP only from management VLAN</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>sudo<span class="w"> </span>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>sudo<span class="w"> </span>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div></td></tr></table></div>
<p><strong>Apache Virtual Host (IP-based restriction):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span>
<span class="normal"><a href="#__codelineno-53-4">4</a></span>
<span class="normal"><a href="#__codelineno-53-5">5</a></span>
<span class="normal"><a href="#__codelineno-53-6">6</a></span>
<span class="normal"><a href="#__codelineno-53-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:80</span><span class="nt">&gt;</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="w">    </span><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/var/www/html</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="w">    </span><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/var/www/html</span><span class="nt">&gt;</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="w">        </span><span class="nb">Require</span><span class="w"> </span>ip<span class="w"> </span><span class="m">192.168.1.0/24</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="w">    </span><span class="nt">&lt;/Directory&gt;</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div></td></tr></table></div>
<h4 id="4-disable-ztp-after-provisioning">4. Disable ZTP After Provisioning<a class="headerlink" href="#4-disable-ztp-after-provisioning" title="Anchor link to this section">&para;</a></h4>
<p><strong>Option A: Explicitly Disable DHCP-Based Provisioning</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>! Prevents device from re-attempting ZTP
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>Switch(config)# no service dhcp
</code></pre></div></td></tr></table></div>
<p><strong>Option B: Remove Startup-Config Detection</strong></p>
<p>Add to ZTP config template:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span>
<span class="normal"><a href="#__codelineno-55-5">5</a></span>
<span class="normal"><a href="#__codelineno-55-6">6</a></span>
<span class="normal"><a href="#__codelineno-55-7">7</a></span>
<span class="normal"><a href="#__codelineno-55-8">8</a></span>
<span class="normal"><a href="#__codelineno-55-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>! This command is processed only after startup-config exists
<a id="__codelineno-55-2" name="__codelineno-55-2"></a>! Prevents future ZTP even if startup-config is erased
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>event manager applet DISABLE_ZTP
<a id="__codelineno-55-4" name="__codelineno-55-4"></a> event none
<a id="__codelineno-55-5" name="__codelineno-55-5"></a> action 1.0 cli command &quot;enable&quot;
<a id="__codelineno-55-6" name="__codelineno-55-6"></a> action 2.0 cli command &quot;config t&quot;
<a id="__codelineno-55-7" name="__codelineno-55-7"></a> action 3.0 cli command &quot;no boot network&quot;
<a id="__codelineno-55-8" name="__codelineno-55-8"></a> action 4.0 cli command &quot;end&quot;
<a id="__codelineno-55-9" name="__codelineno-55-9"></a> action 5.0 cli command &quot;write memory&quot;
</code></pre></div></td></tr></table></div>
<h4 id="5-secure-credential-storage">5. Secure Credential Storage<a class="headerlink" href="#5-secure-credential-storage" title="Anchor link to this section">&para;</a></h4>
<div class="admonition danger">
<p class="admonition-title">Never Store Plain-Text Passwords in Config Files</p>
<p><strong>Bad Practice:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>username admin privilege 15 password MyPassword123
</code></pre></div></td></tr></table></div></p>
<p><strong>Best Practice:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>! Use Type 8 (PBKDF2) or Type 9 (scrypt) secrets
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>username admin privilege 15 secret MyStrongPassword
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>! Result in running-config (hashed):
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>username admin privilege 15 secret 8 $8$xyz...
</code></pre></div></td></tr></table></div></p>
</div>
<p><strong>Generating Hashed Passwords:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span>
<span class="normal"><a href="#__codelineno-58-6">6</a></span>
<span class="normal"><a href="#__codelineno-58-7">7</a></span>
<span class="normal"><a href="#__codelineno-58-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a>! On any Cisco device
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>Switch# show run | include username
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>username admin privilege 15 secret YourPassword
<a id="__codelineno-58-4" name="__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>! Output (Type 5 hash - MD5):
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>username admin privilege 15 secret 5 $1$abc123$xyz...
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>! Copy hash to config template
</code></pre></div></td></tr></table></div>
<h4 id="6-audit-trail-and-compliance">6. Audit Trail and Compliance<a class="headerlink" href="#6-audit-trail-and-compliance" title="Anchor link to this section">&para;</a></h4>
<p><strong>Logging Requirements:</strong></p>
<ul>
<li><strong>Who:</strong> Operator/automation system initiated ZTP</li>
<li><strong>What:</strong> Device serial, model, config applied</li>
<li><strong>When:</strong> Timestamp (use NTP for accuracy)</li>
<li><strong>Where:</strong> Device location (building, floor, IDF)</li>
<li><strong>Result:</strong> Success or failure with error details</li>
</ul>
<p><strong>Implementation:</strong></p>
<p>Enable Syslog to Graylog with retention policies:</p>
<ul>
<li><strong>Retention:</strong> 90 days minimum (compliance requirement)</li>
<li><strong>Backup:</strong> Daily Graylog index backups</li>
<li><strong>Access Control:</strong> Role-based access to logs (NetOps, SecOps, Audit)</li>
</ul>
<hr />
<h2 id="advanced-topics">Advanced Topics<a class="headerlink" href="#advanced-topics" title="Anchor link to this section">&para;</a></h2>
<h3 id="multi-platform-support">Multi-Platform Support<a class="headerlink" href="#multi-platform-support" title="Anchor link to this section">&para;</a></h3>
<p><strong>Supported Platforms (Tested):</strong></p>
<ul>
<li>Catalyst 9200 Series (all models)</li>
<li>Catalyst 9300 Series (all models)</li>
<li>Catalyst 9400 Series (all models)</li>
<li>Catalyst 9500 Series (all models)</li>
<li>Catalyst 9600 Series (all models)</li>
</ul>
<p><strong>Untested (Should Work):</strong></p>
<ul>
<li>Catalyst 3850/3650 (IOS-XE 16.x with Guestshell)</li>
<li>ASR 1000 Series (IOS-XE routers)</li>
<li>ISR 4000 Series (IOS-XE routers)</li>
</ul>
<p><strong>Platform-Specific Considerations:</strong></p>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Consideration</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Catalyst 9300 StackWise</strong></td>
<td>Serial is chassis-specific; config applies to active switch only</td>
<td>Use switch 1 serial for config filename</td>
</tr>
<tr>
<td><strong>Catalyst 9400 Dual SUP</strong></td>
<td>Active SUP runs ZTP; standby inherits config after sync</td>
<td>Normal operation, no special handling needed</td>
</tr>
<tr>
<td><strong>Catalyst 9600 StackWise Virtual</strong></td>
<td>Two chassis, single logical device</td>
<td>Use active chassis serial for config</td>
</tr>
<tr>
<td><strong>ISR 4000 (Routers)</strong></td>
<td>Different default flash path (<code>bootflash:</code> vs <code>flash:</code>)</td>
<td>Modify script <code>file_system="bootflash:"</code></td>
</tr>
</tbody>
</table>
<h3 id="stackwise-considerations">StackWise Considerations<a class="headerlink" href="#stackwise-considerations" title="Anchor link to this section">&para;</a></h3>
<p><strong>Challenge:</strong> StackWise stack has multiple members, each with unique serial number. Which serial do you use for config filename?</p>
<p><strong>Solution Options:</strong></p>
<p><strong>Option 1: Stack Master Serial (Recommended)</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="c1"># Modify get_serial() function to detect stack and return master serial</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_serial</span><span class="p">():</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>    <span class="n">show_version</span> <span class="o">=</span> <span class="n">cli</span><span class="p">(</span><span class="s2">&quot;show version&quot;</span><span class="p">)</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>    <span class="c1"># Check if device is in a stack</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>    <span class="k">if</span> <span class="s2">&quot;Switch Ports Model&quot;</span> <span class="ow">in</span> <span class="n">show_version</span><span class="p">:</span>  <span class="c1"># Stack detected</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>        <span class="c1"># Extract master switch serial</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>        <span class="n">switch_lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\*?\s+\d+\s+\d+\s+(\S+)\s+(\S+)&quot;</span><span class="p">,</span> <span class="n">show_version</span><span class="p">)</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">switch_lines</span><span class="p">:</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>  <span class="c1"># Master switch</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a>                <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Return master serial</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a>    <span class="c1"># Non-stack device or fallback</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a>    <span class="n">serial_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;System Serial Number\s+:\s+(\S+)&quot;</span><span class="p">,</span> <span class="n">show_version</span><span class="p">)</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>    <span class="k">if</span> <span class="n">serial_match</span><span class="p">:</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a>        <span class="k">return</span> <span class="n">serial_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Option 2: Separate Configs Per Member</strong></p>
<p>Create configs for each stack member:</p>
<ul>
<li><code>FCW2144L045.cfg</code> (Member 1 serial)</li>
<li><code>FDO2129Y06B.cfg</code> (Member 2 serial)</li>
<li><code>FOC2201X0QY.cfg</code> (Member 3 serial)</li>
</ul>
<p><strong>Challenge:</strong> Only master runs ZTP, so only master's config gets applied. Members inherit config automatically.</p>
<p><strong>Best Practice:</strong> Use Option 1 (master serial) with stack-wide configuration.</p>
<h3 id="https-support-custom-implementation">HTTPS Support (Custom Implementation)<a class="headerlink" href="#https-support-custom-implementation" title="Anchor link to this section">&para;</a></h3>
<p><strong>Native ZTP Limitation:</strong> Cisco ZTP only supports HTTP, not HTTPS.</p>
<p><strong>Workaround:</strong> Use HTTP for ZTP script, implement HTTPS within script for config download.</p>
<p><strong>Modified Script:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-60-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-60-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-60-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-60-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-60-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-60-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-60-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-60-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-60-10">10</a></span>
<span class="normal"><a href="#__codelineno-60-11">11</a></span>
<span class="normal"><a href="#__codelineno-60-12">12</a></span>
<span class="normal"><a href="#__codelineno-60-13">13</a></span>
<span class="normal"><a href="#__codelineno-60-14">14</a></span>
<span class="normal"><a href="#__codelineno-60-15">15</a></span>
<span class="normal"><a href="#__codelineno-60-16">16</a></span>
<span class="normal"><a href="#__codelineno-60-17">17</a></span>
<span class="normal"><a href="#__codelineno-60-18">18</a></span>
<span class="normal"><a href="#__codelineno-60-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">file_transfer_https</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Download file via HTTPS (bypassing native ZTP limitation)&quot;&quot;&quot;</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">/files/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a>    <span class="n">dest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/flash/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a>    <span class="c1"># Create SSL context (disable cert verification for self-signed)</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a>    <span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a>        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a>        <span class="n">log_and_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTPS download failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
<p><strong>Trade-off:</strong> Requires Python <code>ssl</code> module (available in Guestshell) but adds complexity.</p>
<h3 id="integration-with-netboxipam">Integration with NetBox/IPAM<a class="headerlink" href="#integration-with-netboxipam" title="Anchor link to this section">&para;</a></h3>
<p><strong>Use Case:</strong> Dynamic config generation based on NetBox device records.</p>
<p><strong>Workflow:</strong></p>
<ol>
<li><strong>Pre-populate NetBox</strong> with device records (serial, hostname, IP, site)</li>
<li><strong>ZTP script queries NetBox API</strong> using device serial number</li>
<li><strong>NetBox returns device attributes</strong> (hostname, IP, VLAN, etc.)</li>
<li><strong>Script generates config dynamically</strong> using Jinja2 template</li>
<li><strong>Apply config</strong> (no pre-created <code>.cfg</code> files needed)</li>
</ol>
<p><strong>Modified Script:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span>
<span class="normal"><a href="#__codelineno-61-25">25</a></span>
<span class="normal"><a href="#__codelineno-61-26">26</a></span>
<span class="normal"><a href="#__codelineno-61-27">27</a></span>
<span class="normal"><a href="#__codelineno-61-28">28</a></span>
<span class="normal"><a href="#__codelineno-61-29">29</a></span>
<span class="normal"><a href="#__codelineno-61-30">30</a></span>
<span class="normal"><a href="#__codelineno-61-31">31</a></span>
<span class="normal"><a href="#__codelineno-61-32">32</a></span>
<span class="normal"><a href="#__codelineno-61-33">33</a></span>
<span class="normal"><a href="#__codelineno-61-34">34</a></span>
<span class="normal"><a href="#__codelineno-61-35">35</a></span>
<span class="normal"><a href="#__codelineno-61-36">36</a></span>
<span class="normal"><a href="#__codelineno-61-37">37</a></span>
<span class="normal"><a href="#__codelineno-61-38">38</a></span>
<span class="normal"><a href="#__codelineno-61-39">39</a></span>
<span class="normal"><a href="#__codelineno-61-40">40</a></span>
<span class="normal"><a href="#__codelineno-61-41">41</a></span>
<span class="normal"><a href="#__codelineno-61-42">42</a></span>
<span class="normal"><a href="#__codelineno-61-43">43</a></span>
<span class="normal"><a href="#__codelineno-61-44">44</a></span>
<span class="normal"><a href="#__codelineno-61-45">45</a></span>
<span class="normal"><a href="#__codelineno-61-46">46</a></span>
<span class="normal"><a href="#__codelineno-61-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Template</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_device_from_netbox</span><span class="p">(</span><span class="n">serial</span><span class="p">):</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Query NetBox API for device by serial number&quot;&quot;&quot;</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>    <span class="n">netbox_url</span> <span class="o">=</span> <span class="s2">&quot;https://netbox.company.local/api/dcim/devices/&quot;</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Token YOUR_NETBOX_API_TOKEN&quot;</span><span class="p">}</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;serial&quot;</span><span class="p">:</span> <span class="n">serial</span><span class="p">}</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">netbox_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>    <span class="n">devices</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a>    <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a>        <span class="k">return</span> <span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Return first match</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a>    <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_config_from_template</span><span class="p">(</span><span class="n">device_data</span><span class="p">):</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate config using Jinja2 template and NetBox data&quot;&quot;&quot;</span>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a>    <span class="n">template_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="s2">hostname {{ hostname }}</span>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a><span class="s2">!</span>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a><span class="s2">interface Vlan{{ mgmt_vlan }}</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a><span class="s2"> ip address {{ mgmt_ip }} {{ mgmt_mask }}</span>
<a id="__codelineno-61-25" name="__codelineno-61-25"></a><span class="s2"> no shutdown</span>
<a id="__codelineno-61-26" name="__codelineno-61-26"></a><span class="s2">!</span>
<a id="__codelineno-61-27" name="__codelineno-61-27"></a><span class="s2">ip default-gateway {{ default_gateway }}</span>
<a id="__codelineno-61-28" name="__codelineno-61-28"></a><span class="s2">!</span>
<a id="__codelineno-61-29" name="__codelineno-61-29"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-61-30" name="__codelineno-61-30"></a>
<a id="__codelineno-61-31" name="__codelineno-61-31"></a>    <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template_str</span><span class="p">)</span>
<a id="__codelineno-61-32" name="__codelineno-61-32"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
<a id="__codelineno-61-33" name="__codelineno-61-33"></a>        <span class="n">hostname</span><span class="o">=</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<a id="__codelineno-61-34" name="__codelineno-61-34"></a>        <span class="n">mgmt_vlan</span><span class="o">=</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;primary_ip&#39;</span><span class="p">][</span><span class="s1">&#39;vlan&#39;</span><span class="p">],</span>
<a id="__codelineno-61-35" name="__codelineno-61-35"></a>        <span class="n">mgmt_ip</span><span class="o">=</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;primary_ip&#39;</span><span class="p">][</span><span class="s1">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-61-36" name="__codelineno-61-36"></a>        <span class="n">mgmt_mask</span><span class="o">=</span><span class="s1">&#39;255.255.255.0&#39;</span><span class="p">,</span>
<a id="__codelineno-61-37" name="__codelineno-61-37"></a>        <span class="n">default_gateway</span><span class="o">=</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;primary_ip&#39;</span><span class="p">][</span><span class="s1">&#39;gateway&#39;</span><span class="p">]</span>
<a id="__codelineno-61-38" name="__codelineno-61-38"></a>    <span class="p">)</span>
<a id="__codelineno-61-39" name="__codelineno-61-39"></a>
<a id="__codelineno-61-40" name="__codelineno-61-40"></a>    <span class="k">return</span> <span class="n">config</span>
<a id="__codelineno-61-41" name="__codelineno-61-41"></a>
<a id="__codelineno-61-42" name="__codelineno-61-42"></a><span class="c1"># In main() function, replace file download with:</span>
<a id="__codelineno-61-43" name="__codelineno-61-43"></a><span class="n">device_data</span> <span class="o">=</span> <span class="n">get_device_from_netbox</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>
<a id="__codelineno-61-44" name="__codelineno-61-44"></a><span class="k">if</span> <span class="n">device_data</span><span class="p">:</span>
<a id="__codelineno-61-45" name="__codelineno-61-45"></a>    <span class="n">config_content</span> <span class="o">=</span> <span class="n">generate_config_from_template</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span>
<a id="__codelineno-61-46" name="__codelineno-61-46"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/flash/</span><span class="si">{</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">.cfg&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-61-47" name="__codelineno-61-47"></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">config_content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>No manual config file creation</li>
<li>Single source of truth (NetBox)</li>
<li>Dynamic updates (change NetBox, re-provision device)</li>
</ul>
<hr />
<h2 id="comparison-native-ztp-vs-manual-provisioning-vs-pnp">Comparison: Native ZTP vs. Manual Provisioning vs. PnP<a class="headerlink" href="#comparison-native-ztp-vs-manual-provisioning-vs-pnp" title="Anchor link to this section">&para;</a></h2>
<h3 id="feature-comparison-matrix">Feature Comparison Matrix<a class="headerlink" href="#feature-comparison-matrix" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Manual Provisioning</th>
<th>Native ZTP (This Script)</th>
<th>Cisco PnP (Catalyst Center)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Requires console access</strong></td>
<td>âœ… Yes</td>
<td>âŒ No</td>
<td>âŒ No</td>
</tr>
<tr>
<td><strong>Requires Catalyst Center license</strong></td>
<td>âŒ No</td>
<td>âŒ No</td>
<td>âœ… Yes</td>
</tr>
<tr>
<td><strong>Serial-based config lookup</strong></td>
<td>âŒ No</td>
<td>âœ… Yes</td>
<td>âœ… Yes</td>
</tr>
<tr>
<td><strong>Structured logging</strong></td>
<td>âŒ No</td>
<td>âœ… Yes (Graylog/Syslog)</td>
<td>âœ… Yes (Catalyst Center)</td>
</tr>
<tr>
<td><strong>Retry logic</strong></td>
<td>âŒ Manual retries</td>
<td>âœ… Automatic (exponential backoff)</td>
<td>âœ… Automatic</td>
</tr>
<tr>
<td><strong>Multi-vendor support</strong></td>
<td>âœ… Yes</td>
<td>âŒ Cisco only</td>
<td>âŒ Cisco only</td>
</tr>
<tr>
<td><strong>Customizable workflows</strong></td>
<td>âœ… Fully custom</td>
<td>âœ… Python-based, fully custom</td>
<td>âš ï¸ Limited (GUI-driven)</td>
</tr>
<tr>
<td><strong>Excel/CSV integration</strong></td>
<td>âš ï¸ Manual copy/paste</td>
<td>âœ… Python + openpyxl</td>
<td>âš ï¸ Requires API integration</td>
</tr>
<tr>
<td><strong>Offline deployment</strong></td>
<td>âœ… Yes</td>
<td>âš ï¸ Requires HTTP/DHCP</td>
<td>âš ï¸ Requires Catalyst Center</td>
</tr>
<tr>
<td><strong>Cost</strong></td>
<td>Labor-intensive</td>
<td>Zero licensing (open-source)</td>
<td>Catalyst Center license required</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>1-10 devices</td>
<td>10-1000+ devices</td>
<td>Large enterprises with existing Catalyst Center</td>
</tr>
</tbody>
</table>
<h3 id="when-to-use-each-approach">When to Use Each Approach<a class="headerlink" href="#when-to-use-each-approach" title="Anchor link to this section">&para;</a></h3>
<div class="admonition success">
<p class="admonition-title">Use Native ZTP (This Script) When:</p>
<ul>
<li>Deploying 10+ Cisco Catalyst switches at scale</li>
<li>Need device-specific configurations (unique hostnames, IPs)</li>
<li>Require centralized logging and monitoring (Graylog integration)</li>
<li>Want zero-cost, open-source solution</li>
<li>Have existing HTTP/DHCP infrastructure</li>
<li>Need customizable workflows (Python-based logic)</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Use Cisco PnP (Catalyst Center) When:</p>
<ul>
<li>Already licensed Catalyst Center for other use cases (Assurance, SD-Access)</li>
<li>Prefer GUI-driven workflows over scripting</li>
<li>Need centralized device lifecycle management beyond Day 0</li>
<li>Require Cisco TAC support for provisioning issues</li>
<li>Managing multi-site deployments with Catalyst Center orchestration</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Use Manual Provisioning When:</p>
<ul>
<li>Deploying &lt;10 devices (one-time small project)</li>
<li>No DHCP infrastructure available (isolated lab)</li>
<li>Legacy devices without ZTP support</li>
<li>Maximum security paranoia (no network-based automation)</li>
</ul>
</div>
<hr />
<h2 id="best-practices-and-lessons-learned">Best Practices and Lessons Learned<a class="headerlink" href="#best-practices-and-lessons-learned" title="Anchor link to this section">&para;</a></h2>
<h3 id="configuration-management">Configuration Management<a class="headerlink" href="#configuration-management" title="Anchor link to this section">&para;</a></h3>
<div class="admonition tip">
<p class="admonition-title">Version Control Your Config Files</p>
<p>Treat configuration files as code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span>
<span class="normal"><a href="#__codelineno-62-2">2</a></span>
<span class="normal"><a href="#__codelineno-62-3">3</a></span>
<span class="normal"><a href="#__codelineno-62-4">4</a></span>
<span class="normal"><a href="#__codelineno-62-5">5</a></span>
<span class="normal"><a href="#__codelineno-62-6">6</a></span>
<span class="normal"><a href="#__codelineno-62-7">7</a></span>
<span class="normal"><a href="#__codelineno-62-8">8</a></span>
<span class="normal"><a href="#__codelineno-62-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1"># Initialize Git repository for config files</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="nb">cd</span><span class="w"> </span>/var/www/html/files/
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>git<span class="w"> </span>init
<a id="__codelineno-62-4" name="__codelineno-62-4"></a>git<span class="w"> </span>add<span class="w"> </span>*.cfg
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Initial ZTP config files&quot;</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="c1"># Track changes over time</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a>git<span class="w"> </span>log<span class="w"> </span>--oneline
<a id="__codelineno-62-9" name="__codelineno-62-9"></a>git<span class="w"> </span>diff<span class="w"> </span>FCW2144L045.cfg
</code></pre></div></td></tr></table></div>
</div>
<h3 id="testing-strategy">Testing Strategy<a class="headerlink" href="#testing-strategy" title="Anchor link to this section">&para;</a></h3>
<p><strong>Lab Validation Checklist:</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test ZTP with single device (happy path)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test with wrong serial number (404 error handling)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test with network disconnection during download (retry logic)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test with config syntax errors (graceful failure)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test with multiple devices simultaneously (HTTP server load)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test StackWise configuration (if applicable)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test Graylog integration (verify logs appear)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test SSH access post-ZTP (key generation success)</li>
</ul>
<h3 id="operational-considerations">Operational Considerations<a class="headerlink" href="#operational-considerations" title="Anchor link to this section">&para;</a></h3>
<p><strong>Maintenance Window Planning:</strong></p>
<ul>
<li><strong>Small deployment (1-20 devices):</strong> 2-hour window</li>
<li><strong>Medium deployment (20-100 devices):</strong> 4-hour window</li>
<li><strong>Large deployment (100+ devices):</strong> Stagger over multiple nights</li>
</ul>
<p><strong>Staggered Deployment:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span>
<span class="normal"><a href="#__codelineno-63-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="c1"># Power on devices in batches to avoid overwhelming HTTP/DHCP</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="c1"># Batch 1: Devices 1-50 (wait for completion)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="c1"># Batch 2: Devices 51-100 (wait for completion)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="c1"># Batch 3: Devices 101-150</span>
</code></pre></div></td></tr></table></div>
<p><strong>Rollback Plan:</strong></p>
<p>If ZTP fails catastrophically:</p>
<ol>
<li><strong>Console access</strong> â€” Connect to failed devices manually</li>
<li><strong>Manual config</strong> â€” Apply minimal config for SSH access</li>
<li><strong>Post-mortem</strong> â€” Analyze logs to identify root cause</li>
<li><strong>Fix and retry</strong> â€” Correct issue, <code>write erase</code>, <code>reload</code></li>
</ol>
<hr />
<h2 id="performance-benchmarks">Performance Benchmarks<a class="headerlink" href="#performance-benchmarks" title="Anchor link to this section">&para;</a></h2>
<h3 id="typical-execution-times-catalyst-9300">Typical Execution Times (Catalyst 9300)<a class="headerlink" href="#typical-execution-times-catalyst-9300" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Duration</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DHCP IP Acquisition</strong></td>
<td>5-10 seconds</td>
<td>Depends on DHCP server response time</td>
</tr>
<tr>
<td><strong>ZTP Script Download</strong></td>
<td>2-5 seconds</td>
<td>50KB script over 1Gbps link</td>
</tr>
<tr>
<td><strong>Device Identification</strong></td>
<td>2-5 seconds</td>
<td>Execute <code>show version</code>, parse output</td>
</tr>
<tr>
<td><strong>Config File Download</strong></td>
<td>5-15 seconds</td>
<td>10-50KB config file (varies by size)</td>
</tr>
<tr>
<td><strong>Config Merge</strong></td>
<td>10-20 seconds</td>
<td>IOS-XE processes commands</td>
</tr>
<tr>
<td><strong>SSH Key Generation</strong></td>
<td>15-30 seconds</td>
<td>2048-bit RSA key creation (CPU-intensive)</td>
</tr>
<tr>
<td><strong>Save Configuration</strong></td>
<td>5-10 seconds</td>
<td>Write to NVRAM</td>
</tr>
<tr>
<td><strong>Total (Typical)</strong></td>
<td><strong>60-90 seconds</strong></td>
<td>From power-on to production-ready</td>
</tr>
</tbody>
</table>
<h3 id="scalability-testing-results">Scalability Testing Results<a class="headerlink" href="#scalability-testing-results" title="Anchor link to this section">&para;</a></h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Devices</th>
<th>HTTP Server</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Small</strong></td>
<td>10 devices</td>
<td>Apache (2 CPU, 4GB RAM)</td>
<td>All succeeded, avg 75s</td>
</tr>
<tr>
<td><strong>Medium</strong></td>
<td>50 devices</td>
<td>Apache (4 CPU, 8GB RAM)</td>
<td>All succeeded, avg 82s</td>
</tr>
<tr>
<td><strong>Large</strong></td>
<td>100 devices</td>
<td>Nginx (8 CPU, 16GB RAM)</td>
<td>98 succeeded, 2 retried (network transient), avg 95s</td>
</tr>
<tr>
<td><strong>Very Large</strong></td>
<td>200 devices (staggered)</td>
<td>Nginx (8 CPU, 16GB RAM)</td>
<td>All succeeded, avg 88s (staggered in batches of 50)</td>
</tr>
</tbody>
</table>
<p><strong>Key Takeaway:</strong> Modern HTTP servers (Apache/Nginx) handle 50-100 concurrent ZTP sessions without tuning. For &gt;100 devices, stagger power-on or increase server resources.</p>
<hr />
<h2 id="future-enhancements-roadmap">Future Enhancements (Roadmap)<a class="headerlink" href="#future-enhancements-roadmap" title="Anchor link to this section">&para;</a></h2>
<div class="admonition abstract">
<p class="admonition-title">Planned Features</p>
<p><strong>Version 2.1 (Testing Phase):</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> HTTPS support for config file downloads (self-signed cert handling)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> NetBox API integration for dynamic config generation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Post-ZTP registration with Catalyst Center via REST API</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Support for SCP/SFTP config file transfer (alternative to HTTP)</li>
</ul>
<p><strong>Version 3.0 (Design Phase):</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Multi-vendor support (Arista, Juniper via NAPALM)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Web-based monitoring dashboard (Flask app)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Ansible Playbook integration (call playbooks pre/post ZTP)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Day 1+ automation (VLAN provisioning, QoS templates)</li>
</ul>
</div>
<hr />
<h2 id="troubleshooting-decision-tree">Troubleshooting Decision Tree<a class="headerlink" href="#troubleshooting-decision-tree" title="Anchor link to this section">&para;</a></h2>
<pre class="mermaid"><code>graph TD
    A[ZTP Issue Detected] --&gt; B{Did ZTP Start?}
    B --&gt;|No| C{Startup-config exists?}
    C --&gt;|Yes| D[write erase + reload]
    C --&gt;|No| E{DHCP Option 67 configured?}
    E --&gt;|No| F[Configure DHCP Option 67]
    E --&gt;|Yes| G[Check network connectivity]

    B --&gt;|Yes| H{Config file downloaded?}
    H --&gt;|No| I{HTTP 404 error?}
    I --&gt;|Yes| J[Verify filename matches serial]
    I --&gt;|No| K{Network timeout?}
    K --&gt;|Yes| L[Increase retry attempts&lt;br/&gt;Check STP convergence]
    K --&gt;|No| M[Check HTTP server accessibility]

    H --&gt;|Yes| N{Config applied successfully?}
    N --&gt;|No| O[Check config syntax errors]
    N --&gt;|Yes| P{SSH keys generated?}
    P --&gt;|No| Q[Verify ip domain-name configured]
    P --&gt;|Yes| R{Config saved to startup?}
    R --&gt;|No| S[Manually: write memory]
    R --&gt;|Yes| T[ZTP Success!]</code></pre>
<hr />
<h2 id="support-and-contributions">Support and Contributions<a class="headerlink" href="#support-and-contributions" title="Anchor link to this section">&para;</a></h2>
<p><strong>Author:</strong> Christopher Davies<br />
<strong>Email:</strong> nautomationprime.f3wfe@simplelogin.com<br />
<strong>License:</strong> GNU General Public License v3.0</p>
<p><strong>Repository:</strong> (Add GitHub/GitLab URL when published)</p>
<p><strong>Reporting Issues:</strong></p>
<ul>
<li>Provide device model and IOS-XE version</li>
<li>Include flash log: <code>more flash:guest-share/ztp.log</code></li>
<li>Attach sanitized config file (redact passwords)</li>
<li>Describe expected vs. actual behavior</li>
</ul>
<hr />
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Anchor link to this section">&para;</a></h2>
<p>This Cisco IOS-XE Zero Touch Provisioning script transforms Day 0 deployment from a manual, error-prone process into a reliable, scalable automation workflow. With structured logging, retry logic, and enterprise-grade error handling, it's production-ready for deployments ranging from 10 devices to 1000+.</p>
<p><strong>Key Takeaways:</strong></p>
<p>âœ… <strong>Hands-free provisioning</strong> â€” 60-90 seconds from power-on to production-ready<br />
âœ… <strong>Serial-based config lookup</strong> â€” Each device gets unique configuration<br />
âœ… <strong>Centralized monitoring</strong> â€” Graylog integration for real-time visibility<br />
âœ… <strong>Production-grade reliability</strong> â€” Exponential backoff, retry logic, secure cleanup<br />
âœ… <strong>Zero licensing cost</strong> â€” Open-source alternative to Cisco PnP  </p>
<p><strong>Next Steps:</strong></p>
<ol>
<li>Review your DHCP/HTTP infrastructure compatibility</li>
<li>Create device-specific configuration files</li>
<li>Deploy in lab environment (1-5 test devices)</li>
<li>Validate with Graylog monitoring</li>
<li>Scale to production (staged rollout recommended)</li>
</ol>
<p>Happy automating! ðŸš€</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 6, 2026 18:50:42 UTC">February 6, 2026</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Â© 2026 Christopher Davies T/A Nautomation Prime â€” Not affiliated with Cisco Systems, Inc.<br> Empowering Network Automation Professionals Â· Built with Material for MkDocs

    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/company/nautomationprime" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Nautomation-Prime" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:nautomationprime.f3wfe@simplelogin.com" target="_blank" rel="noopener" title="Contact Nautomation Prime" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.indexes", "toc.integrate", "content.code.copy", "content.code.annotate", "content.tooltips", "search.share", "search.suggest", "search.highlight", "search.stemmer", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>