
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive guide to a modular, production-ready CDP network discovery tool with YAML configuration, jump server support, DNS enrichment, and professional Excel reporting.">
      
      
        <meta name="author" content="Christopher Davies">
      
      
        <link rel="canonical" href="https://www.nautomationprime.io/deep-dives/cdp-audit/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../access-switch-audit/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>CDP Network Audit Tool - Deep Dive - Nautomation Prime</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deep-dive-cdp-network-audit-tool" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nautomation Prime" class="md-header__button md-logo" aria-label="Nautomation Prime" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nautomation Prime
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CDP Network Audit Tool - Deep Dive
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Nautomation-Prime/Nautomation-Prime.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../services/" class="md-tabs__link">
        
  
  
    
  
  Services

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Technical Resources

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../scripts/" class="md-tabs__link">
        
  
  
    
  
  Script Library

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../coming-soon/" class="md-tabs__link">
          
  
  
    
  
  Coming Soon

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../legal/privacy-policy/" class="md-tabs__link">
          
  
  
    
  
  Legal

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nautomation Prime" class="md-nav__button md-logo" aria-label="Nautomation Prime" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Nautomation Prime
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Nautomation-Prime/Nautomation-Prime.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Technical Resources
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Technical Resources
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    CDP Network Audit
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    CDP Network Audit
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#production-ready-python-automation-built-for-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        "Production-Ready Python Automation, Built for Scale."
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#highlights" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚ú® Highlights
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-nautomation-prime-philosophy-in-action" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ The Nautomation Prime Philosophy in Action
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ The Nautomation Prime Philosophy in Action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principle-1-modular-maintainable-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principle 1: Modular, Maintainable Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principle-2-configuration-as-code-the-right-way" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principle 2: Configuration as Code (the Right Way)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principle-3-production-hardened-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principle 3: Production-Hardened Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principle-4-vendor-neutral-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principle 4: Vendor-Neutral Foundation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository-architecture-modular-package-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        üß± Repository Architecture (Modular Package Structure)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        üì¶ Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üì¶ Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tested-devices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tested Devices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#required-support-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Required Support Files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚öôÔ∏è Configuration System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="‚öôÔ∏è Configuration System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-1-configyaml-primary-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 1: config.yaml (Primary Configuration)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-environment-variables-runtime-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 2: Environment Variables (Runtime Overrides)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-3-config-loader-config_loaderpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 3: Config Loader (config_loader.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        üèóÔ∏è Technical Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üèóÔ∏è Technical Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architectural-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Principles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-interaction-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Interaction Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-entry-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Package Entry Points
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credentials-model-credentialspy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîê Credentials Model (credentials.py)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîê Credentials Model (credentials.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-two-credential-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Two-Credential Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-credential-management-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Credential Management Matters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentialmanager__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        CredentialManager.__init__()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_read_win_credtarget_name-str-tuplestr-str" class="md-nav__link">
    <span class="md-ellipsis">
      
        _read_win_cred(target_name: str) -&gt; Tuple[str, str]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_write_win_credtarget-str-username-str-password-str-bool" class="md-nav__link">
    <span class="md-ellipsis">
      
        _write_win_cred(target: str, username: str, password: str) -&gt; bool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_secret_with_fallback-tuplestr-str" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_secret_with_fallback(...) -&gt; Tuple[str, str]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collect_all_credentials-dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        collect_all_credentials() -&gt; dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validators-module-validatorspy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîç Validators Module (validators.py)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîç Validators Module (validators.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-pre-flight-validation-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Pre-Flight Validation Matters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Functions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discovery-module-discoverypy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üåê Discovery Module (discovery.py)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üåê Discovery Module (discovery.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-parallel-discovery-is-essential" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Parallel Discovery is Essential
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-architecture_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-safe-data-accumulators" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thread-Safe Data Accumulators
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jump-server-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jump Server Support
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jump Server Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_paramiko_jump_client-paramikosshclient" class="md-nav__link">
    <span class="md-ellipsis">
      
        _paramiko_jump_client(...) -&gt; paramiko.SSHClient
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_netmiko_via_jump-connecthandler" class="md-nav__link">
    <span class="md-ellipsis">
      
        _netmiko_via_jump(...) -&gt; ConnectHandler
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-command-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Device Command Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Device Command Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_device_commands-tuplestr-str" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_device_commands(...) -&gt; Tuple[str, str]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parsing-and-intelligent-queueing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parsing and Intelligent Queueing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parsing and Intelligent Queueing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse_outputs_and_enqueue_neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_outputs_and_enqueue_neighbors(...)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-parse-device-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Parse Device Context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-parse-cdp-neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Parse CDP Neighbors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-apply-queueing-heuristic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Apply Queueing Heuristic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-thread-pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        Worker Thread Pool
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worker Thread Pool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discover_worker-none" class="md-nav__link">
    <span class="md-ellipsis">
      
        discover_worker() -&gt; None
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discovery-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Discovery Orchestration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Discovery Orchestration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discover_from_seedsseeds-liststr-none" class="md-nav__link">
    <span class="md-ellipsis">
      
        discover_from_seeds(seeds: List[str]) -&gt; None
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Resolution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DNS Resolution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resolve_dns_parallel-none" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_dns_parallel() -&gt; None
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excel-reporter-module-excel_reporterpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìä Excel Reporter Module (excel_reporter.py)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä Excel Reporter Module (excel_reporter.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-professional-reporting-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Professional Reporting Matters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-architecture_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-driven-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template-Driven Approach
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-copy-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Copy Template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-stamp-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Stamp Metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-append-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Append Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-module-clipy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéõÔ∏è CLI Module (cli.py)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéõÔ∏è CLI Module (cli.py)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main Workflow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-entry-point-__main__py" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚ö° Package Entry Point (__main__.py)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-access-app_configpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üõ†Ô∏è Configuration Access (app_config.py)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-setup-logging_setuppy" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìù Logging Setup (logging_setup.py)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start-using-the-launcher-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        üöÄ Quick Start: Using the Launcher (Recommended)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üöÄ Quick Start: Using the Launcher (Recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-use-the-launcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Use the Launcher?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-runbat" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using run.bat
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-the-launcher-does" class="md-nav__link">
    <span class="md-ellipsis">
      
        What the Launcher Does
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-run-interactive-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        üöÄ How to Run (Interactive Flow)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-gets-collected" class="md-nav__link">
    <span class="md-ellipsis">
      
        üß™ What Gets Collected
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üß™ What Gets Collected">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discovery-heuristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Discovery Heuristics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jump-server-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        üåê Jump Server Behavior
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excel-report-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìä Excel Report Output
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä Excel Report Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sheets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sheets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#columns-in-audit-data-rows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Columns in Audit (Data Rows)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîë Key Design Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîë Key Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-modular-package-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Modular Package Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-centralized-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Centralized Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-thread-safe-data-accumulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Thread-Safe Data Accumulation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-graceful-worker-shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Graceful Worker Shutdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-retry-with-fallback-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Retry with Fallback Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-6-resource-cleanup-in-finally" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 6: Resource Cleanup in Finally
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-7-template-driven-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 7: Template-Driven Reporting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-8-fail-fast-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 8: Fail-Fast Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        üß∞ Logging
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errors-retry-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        üßØ Errors &amp; Retry Behavior
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìà Performance
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîí Security Considerations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exit-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚ùå Exit Codes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚úÖ Example Session
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        üõ†Ô∏è Customization Points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéì Learning Outcomes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribution-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        üöÄ Distribution &amp; Execution
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository-downloads" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìÅ Repository &amp; Downloads
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìà Performance Tuning
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        üé¨ Next Steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìã License
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    <span class="md-ellipsis">
      
        üë§ Author
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../access-switch-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Switch Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Script Library
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coming-soon/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Coming Soon
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Coming Soon
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coming-soon/Cisco%20IOS-XE%20Zero%20Touch%20Provisioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cisco IOS-XE Zero Touch Provisioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coming-soon/IOS-XE%20Software%20Upgrade%20Orchestrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IOS-XE Upgrade Orchestrator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Legal
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Legal
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/privacy-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Privacy Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/terms-of-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terms of Use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/licensing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Licensing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/disclaimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disclaimer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../legal/brand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Brand & Logo Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
      
        <span class="md-tag">CDP</span>
      
    
      
      
      
      
        <span class="md-tag">Deep Dive</span>
      
    
      
      
      
      
        <span class="md-tag">Excel</span>
      
    
      
      
      
      
        <span class="md-tag">Jump Server</span>
      
    
      
      
      
      
        <span class="md-tag">Modular Design</span>
      
    
      
      
      
      
        <span class="md-tag">Network Discovery</span>
      
    
      
      
      
      
        <span class="md-tag">TextFSM</span>
      
    
      
      
      
      
        <span class="md-tag">Threading</span>
      
    
      
      
      
      
        <span class="md-tag">YAML Configuration</span>
      
    
  </nav>


  
  


<h1 id="deep-dive-cdp-network-audit-tool">Deep Dive: CDP Network Audit Tool<a class="headerlink" href="#deep-dive-cdp-network-audit-tool" title="Anchor link to this section">&para;</a></h1>
<h2 id="production-ready-python-automation-built-for-scale">"Production-Ready Python Automation, Built for Scale."<a class="headerlink" href="#production-ready-python-automation-built-for-scale" title="Anchor link to this section">&para;</a></h2>
<p>A <strong>modular, enterprise-grade</strong> network discovery utility that crawls Cisco network topologies via <strong>Cisco Discovery Protocol (CDP)</strong>. It connects (optionally through an SSH jump/bastion host), collects <code>show cdp neighbors detail</code> and <code>show version</code>, parses outputs with <strong>TextFSM</strong>, enriches with <strong>DNS resolution</strong>, and writes structured <strong>Excel reports</strong> from pre-formatted templates. </p>
<p><strong>What's New:</strong> The tool has undergone a <strong>complete architectural restructure</strong> ‚Äî migrated from a monolithic script to a <strong>modular Python package</strong> with YAML-based configuration, dedicated modules for each concern, and enhanced maintainability for enterprise deployments.</p>
<p><a class="md-button md-button--primary" href="https://github.com/Nautomation-Prime/Cisco_CDP_Network_Audit"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></span> View Source Code on GitHub</a></p>
<hr />
<h2 id="highlights">‚ú® Highlights<a class="headerlink" href="#highlights" title="Anchor link to this section">&para;</a></h2>
<ul>
<li><strong>Modular Python package</strong> ‚Äî Clean separation of concerns with <code>cdp_audit/</code> package structure</li>
<li><strong>Package-based execution</strong> ‚Äî Run as <code>python -m cdp_audit</code> for proper module resolution</li>
<li><strong>YAML configuration</strong> ‚Äî Human-readable <code>config.yaml</code> for easy customization without touching code</li>
<li><strong>Parallel discovery</strong> with a worker pool (configurable via environment variables or YAML config)</li>
<li><strong>Two-tier authentication</strong> ‚Äî Primary user first, then customizable fallback user if primary fails</li>
<li><strong>Jump server / bastion support</strong> ‚Äî Paramiko channel + Netmiko sock for secure proxy connections</li>
<li><strong>DNS enrichment</strong> ‚Äî Parallel DNS resolution for discovered hostnames</li>
<li><strong>Professional Excel reporting</strong> ‚Äî Template-driven reports with multiple sheets and metadata stamping</li>
<li><strong>Comprehensive validation</strong> ‚Äî Pre-flight checks for templates, Excel files, and configuration</li>
<li><strong>Dedicated modules</strong> ‚Äî Each module has a single, well-defined responsibility</li>
</ul>
<hr />
<h2 id="the-nautomation-prime-philosophy-in-action">üéØ The Nautomation Prime Philosophy in Action<a class="headerlink" href="#the-nautomation-prime-philosophy-in-action" title="Anchor link to this section">&para;</a></h2>
<p>Before diving into the code, understand how every design decision reflects our three core principles:</p>
<h3 id="principle-1-modular-maintainable-architecture"><strong>Principle 1: Modular, Maintainable Architecture</strong><a class="headerlink" href="#principle-1-modular-maintainable-architecture" title="Anchor link to this section">&para;</a></h3>
<p>Every component has a <strong>single, clear responsibility</strong>. Credentials are handled by <code>credentials.py</code>, discovery by <code>discovery.py</code>, validation by <code>validators.py</code>. This isn't just good practice ‚Äî it's <strong>essential for team collaboration and long-term maintenance</strong>. When a bug appears in credential handling, you know exactly where to look.</p>
<p>The entire application is now a <strong>proper Python package</strong> (<code>cdp_audit/</code>) with:</p>
<ul>
<li>Clean imports (<code>from cdp_audit.credentials import CredentialManager</code>)</li>
<li>Package-level execution (<code>python -m cdp_audit</code>)</li>
<li>Isolated concerns (each module can be tested independently)</li>
</ul>
<h3 id="principle-2-configuration-as-code-the-right-way"><strong>Principle 2: Configuration as Code (the Right Way)</strong><a class="headerlink" href="#principle-2-configuration-as-code-the-right-way" title="Anchor link to this section">&para;</a></h3>
<p>Configuration migrated from hardcoded Python to <strong>human-readable YAML</strong>. Network engineers can customize worker threads, timeouts, and credential targets <strong>without touching Python code</strong>. Version control tracks configuration changes. Rollbacks are simple: <code>git revert</code>.</p>
<p>The <code>config_loader.py</code> module provides a clean interface between YAML configuration and Python code, with type safety and validation built in.</p>
<h3 id="principle-3-production-hardened-design"><strong>Principle 3: Production-Hardened Design</strong><a class="headerlink" href="#principle-3-production-hardened-design" title="Anchor link to this section">&para;</a></h3>
<p>You'll notice patterns like thread locks, exception handling, retry logic, comprehensive validation, and graceful cleanup. These aren't "nice to have" ‚Äî they're <strong>essential for running automation on critical infrastructure</strong> without surprises at 3 AM.</p>
<p>The new modular structure makes these patterns <strong>easier to implement and maintain</strong>:</p>
<ul>
<li>Validators run before discovery starts (fail-fast)</li>
<li>Logging is centralized in <code>logging_setup.py</code></li>
<li>Configuration access is centralized in <code>app_config.py</code></li>
<li>Each module handles its own error scenarios</li>
</ul>
<h3 id="principle-4-vendor-neutral-foundation"><strong>Principle 4: Vendor-Neutral Foundation</strong><a class="headerlink" href="#principle-4-vendor-neutral-foundation" title="Anchor link to this section">&para;</a></h3>
<p>Built on industry-standard libraries: <strong>Netmiko</strong> (SSH connection handling), <strong>Paramiko</strong> (SSH tunnelling), <strong>Pandas &amp; OpenPyXL</strong> (Excel reporting), <strong>TextFSM</strong> (parsing), <strong>PyYAML</strong> (configuration). Your skills remain portable.</p>
<hr />
<h2 id="repository-architecture-modular-package-structure">üß± Repository Architecture (Modular Package Structure)<a class="headerlink" href="#repository-architecture-modular-package-structure" title="Anchor link to this section">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>.
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>‚îú‚îÄ‚îÄ cdp_audit/                   # Main Python package
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>‚îÇ   ‚îú‚îÄ‚îÄ __init__.py              # Package initialization and version
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ __main__.py              # Package entry point (python -m cdp_audit)
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>‚îÇ   ‚îú‚îÄ‚îÄ app_config.py            # Centralized configuration access
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>‚îÇ   ‚îú‚îÄ‚îÄ cli.py                   # Command-line interface and main flow
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>‚îÇ   ‚îú‚îÄ‚îÄ credentials.py           # Credential management (Cred Manager integration)
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>‚îÇ   ‚îú‚îÄ‚îÄ discovery.py             # Network discovery engine (threading, CDP crawl)
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>‚îÇ   ‚îú‚îÄ‚îÄ excel_reporter.py        # Excel report generation (template-driven)
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>‚îÇ   ‚îú‚îÄ‚îÄ logging_setup.py         # Logging configuration bootstrap
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>‚îÇ   ‚îî‚îÄ‚îÄ validators.py            # Pre-flight validation (templates, config)
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>‚îú‚îÄ‚îÄ ProgramFiles/
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>‚îÇ   ‚îú‚îÄ‚îÄ textfsm/
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cisco_ios_show_cdp_neighbors_detail.textfsm
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cisco_ios_show_version.textfsm
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>‚îÇ   ‚îî‚îÄ‚îÄ config_files/
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>‚îÇ       ‚îú‚îÄ‚îÄ config_loader.py     # YAML config loader class
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>‚îÇ       ‚îú‚îÄ‚îÄ config.py            # Backward compatibility wrapper
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>‚îÇ       ‚îú‚îÄ‚îÄ 1 - CDP Network Audit _ Template.xlsx
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>‚îÇ       ‚îî‚îÄ‚îÄ logging.conf         # Optional logging configuration
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>‚îú‚îÄ‚îÄ config.yaml                  # Main configuration file (YAML)
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>‚îú‚îÄ‚îÄ requirements.txt             # Python dependencies
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>‚îú‚îÄ‚îÄ run.bat                      # Windows launcher script
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>‚îî‚îÄ‚îÄ portable_env/                # Portable Python environment (optional)
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>Key Architectural Change:</strong> Migrated from monolithic <code>main.py</code> to a <strong>modular package structure</strong> (<code>cdp_audit/</code>) with separation of concerns, enabling easier testing, maintenance, and team collaboration.</p>
<p><strong>Package Execution:</strong> The tool now runs as <code>python -m cdp_audit</code>, which invokes <code>cdp_audit/__main__.py</code>, ensuring proper module resolution and import paths.</p>
</blockquote>
<hr />
<h2 id="requirements">üì¶ Requirements<a class="headerlink" href="#requirements" title="Anchor link to this section">&para;</a></h2>
<ul>
<li><strong>Python:</strong> 3.8+</li>
<li><strong>Python packages:</strong> <code>pandas</code>, <code>openpyxl</code>, <code>textfsm</code>, <code>paramiko</code>, <code>netmiko</code>, <code>pyyaml</code></li>
<li><strong>(Windows only, optional)</strong> <code>pywin32</code> for Windows Credential Manager integration</li>
</ul>
<p>Install in one go:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>openpyxl<span class="w"> </span>textfsm<span class="w"> </span>paramiko<span class="w"> </span>netmiko<span class="w"> </span>pyyaml<span class="w"> </span>pywin32
</code></pre></div></td></tr></table></div>
<h3 id="tested-devices">Tested Devices<a class="headerlink" href="#tested-devices" title="Anchor link to this section">&para;</a></h3>
<p>This tool has been tested and verified on the following Cisco IOS and IOS-XE platforms:</p>
<ul>
<li><strong>Catalyst 9200 Series</strong></li>
<li><strong>Catalyst 3650 Series</strong></li>
<li><strong>Catalyst 3650C</strong></li>
<li><strong>Catalyst 3650CG</strong></li>
<li><strong>Catalyst 3650CX</strong></li>
<li><strong>Catalyst 2960X Series</strong></li>
<li><strong>Catalyst 2960 Series</strong></li>
</ul>
<blockquote>
<p><strong>Note:</strong> The tool should work with any Cisco IOS/IOS-XE device that supports CDP and the required show commands. The devices listed above have been explicitly tested and validated.</p>
</blockquote>
<h3 id="required-support-files">Required Support Files<a class="headerlink" href="#required-support-files" title="Anchor link to this section">&para;</a></h3>
<ul>
<li><strong>TextFSM templates:</strong></li>
<li><code>ProgramFiles/textfsm/cisco_ios_show_cdp_neighbors_detail.textfsm</code></li>
<li><code>ProgramFiles/textfsm/cisco_ios_show_version.textfsm</code></li>
<li><strong>Excel template:</strong></li>
<li><code>ProgramFiles/config_files/1 - CDP Network Audit _ Template.xlsx</code></li>
</ul>
<p>The <code>validators.py</code> module validates presence of these files at startup and exits if any are missing.</p>
<hr />
<h2 id="configuration-system">‚öôÔ∏è Configuration System<a class="headerlink" href="#configuration-system" title="Anchor link to this section">&para;</a></h2>
<p>The tool uses a <strong>modern, layered configuration system</strong> with three configuration sources (in priority order):</p>
<h3 id="layer-1-configyaml-primary-configuration">Layer 1: config.yaml (Primary Configuration)<a class="headerlink" href="#layer-1-configyaml-primary-configuration" title="Anchor link to this section">&para;</a></h3>
<p><strong>All default settings are defined in a human-readable YAML file</strong> at the project root.</p>
<p>The <code>config.yaml</code> file provides version-control-friendly configuration that <strong>non-programmers can edit</strong>. Settings are loaded by <code>ProgramFiles/config_files/config_loader.py</code>, which provides the <code>Config</code> class with type-safe property accessors and validation.</p>
<p><strong>Network Connection Settings:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span>
<span class="normal"><a href="#__codelineno-2-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">network</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">jump_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.0.2.10&quot;</span><span class="w">     </span><span class="c1"># Default jump/bastion server (empty = direct)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">device_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cisco_ios&quot;</span><span class="w">    </span><span class="c1"># Netmiko device type</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">ssh_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span><span class="w">                </span><span class="c1"># SSH port for connections</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">default_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">           </span><span class="c1"># Max concurrent worker threads</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="nt">default_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">         </span><span class="c1"># SSH/auth/read timeouts (seconds)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="nt">max_retry_attempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">       </span><span class="c1"># Connection retries per device</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="nt">dns_max_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">         </span><span class="c1"># Max DNS resolution threads</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="nt">dns_min_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w">          </span><span class="c1"># Min DNS resolution threads</span>
</code></pre></div></td></tr></table></div>
<p><strong>Credential Settings:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">credentials</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nt">cred_target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MyApp/ADM&quot;</span><span class="w">         </span><span class="c1"># Primary credential target (Windows Credential Manager)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">  </span><span class="nt">alt_creds</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MyApp/Answer&quot;</span><span class="w">        </span><span class="c1"># Fallback credential target</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nt">cdp_fallback_username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;answer&quot;</span><span class="w">  </span><span class="c1"># Fallback username (customizable)</span>
</code></pre></div></td></tr></table></div>
<p><strong>File Paths (Auto-Resolved from Project Root):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nt">file_paths</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">base_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w">  </span><span class="c1"># Project root</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="nt">cdp_template</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ProgramFiles/textfsm/cisco_ios_show_cdp_neighbors_detail.textfsm&quot;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="nt">ver_template</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ProgramFiles/textfsm/cisco_ios_show_version.textfsm&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="nt">excel_template</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ProgramFiles/config_files/1</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">CDP</span><span class="nv"> </span><span class="s">Network</span><span class="nv"> </span><span class="s">Audit</span><span class="nv"> </span><span class="s">_</span><span class="nv"> </span><span class="s">Template.xlsx&quot;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">  </span><span class="nt">logging_config</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ProgramFiles/config_files/logging.conf&quot;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Excel Report Customization:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nt">excel</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="nt">sheets</span><span class="p">:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nt">audit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Audit&quot;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DNS</span><span class="nv"> </span><span class="s">Resolved&quot;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nt">auth_errors</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Authentication</span><span class="nv"> </span><span class="s">Errors&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nt">conn_errors</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Connection</span><span class="nv"> </span><span class="s">Errors&quot;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">  </span><span class="nt">metadata_cells</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="nt">site_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;B4&quot;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;B5&quot;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="nt">time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;B6&quot;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="nt">primary_seed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;B7&quot;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">    </span><span class="nt">secondary_seed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;B8&quot;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">  </span><span class="nt">data_start_rows</span><span class="p">:</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="nt">audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span><span class="w">        </span><span class="c1"># Data appends starting at row 12</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="nt">other</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">         </span><span class="c1"># DNS/errors start at row 2</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why YAML Configuration?</strong></p>
<div class="admonition success">
<p class="admonition-title">YAML Benefits</p>
<ul>
<li><strong>Human-Readable</strong>: Edit settings without Python knowledge</li>
<li><strong>Version Control Friendly</strong>: Plain text, works seamlessly with Git</li>
<li><strong>Hierarchical Structure</strong>: Logical grouping (network/credentials/paths)</li>
<li><strong>Comment Support</strong>: Inline documentation stays with config</li>
<li><strong>Type Safety</strong>: Config loader validates and provides defaults</li>
<li><strong>Data-Only</strong>: No code execution (safer than Python config files)</li>
<li><strong>Team Collaboration</strong>: Network engineers can customize without developer involvement</li>
</ul>
</div>
<h3 id="layer-2-environment-variables-runtime-overrides">Layer 2: Environment Variables (Runtime Overrides)<a class="headerlink" href="#layer-2-environment-variables-runtime-overrides" title="Anchor link to this section">&para;</a></h3>
<p>Environment variables <strong>override</strong> config.yaml settings at runtime:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">config.yaml Default</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>CDP_LIMIT</code></td>
<td style="text-align: left;">Max concurrent worker threads</td>
<td style="text-align: left;">10</td>
</tr>
<tr>
<td style="text-align: left;"><code>CDP_TIMEOUT</code></td>
<td style="text-align: left;">SSH/auth/read timeouts (seconds)</td>
<td style="text-align: left;">10</td>
</tr>
<tr>
<td style="text-align: left;"><code>CDP_JUMP_SERVER</code></td>
<td style="text-align: left;">Jump host (IP/hostname). Empty = direct</td>
<td style="text-align: left;"><code>""</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>CDP_PRIMARY_CRED_TARGET</code></td>
<td style="text-align: left;">CredMan target for primary creds</td>
<td style="text-align: left;"><code>MyApp/ADM</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>CDP_ANSWER_CRED_TARGET</code></td>
<td style="text-align: left;">CredMan target for fallback creds</td>
<td style="text-align: left;"><code>MyApp/Answer</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>LOGGING_CONFIG</code></td>
<td style="text-align: left;">Path to INI logging config</td>
<td style="text-align: left;"><code>ProgramFiles/config_files/logging.conf</code></td>
</tr>
</tbody>
</table>
<p><strong>Example (Windows PowerShell):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c"># Override YAML defaults for this session</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nv">$env:CDP_LIMIT</span> <span class="p">=</span> <span class="s2">&quot;20&quot;</span>                   <span class="c"># Use 20 concurrent workers</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nv">$env:CDP_TIMEOUT</span> <span class="p">=</span> <span class="s2">&quot;15&quot;</span>                 <span class="c"># 15-second timeouts</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="nv">$env:CDP_JUMP_SERVER</span> <span class="p">=</span> <span class="s2">&quot;bastion.corp.local&quot;</span>  <span class="c"># Use this jump server</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="nv">$env:CDP_PRIMARY_CRED_TARGET</span> <span class="p">=</span> <span class="s2">&quot;MyApp/NetworkAdmin&quot;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="nv">$env:CDP_ANSWER_CRED_TARGET</span> <span class="p">=</span> <span class="s2">&quot;MyApp/LocalAdmin&quot;</span>
</code></pre></div></td></tr></table></div>
<p><strong>When to Use Environment Variables:</strong></p>
<ul>
<li><strong>Testing</strong>: Temporary overrides without modifying config.yaml</li>
<li><strong>Multi-Environment Deployments</strong>: Different settings for dev/staging/prod</li>
<li><strong>CI/CD Pipelines</strong>: Dynamic configuration from build systems</li>
<li><strong>Per-Instance Customization</strong>: Running multiple instances with different settings</li>
</ul>
<h3 id="layer-3-config-loader-config_loaderpy">Layer 3: Config Loader (<code>config_loader.py</code>)<a class="headerlink" href="#layer-3-config-loader-config_loaderpy" title="Anchor link to this section">&para;</a></h3>
<p>The <code>Config</code> class handles all configuration access with validation:</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Automatic Search</strong>: Looks for <code>config.yaml</code> in project root, module directory, and current directory</li>
<li><strong>Environment Variable Priority</strong>: Env vars override YAML settings</li>
<li><strong>Type Conversion</strong>: Automatically converts strings to int/bool/Path</li>
<li><strong>Default Values</strong>: Provides sensible defaults if YAML keys missing</li>
<li><strong>Validation</strong>: Fails fast if config file is malformed or missing required files</li>
<li><strong>Property-Based Access</strong>: Use <code>config.JUMP_HOST</code> instead of dict lookups</li>
</ul>
<p><strong>Example Usage in Code:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="c1"># Access configuration values</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">jump_host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">JUMP_HOST</span>           <span class="c1"># &quot;192.0.2.10&quot; or env override</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">timeout</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>        <span class="c1"># 10 or env override</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="n">cdp_template</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">CDP_TEMPLATE</span>      <span class="c1"># Path object, validated</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="c1"># Config loader has already validated these exist</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using jump host: </span><span class="si">{</span><span class="n">jump_host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout: </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Best Practice: Configuration Priority</p>
<p>Use <strong>config.yaml</strong> for persistent organizational defaults that should be version-controlled. Use <strong>environment variables</strong> for runtime-specific overrides (testing, different environments) or secrets that shouldn't be committed to Git.</p>
</div>
<hr />
<h2 id="technical-architecture">üèóÔ∏è Technical Architecture<a class="headerlink" href="#technical-architecture" title="Anchor link to this section">&para;</a></h2>
<p>The tool operates as a <strong>modular Python package</strong> with eight primary modules, each with clear responsibilities:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Module</th>
<th style="text-align: left;">Responsibility</th>
<th style="text-align: left;">Why It Matters</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>__main__.py</code></strong></td>
<td style="text-align: left;">Package entry point for <code>python -m cdp_audit</code></td>
<td style="text-align: left;">Enables proper package execution and import resolution</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>cli.py</code></strong></td>
<td style="text-align: left;">Command-line interface and orchestration</td>
<td style="text-align: left;">Clean separation of CLI logic from business logic</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>credentials.py</code></strong></td>
<td style="text-align: left;">Secure credential collection and OS integration</td>
<td style="text-align: left;">Passwords stay out of code and config files</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>discovery.py</code></strong></td>
<td style="text-align: left;">Multi-threaded topology crawling via CDP</td>
<td style="text-align: left;">Discovers 50+ devices in seconds, not minutes</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>excel_reporter.py</code></strong></td>
<td style="text-align: left;">Professional, templated report generation</td>
<td style="text-align: left;">Maintains business branding and formatting</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>validators.py</code></strong></td>
<td style="text-align: left;">Pre-flight checks for templates and configuration</td>
<td style="text-align: left;">Catches problems early; prevents mid-run failures</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>logging_setup.py</code></strong></td>
<td style="text-align: left;">Logging configuration bootstrap</td>
<td style="text-align: left;">Consistent logging across all modules</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>app_config.py</code></strong></td>
<td style="text-align: left;">Centralized configuration access point</td>
<td style="text-align: left;">Single source of truth for config values</td>
</tr>
</tbody>
</table>
<p><strong>Additional Support Modules:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Module</th>
<th style="text-align: left;">Responsibility</th>
<th style="text-align: left;">Location</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>config_loader.py</code></strong></td>
<td style="text-align: left;">YAML configuration loading and validation</td>
<td style="text-align: left;"><code>ProgramFiles/config_files/</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>config.py</code></strong></td>
<td style="text-align: left;">Backward compatibility wrapper</td>
<td style="text-align: left;"><code>ProgramFiles/config_files/</code></td>
</tr>
</tbody>
</table>
<h3 id="architectural-principles">Architectural Principles<a class="headerlink" href="#architectural-principles" title="Anchor link to this section">&para;</a></h3>
<div class="admonition quote">
<p class="admonition-title">Design Philosophy</p>
<p><strong>Separation of Concerns</strong>: Each module has a single, well-defined responsibility. Changes to Excel formatting don't affect discovery logic.</p>
<p><strong>Package-Based Organization</strong>: The <code>cdp_audit/</code> package structure enables clean imports, testability, and proper Python packaging.</p>
<p><strong>Dependency Injection</strong>: Modules receive configuration objects rather than reading global state. Easier to test and reason about.</p>
<p><strong>Fail-Fast Validation</strong>: The <code>validators.py</code> module checks all prerequisites <strong>before</strong> discovery starts. No more failures after 10 minutes of crawling.</p>
<p><strong>Testability</strong>: Each module can be imported and tested independently. Mock the config, test credential logic in isolation.</p>
</div>
<h3 id="module-interaction-flow">Module Interaction Flow<a class="headerlink" href="#module-interaction-flow" title="Anchor link to this section">&para;</a></h3>
<pre class="mermaid"><code>graph LR
    Main[__main__.py] --&gt; CLI[cli.py]
    CLI --&gt; Config[app_config.py]
    CLI --&gt; Validators[validators.py]
    CLI --&gt; Credentials[credentials.py]
    CLI --&gt; Discovery[discovery.py]
    CLI --&gt; Reporter[excel_reporter.py]

    Config --&gt; Loader[config_loader.py]
    Loader --&gt; YAML[config.yaml]
    Loader --&gt; ENV[Environment Variables]

    Validators --&gt; Config
    Credentials --&gt; Config
    Discovery --&gt; Config
    Reporter --&gt; Config

    Discovery --&gt; Netmiko[Netmiko/Paramiko]
    Reporter --&gt; Excel[openpyxl/pandas]

    style Main fill:#e1f5ff
    style CLI fill:#e1f5ff
    style Config fill:#fff4e6
    style Discovery fill:#c8e6c9
    style Reporter fill:#f3e5f5</code></pre>
<p><strong>Execution Flow:</strong></p>
<ol>
<li><strong><code>__main__.py</code></strong> is invoked by <code>python -m cdp_audit</code></li>
<li><strong><code>__main__.py</code></strong> calls <code>cli.main()</code> to start the application</li>
<li><strong><code>cli.py</code></strong> loads configuration via <strong><code>app_config.py</code></strong></li>
<li><strong><code>validators.py</code></strong> performs pre-flight checks (templates exist, Excel valid)</li>
<li><strong><code>credentials.py</code></strong> collects and validates authentication credentials</li>
<li><strong><code>discovery.py</code></strong> executes threaded network crawling</li>
<li><strong><code>excel_reporter.py</code></strong> generates professional report from template</li>
<li><strong><code>cli.py</code></strong> displays summary and exit status</li>
</ol>
<h3 id="package-entry-points">Package Entry Points<a class="headerlink" href="#package-entry-points" title="Anchor link to this section">&para;</a></h3>
<p>The tool is executed as a <strong>Python package</strong>:</p>
<p><strong>1. Package Execution (Recommended):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>python<span class="w"> </span>-m<span class="w"> </span>cdp_audit
</code></pre></div></td></tr></table></div>
<p>Uses <code>cdp_audit/__main__.py</code> as the entry point, which calls <code>cli.main()</code>.</p>
<p><strong>2. Via Windows Launcher (Easiest for Non-Developers):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>run.bat
</code></pre></div></td></tr></table></div>
<p>Validates environment, activates portable venv, runs the package via <code>python -m cdp_audit</code>.</p>
<p><strong>3. Direct CLI Module Execution (Development/Debug):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>python<span class="w"> </span>-m<span class="w"> </span>cdp_audit.cli
</code></pre></div></td></tr></table></div>
<p>Directly calls the CLI module (useful for debugging).</p>
<p><strong>Why Package Execution?</strong></p>
<ul>
<li><strong>Proper Import Resolution</strong>: Python resolves relative imports correctly</li>
<li><strong>Standard Practice</strong>: Follows Python packaging best practices</li>
<li><strong>Installable</strong>: Can be installed with <code>pip install -e .</code> for development</li>
<li><strong>Distribution</strong>: Can be packaged and distributed via PyPI or private repos</li>
</ul>
<hr />
<h2 id="credentials-model-credentialspy">üîê Credentials Model (<code>credentials.py</code>)<a class="headerlink" href="#credentials-model-credentialspy" title="Anchor link to this section">&para;</a></h2>
<p>This module handles all credential management with secure OS integration.</p>
<h3 id="the-two-credential-strategy">The Two-Credential Strategy<a class="headerlink" href="#the-two-credential-strategy" title="Anchor link to this section">&para;</a></h3>
<p>The tool supports a <strong>primary credential</strong> and a <strong>fully customizable fallback credential</strong>:</p>
<ul>
<li><strong>Primary credentials</strong> (used for jump and device): Read from Windows Credential Manager if present (default target <code>MyApp/ADM</code>), else prompted. You can optionally save what you type back to Credential Manager.</li>
<li><strong>Fallback credentials</strong> (device hop only, jump still uses primary): <strong>Username is fully customizable via config.yaml</strong> (default: <code>answer</code>). Password is read from Credential Manager (default target <code>MyApp/Answer</code>) or prompted; you may choose to save it.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> On non-Windows platforms, prompts are used (no Credential Manager).</p>
<p><strong>Customization:</strong> Change the fallback username in <code>config.yaml</code> by setting <code>cdp_fallback_username</code> under the <code>credentials</code> section to match your environment (e.g., <code>localadmin</code>, <code>backup</code>, <code>netops</code>, <code>svc_network</code>).</p>
</blockquote>
<h3 id="why-credential-management-matters">Why Credential Management Matters<a class="headerlink" href="#why-credential-management-matters" title="Anchor link to this section">&para;</a></h3>
<p><strong>The Problem:</strong> Network automation requires credentials. Storing them in plaintext files or hardcoding them in scripts is a security nightmare. Even prompting users every time is error-prone and doesn't scale to 10+ discovery jobs daily.</p>
<p><strong>The Solution:</strong> Leverage native OS credential stores. Windows has Credential Manager, macOS has Keychain, Linux has pass. These are designed for exactly this use case and integrate with enterprise SSO/password managers.</p>
<p><strong>User Experience:</strong> When you run CDP Network Audit for the first time, the script checks Windows Credential Manager for stored credentials. If none are found, it prompts you to enter your username and password. Once you provide them, the script saves them to Windows Credential Manager and uses them for the discovery process. On subsequent runs, the script retrieves the stored credentials automatically without prompting you again.</p>
<h3 id="module-architecture">Module Architecture<a class="headerlink" href="#module-architecture" title="Anchor link to this section">&para;</a></h3>
<p>The <code>credentials.py</code> module exports a single class: <code>CredentialManager</code>.</p>
<p><strong>Key Methods:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>__init__()</code></td>
<td style="text-align: left;">Initialize with config values</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><code>_read_win_cred(target)</code></td>
<td style="text-align: left;">Read from Windows Credential Manager</td>
<td style="text-align: left;"><code>(username, password)</code> or <code>(None, None)</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>_write_win_cred(target, user, pass)</code></td>
<td style="text-align: left;">Write to Windows Credential Manager</td>
<td style="text-align: left;"><code>bool</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>get_secret_with_fallback(...)</code></td>
<td style="text-align: left;">Orchestrate credential retrieval</td>
<td style="text-align: left;"><code>(username, password)</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>collect_all_credentials()</code></td>
<td style="text-align: left;">Collect both primary and fallback creds</td>
<td style="text-align: left;"><code>dict</code></td>
</tr>
</tbody>
</table>
<h3 id="credentialmanager__init__"><code>CredentialManager.__init__()</code><a class="headerlink" href="#credentialmanager__init__" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CredentialManager</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles credential collection with OS integration and fallback.&quot;&quot;&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize credential manager with config values.&quot;&quot;&quot;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>        <span class="c1"># Read from environment variables (override) or config.yaml (default)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primary_target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CDP_PRIMARY_CRED_TARGET&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">CRED_TARGET</span><span class="p">)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fallback_target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CDP_ANSWER_CRED_TARGET&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">ALT_CREDS</span><span class="p">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CDP_FALLBACK_USERNAME&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">CDP_FALLBACK_USERNAME</span><span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Line-by-Line:</strong></p>
<ul>
<li>Import centralized config from <code>app_config.py</code> (single source of truth)</li>
<li>Environment variables override YAML config if set (runtime flexibility)</li>
<li>Three configurable values: primary target, fallback target, and fallback username</li>
<li>Logger uses <code>__name__</code> for proper module-level logging</li>
</ul>
<p><strong>Why This Matters:</strong></p>
<ul>
<li><strong>Centralized config access</strong>: Uses <code>app_config.py</code> instead of direct Config() instantiation</li>
<li><strong>config.yaml</strong>: Human-readable, persistent, version-controlled settings that match your organization's standards</li>
<li><strong>Environment variables</strong>: Runtime overrides for different environments (dev/prod) or testing</li>
<li><strong>Fallback username</strong>: No longer hardcoded‚Äîcustomize in config.yaml to match your local accounts</li>
<li><strong>Module-level logging</strong>: Each module logs with its own name for easy filtering</li>
</ul>
<h3 id="_read_win_credtarget_name-str-tuplestr-str"><code>_read_win_cred(target_name: str) -&gt; Tuple[str, str]</code><a class="headerlink" href="#_read_win_credtarget_name-str-tuplestr-str" title="Anchor link to this section">&para;</a></h3>
<p>Reads encrypted credentials from Windows Credential Manager. Returns <code>(username, password)</code> tuple or <code>(None, None)</code> if not found.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_read_win_cred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read credentials from Windows Credential Manager.&quot;&quot;&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">win32cred</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;win32cred not available (non-Windows platform)&quot;</span><span class="p">)</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>        <span class="n">cred</span> <span class="o">=</span> <span class="n">win32cred</span><span class="o">.</span><span class="n">CredRead</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">win32cred</span><span class="o">.</span><span class="n">CRED_TYPE_GENERIC</span><span class="p">)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>        <span class="n">username</span> <span class="o">=</span> <span class="n">cred</span><span class="p">[</span><span class="s1">&#39;UserName&#39;</span><span class="p">]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>        <span class="n">password_bytes</span> <span class="o">=</span> <span class="n">cred</span><span class="p">[</span><span class="s1">&#39;CredentialBlob&#39;</span><span class="p">]</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>        <span class="c1"># Handle both bytes and string returns</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">password_bytes</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>            <span class="n">password</span> <span class="o">=</span> <span class="n">password_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16-le&#39;</span><span class="p">)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>            <span class="n">password</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">password_bytes</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved credentials from Credential Manager: </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>        <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read &#39;</span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s2">&#39; from Credential Manager: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Only imports <code>win32cred</code> if available (Windows only)</li>
<li>Handles both bytes and string returns for compatibility</li>
<li>Decodes password from UTF-16LE (Windows internal format)</li>
<li>Gracefully fails and returns None instead of crashing</li>
<li>Uses module-level logger for consistent logging</li>
</ul>
<p><strong>Why This Approach:</strong></p>
<ul>
<li><strong>No plaintext storage:</strong> Credentials are encrypted by Windows</li>
<li><strong>Cross-platform:</strong> Non-Windows systems skip this and use prompts</li>
<li><strong>Version-agnostic:</strong> Works with multiple pywin32 versions</li>
<li><strong>Graceful degradation:</strong> Fails quietly and falls back to prompts</li>
</ul>
<h3 id="_write_win_credtarget-str-username-str-password-str-bool"><code>_write_win_cred(target: str, username: str, password: str) -&gt; bool</code><a class="headerlink" href="#_write_win_credtarget-str-username-str-password-str-bool" title="Anchor link to this section">&para;</a></h3>
<p>Writes credentials to Windows Credential Manager for future reuse.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_write_win_cred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write credentials to Windows Credential Manager.&quot;&quot;&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">win32cred</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;win32cred not available (non-Windows platform)&quot;</span><span class="p">)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>        <span class="n">password_bytes</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-16-le&#39;</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>        <span class="n">cred</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>            <span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="n">win32cred</span><span class="o">.</span><span class="n">CRED_TYPE_GENERIC</span><span class="p">,</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>            <span class="s1">&#39;TargetName&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">,</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>            <span class="s1">&#39;UserName&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>            <span class="s1">&#39;CredentialBlob&#39;</span><span class="p">:</span> <span class="n">password_bytes</span><span class="p">,</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>            <span class="s1">&#39;Persist&#39;</span><span class="p">:</span> <span class="n">win32cred</span><span class="o">.</span><span class="n">CRED_PERSIST_LOCAL_MACHINE</span><span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>            <span class="s1">&#39;Comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Stored by CDP Network Audit&#39;</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>        <span class="p">}</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>        <span class="n">win32cred</span><span class="o">.</span><span class="n">CredWrite</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored credentials in Credential Manager: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not save credentials to Credential Manager: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Password is encoded to UTF-16LE before storage (Windows requirement)</li>
<li><code>CRED_PERSIST_LOCAL_MACHINE</code> means credentials persist across sessions</li>
<li>Failures are logged at DEBUG level (not alarming)</li>
<li>Returns <code>True</code> on success, <code>False</code> on failure</li>
</ul>
<p><strong>Why This Matters:</strong></p>
<ul>
<li>Users can avoid re-prompting on subsequent runs</li>
<li>Credentials are encrypted and protected by Windows</li>
<li>Optional save means users control persistence</li>
<li>Professional metadata (Comment field) for audit trails</li>
</ul>
<h3 id="get_secret_with_fallback-tuplestr-str"><code>get_secret_with_fallback(...) -&gt; Tuple[str, str]</code><a class="headerlink" href="#get_secret_with_fallback-tuplestr-str" title="Anchor link to this section">&para;</a></h3>
<p>The credential retrieval orchestrator with multi-step fallback:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span>
<span class="normal"><a href="#__codelineno-14-45">45</a></span>
<span class="normal"><a href="#__codelineno-14-46">46</a></span>
<span class="normal"><a href="#__codelineno-14-47">47</a></span>
<span class="normal"><a href="#__codelineno-14-48">48</a></span>
<span class="normal"><a href="#__codelineno-14-49">49</a></span>
<span class="normal"><a href="#__codelineno-14-50">50</a></span>
<span class="normal"><a href="#__codelineno-14-51">51</a></span>
<span class="normal"><a href="#__codelineno-14-52">52</a></span>
<span class="normal"><a href="#__codelineno-14-53">53</a></span>
<span class="normal"><a href="#__codelineno-14-54">54</a></span>
<span class="normal"><a href="#__codelineno-14-55">55</a></span>
<span class="normal"><a href="#__codelineno-14-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_secret_with_fallback</span><span class="p">(</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span class="n">prompt_user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="n">prompt_pass</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>    <span class="n">target_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>    <span class="n">allow_custom_username</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="sd">    Retrieve credentials with Credential Manager fallback.</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="sd">    1. Try reading from Windows Credential Manager</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="sd">    2. Fall back to interactive prompt</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="sd">    3. Optionally save to Credential Manager</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="sd">    Args:</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="sd">        prompt_user: Username prompt text</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="sd">        prompt_pass: Password prompt text</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="sd">        target_name: Credential Manager target name</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="sd">        allow_custom_username: Whether to allow username customization</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="sd">    Returns:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="sd">        (username, password) tuple</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>    <span class="c1"># Try Credential Manager first</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>    <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_win_cred</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>    <span class="k">if</span> <span class="n">username</span> <span class="ow">and</span> <span class="n">password</span><span class="p">:</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using stored credentials from Credential Manager: </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>        <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>    <span class="c1"># Fall back to interactive prompt</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Credentials not found, prompting user...&quot;</span><span class="p">)</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="k">if</span> <span class="n">allow_custom_username</span><span class="p">:</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>        <span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt_user</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username cannot be empty&quot;</span><span class="p">)</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>        <span class="c1"># Use pre-configured fallback username</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a>        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using fallback username from config: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="n">prompt_pass</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password cannot be empty&quot;</span><span class="p">)</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a>    <span class="c1"># Ask to save credentials</span>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a>    <span class="n">save</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Store credentials in Credential Manager as &#39;</span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s2">&#39;? [y/N]: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-14-49" name="__codelineno-14-49"></a>    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
<a id="__codelineno-14-50" name="__codelineno-14-50"></a>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_win_cred</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<a id="__codelineno-14-51" name="__codelineno-14-51"></a>        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
<a id="__codelineno-14-52" name="__codelineno-14-52"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Credentials saved to Credential Manager: </span><span class="si">{</span><span class="n">target_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-53" name="__codelineno-14-53"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-54" name="__codelineno-14-54"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö† Could not save credentials (non-Windows platform or error)&quot;</span><span class="p">)</span>
<a id="__codelineno-14-55" name="__codelineno-14-55"></a>
<a id="__codelineno-14-56" name="__codelineno-14-56"></a>    <span class="k">return</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
</code></pre></div></td></tr></table></div>
<p><strong>Two-Credential Model:</strong></p>
<ul>
<li><strong>Primary:</strong> Your main automation account (flexible username, likely AD-backed)</li>
<li><strong>Fallback:</strong> A secondary user on each device (username customizable in config.yaml, typically a local account)</li>
</ul>
<p><strong>Why This Design:</strong></p>
<ul>
<li>Zero installation friction - first run prompts, subsequent runs use saved credentials</li>
<li>Two credentials maximize success: primary fails ‚Üí retry with fallback</li>
<li>Jump host always uses primary (tighter control)</li>
<li>Device can fall back to secondary user (local account)</li>
<li>Fully customizable to match your organization's account naming standards</li>
</ul>
<h3 id="collect_all_credentials-dict"><code>collect_all_credentials() -&gt; dict</code><a class="headerlink" href="#collect_all_credentials-dict" title="Anchor link to this section">&para;</a></h3>
<p>High-level method to collect all required credentials:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_all_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="sd">    Collect both primary and fallback credentials.</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="sd">    Returns:</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="sd">        dict with keys: primary_user, primary_pass, fallback_user, fallback_pass</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Credential Collection ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>    <span class="c1"># Collect primary credentials</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Collecting primary credentials (used for jump and devices)...&quot;</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>    <span class="n">primary_user</span><span class="p">,</span> <span class="n">primary_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secret_with_fallback</span><span class="p">(</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>        <span class="n">prompt_user</span><span class="o">=</span><span class="s2">&quot;Enter primary username: &quot;</span><span class="p">,</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>        <span class="n">prompt_pass</span><span class="o">=</span><span class="s2">&quot;Enter primary password: &quot;</span><span class="p">,</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>        <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_target</span><span class="p">,</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>        <span class="n">allow_custom_username</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>    <span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>    <span class="c1"># Collect fallback credentials</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Collecting fallback credentials (username: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>    <span class="n">fallback_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">fallback_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secret_with_fallback</span><span class="p">(</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>        <span class="n">prompt_user</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Enter fallback username (default: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span><span class="si">}</span><span class="s2">): &quot;</span><span class="p">,</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>        <span class="n">prompt_pass</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Enter &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fallback_username</span><span class="si">}</span><span class="s2">&#39; password: &quot;</span><span class="p">,</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a>        <span class="n">target_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fallback_target</span><span class="p">,</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>        <span class="n">allow_custom_username</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a>    <span class="p">)</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a>        <span class="s1">&#39;primary_user&#39;</span><span class="p">:</span> <span class="n">primary_user</span><span class="p">,</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a>        <span class="s1">&#39;primary_pass&#39;</span><span class="p">:</span> <span class="n">primary_pass</span><span class="p">,</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a>        <span class="s1">&#39;fallback_user&#39;</span><span class="p">:</span> <span class="n">fallback_user</span><span class="p">,</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a>        <span class="s1">&#39;fallback_pass&#39;</span><span class="p">:</span> <span class="n">fallback_pass</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns a clean dictionary</strong> that discovery modules can consume without understanding credential logic.</p>
<hr />
<h2 id="validators-module-validatorspy">üîç Validators Module (<code>validators.py</code>)<a class="headerlink" href="#validators-module-validatorspy" title="Anchor link to this section">&para;</a></h2>
<p>The <code>validators.py</code> module performs <strong>pre-flight checks</strong> before discovery begins.</p>
<h3 id="why-pre-flight-validation-matters">Why Pre-Flight Validation Matters<a class="headerlink" href="#why-pre-flight-validation-matters" title="Anchor link to this section">&para;</a></h3>
<p><strong>The Problem:</strong> Discovering 50+ devices over 10 minutes, then failing because an Excel template is missing or corrupt is frustrating and wastes time.</p>
<p><strong>The Solution:</strong> Validate everything <strong>before</strong> discovery starts. Fail fast with helpful error messages.</p>
<h3 id="module-functions">Module Functions<a class="headerlink" href="#module-functions" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span>
<span class="normal"><a href="#__codelineno-16-39">39</a></span>
<span class="normal"><a href="#__codelineno-16-40">40</a></span>
<span class="normal"><a href="#__codelineno-16-41">41</a></span>
<span class="normal"><a href="#__codelineno-16-42">42</a></span>
<span class="normal"><a href="#__codelineno-16-43">43</a></span>
<span class="normal"><a href="#__codelineno-16-44">44</a></span>
<span class="normal"><a href="#__codelineno-16-45">45</a></span>
<span class="normal"><a href="#__codelineno-16-46">46</a></span>
<span class="normal"><a href="#__codelineno-16-47">47</a></span>
<span class="normal"><a href="#__codelineno-16-48">48</a></span>
<span class="normal"><a href="#__codelineno-16-49">49</a></span>
<span class="normal"><a href="#__codelineno-16-50">50</a></span>
<span class="normal"><a href="#__codelineno-16-51">51</a></span>
<span class="normal"><a href="#__codelineno-16-52">52</a></span>
<span class="normal"><a href="#__codelineno-16-53">53</a></span>
<span class="normal"><a href="#__codelineno-16-54">54</a></span>
<span class="normal"><a href="#__codelineno-16-55">55</a></span>
<span class="normal"><a href="#__codelineno-16-56">56</a></span>
<span class="normal"><a href="#__codelineno-16-57">57</a></span>
<span class="normal"><a href="#__codelineno-16-58">58</a></span>
<span class="normal"><a href="#__codelineno-16-59">59</a></span>
<span class="normal"><a href="#__codelineno-16-60">60</a></span>
<span class="normal"><a href="#__codelineno-16-61">61</a></span>
<span class="normal"><a href="#__codelineno-16-62">62</a></span>
<span class="normal"><a href="#__codelineno-16-63">63</a></span>
<span class="normal"><a href="#__codelineno-16-64">64</a></span>
<span class="normal"><a href="#__codelineno-16-65">65</a></span>
<span class="normal"><a href="#__codelineno-16-66">66</a></span>
<span class="normal"><a href="#__codelineno-16-67">67</a></span>
<span class="normal"><a href="#__codelineno-16-68">68</a></span>
<span class="normal"><a href="#__codelineno-16-69">69</a></span>
<span class="normal"><a href="#__codelineno-16-70">70</a></span>
<span class="normal"><a href="#__codelineno-16-71">71</a></span>
<span class="normal"><a href="#__codelineno-16-72">72</a></span>
<span class="normal"><a href="#__codelineno-16-73">73</a></span>
<span class="normal"><a href="#__codelineno-16-74">74</a></span>
<span class="normal"><a href="#__codelineno-16-75">75</a></span>
<span class="normal"><a href="#__codelineno-16-76">76</a></span>
<span class="normal"><a href="#__codelineno-16-77">77</a></span>
<span class="normal"><a href="#__codelineno-16-78">78</a></span>
<span class="normal"><a href="#__codelineno-16-79">79</a></span>
<span class="normal"><a href="#__codelineno-16-80">80</a></span>
<span class="normal"><a href="#__codelineno-16-81">81</a></span>
<span class="normal"><a href="#__codelineno-16-82">82</a></span>
<span class="normal"><a href="#__codelineno-16-83">83</a></span>
<span class="normal"><a href="#__codelineno-16-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="sd">&quot;&quot;&quot;Pre-flight validation for templates and configuration.&quot;&quot;&quot;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_workbook</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_textfsm_templates</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="sd">    Validate TextFSM templates exist and are readable.</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="sd">    Returns:</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="sd">        True if all templates valid, False otherwise</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a>    <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>        <span class="s1">&#39;CDP Template&#39;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">CDP_TEMPLATE</span><span class="p">,</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>        <span class="s1">&#39;Version Template&#39;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">VER_TEMPLATE</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a>    <span class="p">}</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>    <span class="n">all_valid</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a>            <span class="n">all_valid</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a file: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a>            <span class="n">all_valid</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a>    <span class="k">return</span> <span class="n">all_valid</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_excel_template</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-16-39" name="__codelineno-16-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-40" name="__codelineno-16-40"></a><span class="sd">    Validate Excel template exists and is loadable.</span>
<a id="__codelineno-16-41" name="__codelineno-16-41"></a>
<a id="__codelineno-16-42" name="__codelineno-16-42"></a><span class="sd">    Returns:</span>
<a id="__codelineno-16-43" name="__codelineno-16-43"></a><span class="sd">        True if template valid, False otherwise</span>
<a id="__codelineno-16-44" name="__codelineno-16-44"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-45" name="__codelineno-16-45"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-16-46" name="__codelineno-16-46"></a>    <span class="n">template_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">EXCEL_TEMPLATE</span>
<a id="__codelineno-16-47" name="__codelineno-16-47"></a>
<a id="__codelineno-16-48" name="__codelineno-16-48"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-16-49" name="__codelineno-16-49"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Excel template not found: </span><span class="si">{</span><span class="n">template_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-50" name="__codelineno-16-50"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-16-51" name="__codelineno-16-51"></a>
<a id="__codelineno-16-52" name="__codelineno-16-52"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<a id="__codelineno-16-53" name="__codelineno-16-53"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Excel template is not a file: </span><span class="si">{</span><span class="n">template_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-54" name="__codelineno-16-54"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-16-55" name="__codelineno-16-55"></a>
<a id="__codelineno-16-56" name="__codelineno-16-56"></a>    <span class="c1"># Try loading the template</span>
<a id="__codelineno-16-57" name="__codelineno-16-57"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-16-58" name="__codelineno-16-58"></a>        <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span> <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-16-59" name="__codelineno-16-59"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Excel template valid: </span><span class="si">{</span><span class="n">template_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-60" name="__codelineno-16-60"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-16-61" name="__codelineno-16-61"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-16-62" name="__codelineno-16-62"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Excel template is corrupt or invalid: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-63" name="__codelineno-16-63"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-16-64" name="__codelineno-16-64"></a>
<a id="__codelineno-16-65" name="__codelineno-16-65"></a>
<a id="__codelineno-16-66" name="__codelineno-16-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-16-67" name="__codelineno-16-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-68" name="__codelineno-16-68"></a><span class="sd">    Run all validation checks.</span>
<a id="__codelineno-16-69" name="__codelineno-16-69"></a>
<a id="__codelineno-16-70" name="__codelineno-16-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-16-71" name="__codelineno-16-71"></a><span class="sd">        True if all validations pass, False otherwise</span>
<a id="__codelineno-16-72" name="__codelineno-16-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-73" name="__codelineno-16-73"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-16-74" name="__codelineno-16-74"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=== Running Pre-Flight Validation ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-75" name="__codelineno-16-75"></a>
<a id="__codelineno-16-76" name="__codelineno-16-76"></a>    <span class="n">textfsm_valid</span> <span class="o">=</span> <span class="n">validate_textfsm_templates</span><span class="p">()</span>
<a id="__codelineno-16-77" name="__codelineno-16-77"></a>    <span class="n">excel_valid</span> <span class="o">=</span> <span class="n">validate_excel_template</span><span class="p">()</span>
<a id="__codelineno-16-78" name="__codelineno-16-78"></a>
<a id="__codelineno-16-79" name="__codelineno-16-79"></a>    <span class="k">if</span> <span class="n">textfsm_valid</span> <span class="ow">and</span> <span class="n">excel_valid</span><span class="p">:</span>
<a id="__codelineno-16-80" name="__codelineno-16-80"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úì All validation checks passed&quot;</span><span class="p">)</span>
<a id="__codelineno-16-81" name="__codelineno-16-81"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-16-82" name="__codelineno-16-82"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-83" name="__codelineno-16-83"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ùå Validation failed - please fix the above errors&quot;</span><span class="p">)</span>
<a id="__codelineno-16-84" name="__codelineno-16-84"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
<p><strong>When Used:</strong></p>
<p>The <code>cli.py</code> module calls <code>validate_all()</code> before proceeding with credential collection and discovery:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit</span><span class="w"> </span><span class="kn">import</span> <span class="n">validators</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">validators</span><span class="o">.</span><span class="n">validate_all</span><span class="p">():</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>Catches configuration errors immediately</li>
<li>Provides clear, actionable error messages</li>
<li>Prevents wasted time on doomed discovery runs</li>
<li>Professional UX with checkmarks and crosses</li>
</ul>
<hr />
<h2 id="discovery-module-discoverypy">üåê Discovery Module (<code>discovery.py</code>)<a class="headerlink" href="#discovery-module-discoverypy" title="Anchor link to this section">&para;</a></h2>
<p>The heart of the tool: <strong>multi-threaded network discovery via CDP</strong>.</p>
<h3 id="why-parallel-discovery-is-essential">Why Parallel Discovery is Essential<a class="headerlink" href="#why-parallel-discovery-is-essential" title="Anchor link to this section">&para;</a></h3>
<p><strong>The Problem:</strong> Discovering 50+ switches serially takes 10+ minutes. Each SSH connection is a round-trip: connect, execute, disconnect.</p>
<p><strong>The Solution:</strong> Thread pool with 10 concurrent workers = 5x faster. 10 simultaneous connections instead of waiting for each one.</p>
<h3 id="module-architecture_1">Module Architecture<a class="headerlink" href="#module-architecture_1" title="Anchor link to this section">&para;</a></h3>
<p>The <code>discovery.py</code> module exports a single class: <code>NetworkDiscoverer</code>.</p>
<p><strong>Key Components:</strong></p>
<ul>
<li>Thread-safe data structures (locks protect shared state)</li>
<li>Worker thread pool for parallel device connections</li>
<li>CDP parsing and intelligent queueing heuristics</li>
<li>Jump server support (Paramiko + Netmiko)</li>
<li>Retry logic for transient failures</li>
<li>DNS resolution in parallel</li>
</ul>
<h3 id="thread-safe-data-accumulators">Thread-Safe Data Accumulators<a class="headerlink" href="#thread-safe-data-accumulators" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">NetworkDiscoverer</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Multi-threaded network discovery engine using CDP.&quot;&quot;&quot;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">jump_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="sd">        Initialize discovery engine.</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="sd">        Args:</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="sd">            credentials: Dict with primary_user, primary_pass, fallback_user, fallback_pass</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="sd">            jump_host: Optional jump/bastion host IP or hostname</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>        <span class="c1"># Configuration</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jump_host</span> <span class="o">=</span> <span class="n">jump_host</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>        <span class="c1"># Thread-safe data structures</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cdp_neighbor_details</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># Parsed CDP entries (list, protected by data_lock)</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>            <span class="c1"># Discovered hostnames for DNS (set, protected by data_lock)</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>              <span class="c1"># IPs we&#39;ve already audited (set, protected by visited_lock)</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">authentication_errors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Auth failures (set, protected by data_lock)</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection_errors</span> <span class="o">=</span> <span class="p">{}</span>       <span class="c1"># {IP: error_message} (dict, protected by data_lock)</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dns_ip</span> <span class="o">=</span> <span class="p">{}</span>                  <span class="c1"># {hostname: resolved_ip} (dict, protected by data_lock)</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>        <span class="c1"># Thread synchronization</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visited_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># Protects visited set and queue operations</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>     <span class="c1"># Protects result accumulators</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a>        <span class="c1"># Discovery queue</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a>        <span class="c1"># Logging</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why Two Locks?</strong></p>
<ul>
<li>If we used one lock for everything, threads would block each other constantly</li>
<li>Granular locks allow more independent work</li>
<li><code>visited_lock</code> for quick "is this already being processed?" checks</li>
<li><code>data_lock</code> for appending results (slower operations)</li>
</ul>
<p><strong>Data Structure Choices:</strong></p>
<ul>
<li><strong>Lists</strong> for ordered results (<code>cdp_neighbor_details</code>)</li>
<li><strong>Sets</strong> for deduplication (<code>visited</code>, <code>hostnames</code>, <code>authentication_errors</code>)</li>
<li><strong>Dicts</strong> for key-value lookups (<code>connection_errors</code>, <code>dns_ip</code>)</li>
</ul>
<h3 id="jump-server-support">Jump Server Support<a class="headerlink" href="#jump-server-support" title="Anchor link to this section">&para;</a></h3>
<p>The discovery module supports both direct and jump-mediated connections.</p>
<h4 id="_paramiko_jump_client-paramikosshclient"><code>_paramiko_jump_client(...) -&gt; paramiko.SSHClient</code><a class="headerlink" href="#_paramiko_jump_client-paramikosshclient" title="Anchor link to this section">&para;</a></h4>
<p>Creates a secure SSH connection to a jump/bastion host.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_paramiko_jump_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="sd">    Create a Paramiko SSH client for jump host connection.</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="sd">        host: Jump host IP or hostname</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="sd">        username: SSH username</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="sd">        password: SSH password</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="sd">    Returns:</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="sd">        Connected paramiko.SSHClient</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="sd">    Raises:</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="sd">        paramiko.AuthenticationException: If authentication fails</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="sd">        paramiko.SSHException: If SSH connection fails</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>    <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">WarningPolicy</span><span class="p">())</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a>            <span class="n">hostname</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a>            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a>            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SSH_PORT</span><span class="p">,</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a>            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a>            <span class="n">auth_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a>        <span class="p">)</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to jump host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a>        <span class="k">return</span> <span class="n">client</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a>    <span class="k">except</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">AuthenticationException</span><span class="p">:</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed on jump host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a>        <span class="k">raise</span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to jump host </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a>        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
<p><strong>Key Design Choices:</strong></p>
<ul>
<li><code>WarningPolicy()</code> - Log warnings for unknown hosts (safer than AutoAddPolicy)</li>
<li>Explicit password auth only - No SSH keys or agent (easier to audit)</li>
<li>Consistent timeouts - All operations respect <code>DEFAULT_TIMEOUT</code> setting</li>
<li>Re-raise auth failures - Let caller handle credential issues</li>
</ul>
<p><strong>Why WarningPolicy?</strong></p>
<ul>
<li>Accepts unknown hosts but logs warnings</li>
<li>Catches potential man-in-the-middle attacks without crashing</li>
<li>Production-ready security posture</li>
<li>Better than <code>AutoAddPolicy</code> (too permissive) or <code>RejectPolicy</code> (too strict for dynamic environments)</li>
</ul>
<h4 id="_netmiko_via_jump-connecthandler"><code>_netmiko_via_jump(...) -&gt; ConnectHandler</code><a class="headerlink" href="#_netmiko_via_jump-connecthandler" title="Anchor link to this section">&para;</a></h4>
<p>The <strong>core connection function</strong>. Handles both direct and jump-host connections.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span>
<span class="normal"><a href="#__codelineno-20-48">48</a></span>
<span class="normal"><a href="#__codelineno-20-49">49</a></span>
<span class="normal"><a href="#__codelineno-20-50">50</a></span>
<span class="normal"><a href="#__codelineno-20-51">51</a></span>
<span class="normal"><a href="#__codelineno-20-52">52</a></span>
<span class="normal"><a href="#__codelineno-20-53">53</a></span>
<span class="normal"><a href="#__codelineno-20-54">54</a></span>
<span class="normal"><a href="#__codelineno-20-55">55</a></span>
<span class="normal"><a href="#__codelineno-20-56">56</a></span>
<span class="normal"><a href="#__codelineno-20-57">57</a></span>
<span class="normal"><a href="#__codelineno-20-58">58</a></span>
<span class="normal"><a href="#__codelineno-20-59">59</a></span>
<span class="normal"><a href="#__codelineno-20-60">60</a></span>
<span class="normal"><a href="#__codelineno-20-61">61</a></span>
<span class="normal"><a href="#__codelineno-20-62">62</a></span>
<span class="normal"><a href="#__codelineno-20-63">63</a></span>
<span class="normal"><a href="#__codelineno-20-64">64</a></span>
<span class="normal"><a href="#__codelineno-20-65">65</a></span>
<span class="normal"><a href="#__codelineno-20-66">66</a></span>
<span class="normal"><a href="#__codelineno-20-67">67</a></span>
<span class="normal"><a href="#__codelineno-20-68">68</a></span>
<span class="normal"><a href="#__codelineno-20-69">69</a></span>
<span class="normal"><a href="#__codelineno-20-70">70</a></span>
<span class="normal"><a href="#__codelineno-20-71">71</a></span>
<span class="normal"><a href="#__codelineno-20-72">72</a></span>
<span class="normal"><a href="#__codelineno-20-73">73</a></span>
<span class="normal"><a href="#__codelineno-20-74">74</a></span>
<span class="normal"><a href="#__codelineno-20-75">75</a></span>
<span class="normal"><a href="#__codelineno-20-76">76</a></span>
<span class="normal"><a href="#__codelineno-20-77">77</a></span>
<span class="normal"><a href="#__codelineno-20-78">78</a></span>
<span class="normal"><a href="#__codelineno-20-79">79</a></span>
<span class="normal"><a href="#__codelineno-20-80">80</a></span>
<span class="normal"><a href="#__codelineno-20-81">81</a></span>
<span class="normal"><a href="#__codelineno-20-82">82</a></span>
<span class="normal"><a href="#__codelineno-20-83">83</a></span>
<span class="normal"><a href="#__codelineno-20-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_netmiko_via_jump</span><span class="p">(</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>    <span class="n">device_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span class="n">primary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConnectHandler</span><span class="p">:</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="sd">    Create a Netmiko connection, optionally via jump host.</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="sd">    Args:</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="sd">        device_ip: Target device IP</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="sd">        primary: If True, use primary credentials; if False, use fallback</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="sd">    Returns:</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="sd">        Connected Netmiko ConnectHandler</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="sd">    Raises:</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="sd">        NetmikoAuthenticationException: If authentication fails</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="sd">        NetmikoTimeoutException: If connection times out</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span class="c1"># Determine credentials to use</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>        <span class="n">jump_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_user&#39;</span><span class="p">]</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>        <span class="n">jump_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_pass&#39;</span><span class="p">]</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>        <span class="n">device_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_user&#39;</span><span class="p">]</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="n">device_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_pass&#39;</span><span class="p">]</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>        <span class="n">jump_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_user&#39;</span><span class="p">]</span>  <span class="c1"># Jump always uses primary</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>        <span class="n">jump_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;primary_pass&#39;</span><span class="p">]</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a>        <span class="n">device_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;fallback_user&#39;</span><span class="p">]</span>  <span class="c1"># Device uses fallback</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>        <span class="n">device_pass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;fallback_pass&#39;</span><span class="p">]</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>    <span class="c1"># Build Netmiko device dict</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a>    <span class="n">device_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a>        <span class="s1">&#39;device_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEVICE_TYPE</span><span class="p">,</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a>        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">device_user</span><span class="p">,</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a>        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">device_pass</span><span class="p">,</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a>        <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a>        <span class="s1">&#39;auth_timeout&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a>        <span class="s1">&#39;conn_timeout&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a>    <span class="p">}</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a>    <span class="c1"># Direct connection (no jump host)</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">jump_host</span><span class="p">:</span>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a>        <span class="n">device_params</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_ip</span>
<a id="__codelineno-20-45" name="__codelineno-20-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting directly to </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-46" name="__codelineno-20-46"></a>        <span class="k">return</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>
<a id="__codelineno-20-47" name="__codelineno-20-47"></a>
<a id="__codelineno-20-48" name="__codelineno-20-48"></a>    <span class="c1"># Jump-mediated connection</span>
<a id="__codelineno-20-49" name="__codelineno-20-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2"> via jump host </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jump_host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-50" name="__codelineno-20-50"></a>
<a id="__codelineno-20-51" name="__codelineno-20-51"></a>    <span class="c1"># 1. Connect to jump host with Paramiko</span>
<a id="__codelineno-20-52" name="__codelineno-20-52"></a>    <span class="n">jump_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paramiko_jump_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jump_host</span><span class="p">,</span> <span class="n">jump_user</span><span class="p">,</span> <span class="n">jump_pass</span><span class="p">)</span>
<a id="__codelineno-20-53" name="__codelineno-20-53"></a>
<a id="__codelineno-20-54" name="__codelineno-20-54"></a>    <span class="c1"># 2. Create direct-tcpip channel through jump to target</span>
<a id="__codelineno-20-55" name="__codelineno-20-55"></a>    <span class="n">channel</span> <span class="o">=</span> <span class="n">jump_client</span><span class="o">.</span><span class="n">get_transport</span><span class="p">()</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span>
<a id="__codelineno-20-56" name="__codelineno-20-56"></a>        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;direct-tcpip&#39;</span><span class="p">,</span>
<a id="__codelineno-20-57" name="__codelineno-20-57"></a>        <span class="n">dest_addr</span><span class="o">=</span><span class="p">(</span><span class="n">device_ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">SSH_PORT</span><span class="p">),</span>
<a id="__codelineno-20-58" name="__codelineno-20-58"></a>        <span class="n">src_addr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-20-59" name="__codelineno-20-59"></a>    <span class="p">)</span>
<a id="__codelineno-20-60" name="__codelineno-20-60"></a>
<a id="__codelineno-20-61" name="__codelineno-20-61"></a>    <span class="c1"># 3. Wrap channel as socket for Netmiko</span>
<a id="__codelineno-20-62" name="__codelineno-20-62"></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ChannelToSocket</span><span class="p">:</span>
<a id="__codelineno-20-63" name="__codelineno-20-63"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper to make Paramiko channel look like a socket.&quot;&quot;&quot;</span>
<a id="__codelineno-20-64" name="__codelineno-20-64"></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
<a id="__codelineno-20-65" name="__codelineno-20-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
<a id="__codelineno-20-66" name="__codelineno-20-66"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-20-67" name="__codelineno-20-67"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-20-68" name="__codelineno-20-68"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-20-69" name="__codelineno-20-69"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-20-70" name="__codelineno-20-70"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-20-71" name="__codelineno-20-71"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-20-72" name="__codelineno-20-72"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
<a id="__codelineno-20-73" name="__codelineno-20-73"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-20-74" name="__codelineno-20-74"></a>
<a id="__codelineno-20-75" name="__codelineno-20-75"></a>    <span class="n">sock</span> <span class="o">=</span> <span class="n">ChannelToSocket</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-20-76" name="__codelineno-20-76"></a>
<a id="__codelineno-20-77" name="__codelineno-20-77"></a>    <span class="c1"># 4. Pass socket to Netmiko</span>
<a id="__codelineno-20-78" name="__codelineno-20-78"></a>    <span class="n">device_params</span><span class="p">[</span><span class="s1">&#39;sock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sock</span>
<a id="__codelineno-20-79" name="__codelineno-20-79"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>
<a id="__codelineno-20-80" name="__codelineno-20-80"></a>
<a id="__codelineno-20-81" name="__codelineno-20-81"></a>    <span class="c1"># Store jump client for cleanup</span>
<a id="__codelineno-20-82" name="__codelineno-20-82"></a>    <span class="n">conn</span><span class="o">.</span><span class="n">_jump_client</span> <span class="o">=</span> <span class="n">jump_client</span>
<a id="__codelineno-20-83" name="__codelineno-20-83"></a>
<a id="__codelineno-20-84" name="__codelineno-20-84"></a>    <span class="k">return</span> <span class="n">conn</span>
</code></pre></div></td></tr></table></div>
<p><strong>Credential Logic:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">if</span> <span class="n">primary</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>    <span class="n">jump_user</span><span class="p">,</span> <span class="n">jump_pass</span> <span class="o">=</span> <span class="n">primary_user</span><span class="p">,</span> <span class="n">primary_pass</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>    <span class="n">device_user</span><span class="p">,</span> <span class="n">device_pass</span> <span class="o">=</span> <span class="n">primary_user</span><span class="p">,</span> <span class="n">primary_pass</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>    <span class="n">jump_user</span><span class="p">,</span> <span class="n">jump_pass</span> <span class="o">=</span> <span class="n">primary_user</span><span class="p">,</span> <span class="n">primary_pass</span>  <span class="c1"># Jump always uses primary</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="n">device_user</span><span class="p">,</span> <span class="n">device_pass</span> <span class="o">=</span> <span class="n">fallback_user</span><span class="p">,</span> <span class="n">fallback_pass</span>  <span class="c1"># Device uses fallback</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why This Two-Credential Model:</strong></p>
<ul>
<li>Jump host always uses primary (tightest control)</li>
<li>Device can use fallback if primary fails (username customizable in config.yaml)</li>
<li>Resilience: if your primary account is locked, fallback account can still work</li>
<li>Flexibility: adapt to your organization's local account naming conventions</li>
</ul>
<p><strong>Direct Connection:</strong>
Simply pass device IP to Netmiko.</p>
<p><strong>Jump-Mediated Connection:</strong></p>
<ol>
<li>Open Paramiko SSH to jump host</li>
<li>Create <code>direct-tcpip</code> channel (SSH tunnel) through jump to target</li>
<li>Wrap channel as socket</li>
<li>Pass socket to Netmiko for SSH auth</li>
</ol>
<p><strong>Why direct-tcpip?</strong></p>
<ul>
<li>No need to open a listener on the jump host</li>
<li>No port forwarding configuration required</li>
<li>All traffic is inside the already-authenticated SSH session</li>
<li>Secure and clean</li>
<li>Standard SSH tunneling mechanism</li>
</ul>
<h3 id="device-command-execution">Device Command Execution<a class="headerlink" href="#device-command-execution" title="Anchor link to this section">&para;</a></h3>
<h4 id="run_device_commands-tuplestr-str"><code>run_device_commands(...) -&gt; Tuple[str, str]</code><a class="headerlink" href="#run_device_commands-tuplestr-str" title="Anchor link to this section">&para;</a></h4>
<p>Executes CDP and version commands on target device with fallback credentials.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span>
<span class="normal"><a href="#__codelineno-22-54">54</a></span>
<span class="normal"><a href="#__codelineno-22-55">55</a></span>
<span class="normal"><a href="#__codelineno-22-56">56</a></span>
<span class="normal"><a href="#__codelineno-22-57">57</a></span>
<span class="normal"><a href="#__codelineno-22-58">58</a></span>
<span class="normal"><a href="#__codelineno-22-59">59</a></span>
<span class="normal"><a href="#__codelineno-22-60">60</a></span>
<span class="normal"><a href="#__codelineno-22-61">61</a></span>
<span class="normal"><a href="#__codelineno-22-62">62</a></span>
<span class="normal"><a href="#__codelineno-22-63">63</a></span>
<span class="normal"><a href="#__codelineno-22-64">64</a></span>
<span class="normal"><a href="#__codelineno-22-65">65</a></span>
<span class="normal"><a href="#__codelineno-22-66">66</a></span>
<span class="normal"><a href="#__codelineno-22-67">67</a></span>
<span class="normal"><a href="#__codelineno-22-68">68</a></span>
<span class="normal"><a href="#__codelineno-22-69">69</a></span>
<span class="normal"><a href="#__codelineno-22-70">70</a></span>
<span class="normal"><a href="#__codelineno-22-71">71</a></span>
<span class="normal"><a href="#__codelineno-22-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_device_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="sd">    Execute show commands on device with fallback credential strategy.</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="sd">    Strategy:</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="sd">    1. Try with primary credentials</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="sd">    2. On auth failure, catch and retry with fallback</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="sd">    3. Don&#39;t retry auth failures (credentials won&#39;t change)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="sd">    4. Do retry transient errors (timeouts, SSH glitches) up to 3 times</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="sd">    5. Always disconnect in finally block</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="sd">    Args:</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="sd">        device_ip: Target device IP</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="sd">    Returns:</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="sd">        (show_version_output, show_cdp_neighbors_detail_output) tuple</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="sd">    Raises:</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="sd">        Exception: If all retry attempts fail</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>    <span class="n">max_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">MAX_RETRY_ATTEMPTS</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>            <span class="c1"># Try primary credentials first</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>                <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_netmiko_via_jump</span><span class="p">(</span><span class="n">device_ip</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2"> with primary credentials&quot;</span><span class="p">)</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a>            <span class="k">except</span> <span class="n">NetmikoAuthenticationException</span><span class="p">:</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>                <span class="c1"># Fall back to secondary credentials</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Primary auth failed on </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">, trying fallback...&quot;</span><span class="p">)</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>                <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_netmiko_via_jump</span><span class="p">(</span><span class="n">device_ip</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2"> with fallback credentials&quot;</span><span class="p">)</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>            <span class="c1"># Execute commands</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a>            <span class="n">ver_output</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;show version&quot;</span><span class="p">,</span> <span class="n">read_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span><span class="p">)</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a>            <span class="n">cdp_output</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a>                <span class="s2">&quot;show cdp neighbors detail&quot;</span><span class="p">,</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a>                <span class="n">read_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a>            <span class="p">)</span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Successfully collected data from </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a>            <span class="k">return</span> <span class="n">ver_output</span><span class="p">,</span> <span class="n">cdp_output</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a>        <span class="k">except</span> <span class="n">NetmikoAuthenticationException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a>            <span class="c1"># Don&#39;t retry auth failures</span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed on </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2"> (both credentials)&quot;</span><span class="p">)</span>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">authentication_errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">device_ip</span><span class="p">)</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a>            <span class="k">raise</span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a>        <span class="k">except</span> <span class="p">(</span><span class="n">NetmikoTimeoutException</span><span class="p">,</span> <span class="n">SSHException</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-22-54" name="__codelineno-22-54"></a>            <span class="c1"># Retry transient errors</span>
<a id="__codelineno-22-55" name="__codelineno-22-55"></a>            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-22-56" name="__codelineno-22-56"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> failed for </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-57" name="__codelineno-22-57"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Brief delay before retry</span>
<a id="__codelineno-22-58" name="__codelineno-22-58"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-22-59" name="__codelineno-22-59"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts failed for </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-60" name="__codelineno-22-60"></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
<a id="__codelineno-22-61" name="__codelineno-22-61"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_errors</span><span class="p">[</span><span class="n">device_ip</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-22-62" name="__codelineno-22-62"></a>                <span class="k">raise</span>
<a id="__codelineno-22-63" name="__codelineno-22-63"></a>
<a id="__codelineno-22-64" name="__codelineno-22-64"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-22-65" name="__codelineno-22-65"></a>            <span class="c1"># Always clean up connection</span>
<a id="__codelineno-22-66" name="__codelineno-22-66"></a>            <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
<a id="__codelineno-22-67" name="__codelineno-22-67"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-22-68" name="__codelineno-22-68"></a>                    <span class="n">conn</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<a id="__codelineno-22-69" name="__codelineno-22-69"></a>                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s1">&#39;_jump_client&#39;</span><span class="p">):</span>
<a id="__codelineno-22-70" name="__codelineno-22-70"></a>                        <span class="n">conn</span><span class="o">.</span><span class="n">_jump_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-22-71" name="__codelineno-22-71"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-22-72" name="__codelineno-22-72"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error disconnecting from </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Strategy:</strong></p>
<ol>
<li>Try with primary credentials</li>
<li>On auth failure, catch and retry with fallback (customizable fallback user on device)</li>
<li>Don't retry auth failures (credentials won't change between attempts)</li>
<li>Do retry transient errors (timeouts, SSH glitches) up to 3 times</li>
<li>Always disconnect in finally block (prevent socket leaks)</li>
</ol>
<p><strong>Why This Approach:</strong></p>
<ul>
<li>Maximizes success rate with two-credential strategy</li>
<li>Transient timeouts are retried (network glitches happen)</li>
<li>Auth failures fail-fast (no point retrying)</li>
<li>Finally block ensures resource cleanup (even on exceptions)</li>
<li>Separate tracking for auth vs. connection errors</li>
</ul>
<h3 id="parsing-and-intelligent-queueing">Parsing and Intelligent Queueing<a class="headerlink" href="#parsing-and-intelligent-queueing" title="Anchor link to this section">&para;</a></h3>
<h4 id="parse_outputs_and_enqueue_neighbors"><code>parse_outputs_and_enqueue_neighbors(...)</code><a class="headerlink" href="#parse_outputs_and_enqueue_neighbors" title="Anchor link to this section">&para;</a></h4>
<p>This is the <strong>intelligence</strong> of the discovery engine. It decides which devices to audit next.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span>
<span class="normal"><a href="#__codelineno-23-65">65</a></span>
<span class="normal"><a href="#__codelineno-23-66">66</a></span>
<span class="normal"><a href="#__codelineno-23-67">67</a></span>
<span class="normal"><a href="#__codelineno-23-68">68</a></span>
<span class="normal"><a href="#__codelineno-23-69">69</a></span>
<span class="normal"><a href="#__codelineno-23-70">70</a></span>
<span class="normal"><a href="#__codelineno-23-71">71</a></span>
<span class="normal"><a href="#__codelineno-23-72">72</a></span>
<span class="normal"><a href="#__codelineno-23-73">73</a></span>
<span class="normal"><a href="#__codelineno-23-74">74</a></span>
<span class="normal"><a href="#__codelineno-23-75">75</a></span>
<span class="normal"><a href="#__codelineno-23-76">76</a></span>
<span class="normal"><a href="#__codelineno-23-77">77</a></span>
<span class="normal"><a href="#__codelineno-23-78">78</a></span>
<span class="normal"><a href="#__codelineno-23-79">79</a></span>
<span class="normal"><a href="#__codelineno-23-80">80</a></span>
<span class="normal"><a href="#__codelineno-23-81">81</a></span>
<span class="normal"><a href="#__codelineno-23-82">82</a></span>
<span class="normal"><a href="#__codelineno-23-83">83</a></span>
<span class="normal"><a href="#__codelineno-23-84">84</a></span>
<span class="normal"><a href="#__codelineno-23-85">85</a></span>
<span class="normal"><a href="#__codelineno-23-86">86</a></span>
<span class="normal"><a href="#__codelineno-23-87">87</a></span>
<span class="normal"><a href="#__codelineno-23-88">88</a></span>
<span class="normal"><a href="#__codelineno-23-89">89</a></span>
<span class="normal"><a href="#__codelineno-23-90">90</a></span>
<span class="normal"><a href="#__codelineno-23-91">91</a></span>
<span class="normal"><a href="#__codelineno-23-92">92</a></span>
<span class="normal"><a href="#__codelineno-23-93">93</a></span>
<span class="normal"><a href="#__codelineno-23-94">94</a></span>
<span class="normal"><a href="#__codelineno-23-95">95</a></span>
<span class="normal"><a href="#__codelineno-23-96">96</a></span>
<span class="normal"><a href="#__codelineno-23-97">97</a></span>
<span class="normal"><a href="#__codelineno-23-98">98</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">parse_outputs_and_enqueue_neighbors</span><span class="p">(</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>    <span class="n">device_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>    <span class="n">ver_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="n">cdp_output</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="sd">    Parse command outputs and enqueue neighbor devices for discovery.</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="sd">    Three-step process:</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="sd">    1. Parse version output for device context (hostname, serial, uptime)</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="sd">    2. Parse CDP neighbors and extract details</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="sd">    3. Apply queueing heuristic to determine which neighbors to crawl</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="sd">    Queueing Heuristic:</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="sd">    - Only enqueue if ALL three conditions are true:</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="sd">      a) &quot;Switch&quot; in capabilities (infrastructure device)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="sd">      b) &quot;Host&quot; NOT in capabilities (not an endpoint)</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="sd">      c) Has management IP (addressable)</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="sd">    Args:</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="sd">        device_ip: Source device IP</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="sd">        ver_output: &#39;show version&#39; output</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="sd">        cdp_output: &#39;show cdp neighbors detail&#39; output</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>    <span class="c1"># Step 1: Parse Version Output for Device Context</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>        <span class="n">ver_parsed</span> <span class="o">=</span> <span class="n">textfsm_parser</span><span class="p">(</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>            <span class="n">raw_text</span><span class="o">=</span><span class="n">ver_output</span><span class="p">,</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>            <span class="n">template_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">VER_TEMPLATE</span><span class="p">)</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>        <span class="p">)</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>        <span class="k">if</span> <span class="n">ver_parsed</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ver_parsed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>            <span class="n">local_hostname</span> <span class="o">=</span> <span class="n">ver_parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">)</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>            <span class="n">local_serial</span> <span class="o">=</span> <span class="n">ver_parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;serial&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;N/A&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">ver_parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;serial&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;N/A&#39;</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>            <span class="n">local_uptime</span> <span class="o">=</span> <span class="n">ver_parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uptime&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>            <span class="n">local_hostname</span> <span class="o">=</span> <span class="n">device_ip</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>            <span class="n">local_serial</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>            <span class="n">local_uptime</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse &#39;show version&#39; for </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>        <span class="n">local_hostname</span> <span class="o">=</span> <span class="n">device_ip</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>        <span class="n">local_serial</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>        <span class="n">local_uptime</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>    <span class="c1"># Step 2: Parse CDP Neighbors</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>        <span class="n">cdp_parsed</span> <span class="o">=</span> <span class="n">textfsm_parser</span><span class="p">(</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>            <span class="n">raw_text</span><span class="o">=</span><span class="n">cdp_output</span><span class="p">,</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>            <span class="n">template_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CDP_TEMPLATE</span><span class="p">)</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>        <span class="p">)</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse CDP output for </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>        <span class="k">return</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">cdp_parsed</span><span class="p">:</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No CDP neighbors found for </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a>        <span class="k">return</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a>    <span class="c1"># Step 3: Process Each CDP Neighbor</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">cdp_parsed</span><span class="p">:</span>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a>            <span class="c1"># Extract CDP fields</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a>            <span class="n">dest_host</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;destination_host&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a>            <span class="n">local_port</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;local_port&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
<a id="__codelineno-23-66" name="__codelineno-23-66"></a>            <span class="n">remote_port</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;remote_port&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
<a id="__codelineno-23-67" name="__codelineno-23-67"></a>            <span class="n">mgmt_ip</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;management_ip&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-23-68" name="__codelineno-23-68"></a>            <span class="n">platform</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
<a id="__codelineno-23-69" name="__codelineno-23-69"></a>            <span class="n">capabilities</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;capabilities&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-23-70" name="__codelineno-23-70"></a>
<a id="__codelineno-23-71" name="__codelineno-23-71"></a>            <span class="c1"># Store CDP entry</span>
<a id="__codelineno-23-72" name="__codelineno-23-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cdp_neighbor_details</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-23-73" name="__codelineno-23-73"></a>                <span class="s1">&#39;LOCAL_HOST&#39;</span><span class="p">:</span> <span class="n">local_hostname</span><span class="p">,</span>
<a id="__codelineno-23-74" name="__codelineno-23-74"></a>                <span class="s1">&#39;LOCAL_IP&#39;</span><span class="p">:</span> <span class="n">device_ip</span><span class="p">,</span>
<a id="__codelineno-23-75" name="__codelineno-23-75"></a>                <span class="s1">&#39;LOCAL_PORT&#39;</span><span class="p">:</span> <span class="n">local_port</span><span class="p">,</span>
<a id="__codelineno-23-76" name="__codelineno-23-76"></a>                <span class="s1">&#39;LOCAL_SERIAL&#39;</span><span class="p">:</span> <span class="n">local_serial</span><span class="p">,</span>
<a id="__codelineno-23-77" name="__codelineno-23-77"></a>                <span class="s1">&#39;LOCAL_UPTIME&#39;</span><span class="p">:</span> <span class="n">local_uptime</span><span class="p">,</span>
<a id="__codelineno-23-78" name="__codelineno-23-78"></a>                <span class="s1">&#39;DESTINATION_HOST&#39;</span><span class="p">:</span> <span class="n">dest_host</span><span class="p">,</span>
<a id="__codelineno-23-79" name="__codelineno-23-79"></a>                <span class="s1">&#39;REMOTE_PORT&#39;</span><span class="p">:</span> <span class="n">remote_port</span><span class="p">,</span>
<a id="__codelineno-23-80" name="__codelineno-23-80"></a>                <span class="s1">&#39;MANAGEMENT_IP&#39;</span><span class="p">:</span> <span class="n">mgmt_ip</span><span class="p">,</span>
<a id="__codelineno-23-81" name="__codelineno-23-81"></a>                <span class="s1">&#39;PLATFORM&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="p">,</span>
<a id="__codelineno-23-82" name="__codelineno-23-82"></a>                <span class="s1">&#39;CAPABILITIES&#39;</span><span class="p">:</span> <span class="n">capabilities</span>
<a id="__codelineno-23-83" name="__codelineno-23-83"></a>            <span class="p">})</span>
<a id="__codelineno-23-84" name="__codelineno-23-84"></a>
<a id="__codelineno-23-85" name="__codelineno-23-85"></a>            <span class="c1"># Store hostname for DNS resolution</span>
<a id="__codelineno-23-86" name="__codelineno-23-86"></a>            <span class="k">if</span> <span class="n">dest_host</span> <span class="ow">and</span> <span class="n">dest_host</span> <span class="o">!=</span> <span class="s1">&#39;N/A&#39;</span><span class="p">:</span>
<a id="__codelineno-23-87" name="__codelineno-23-87"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dest_host</span><span class="p">)</span>
<a id="__codelineno-23-88" name="__codelineno-23-88"></a>
<a id="__codelineno-23-89" name="__codelineno-23-89"></a>            <span class="c1"># Apply Queueing Heuristic</span>
<a id="__codelineno-23-90" name="__codelineno-23-90"></a>            <span class="c1"># Only enqueue if: Switch device + not a Host + has management IP</span>
<a id="__codelineno-23-91" name="__codelineno-23-91"></a>            <span class="k">if</span> <span class="s2">&quot;Switch&quot;</span> <span class="ow">in</span> <span class="n">capabilities</span> <span class="ow">and</span> <span class="s2">&quot;Host&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">capabilities</span> <span class="ow">and</span> <span class="n">mgmt_ip</span><span class="p">:</span>
<a id="__codelineno-23-92" name="__codelineno-23-92"></a>                <span class="c1"># Check if already visited or queued</span>
<a id="__codelineno-23-93" name="__codelineno-23-93"></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_lock</span><span class="p">:</span>
<a id="__codelineno-23-94" name="__codelineno-23-94"></a>                    <span class="k">if</span> <span class="n">mgmt_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span> <span class="ow">and</span> <span class="n">dest_host</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
<a id="__codelineno-23-95" name="__codelineno-23-95"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">mgmt_ip</span><span class="p">)</span>
<a id="__codelineno-23-96" name="__codelineno-23-96"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mgmt_ip</span><span class="p">)</span>
<a id="__codelineno-23-97" name="__codelineno-23-97"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dest_host</span><span class="p">)</span>
<a id="__codelineno-23-98" name="__codelineno-23-98"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Queued for discovery: </span><span class="si">{</span><span class="n">dest_host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">mgmt_ip</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Three-Step Process:</strong></p>
<h3 id="step-1-parse-device-context"><strong>Step 1: Parse Device Context</strong><a class="headerlink" href="#step-1-parse-device-context" title="Anchor link to this section">&para;</a></h3>
<ul>
<li>Extract hostname, serial, uptime from <code>show version</code></li>
<li>Fall back to IP if parsing fails</li>
<li>This becomes the "LOCAL_HOST" in CDP entries</li>
</ul>
<h3 id="step-2-parse-cdp-neighbors"><strong>Step 2: Parse CDP Neighbors</strong><a class="headerlink" href="#step-2-parse-cdp-neighbors" title="Anchor link to this section">&para;</a></h3>
<ul>
<li>Extract each neighbor's details (ports, capabilities, management IP)</li>
<li>Store in thread-safe list</li>
<li>Add hostnames to DNS resolution set</li>
</ul>
<h3 id="step-3-apply-queueing-heuristic"><strong>Step 3: Apply Queueing Heuristic</strong><a class="headerlink" href="#step-3-apply-queueing-heuristic" title="Anchor link to this section">&para;</a></h3>
<p>Only enqueue if ALL three conditions are true:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="k">if</span> <span class="s2">&quot;Switch&quot;</span> <span class="ow">in</span> <span class="n">caps</span> <span class="ow">and</span> <span class="s2">&quot;Host&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">caps</span> <span class="ow">and</span> <span class="n">mgmt_ip</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why "Switch" in caps?</strong></p>
<ul>
<li>CDP capability strings like "Switch Router" identify infrastructure</li>
<li>We only want to audit infrastructure nodes, not endpoints</li>
</ul>
<p><strong>Why "Host" not in caps?</strong></p>
<ul>
<li>IP phones, printers, cameras also show up in CDP</li>
<li>Their capability includes "Host" but we can't/shouldn't manage them</li>
</ul>
<p><strong>Why mgmt_ip?</strong></p>
<ul>
<li>If a device doesn't advertise a management IP, we have no way to SSH to it</li>
<li>Queueing it would just cause failures</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>Router (Switch, Router) + 192.0.2.5  ‚Üí Queue it ‚úì
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>IP Phone (Host) + 192.0.2.50         ‚Üí Skip (endpoint) ‚úó
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>Access Point (Host) + no Mgmt IP     ‚Üí Skip (non-addressable) ‚úó
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>Switch (Switch) + 192.0.2.100        ‚Üí Queue it ‚úì
</code></pre></div></td></tr></table></div>
<p><strong>Deduplication:</strong></p>
<ul>
<li>Check both IP and hostname against <code>visited</code> set</li>
<li>Prevents discovering same device multiple times</li>
<li>Thread-safe with <code>visited_lock</code></li>
</ul>
<h3 id="worker-thread-pool">Worker Thread Pool<a class="headerlink" href="#worker-thread-pool" title="Anchor link to this section">&para;</a></h3>
<h4 id="discover_worker-none"><code>discover_worker() -&gt; None</code><a class="headerlink" href="#discover_worker-none" title="Anchor link to this section">&para;</a></h4>
<p>The worker thread function. Multiple instances run concurrently.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span>
<span class="normal"><a href="#__codelineno-26-34">34</a></span>
<span class="normal"><a href="#__codelineno-26-35">35</a></span>
<span class="normal"><a href="#__codelineno-26-36">36</a></span>
<span class="normal"><a href="#__codelineno-26-37">37</a></span>
<span class="normal"><a href="#__codelineno-26-38">38</a></span>
<span class="normal"><a href="#__codelineno-26-39">39</a></span>
<span class="normal"><a href="#__codelineno-26-40">40</a></span>
<span class="normal"><a href="#__codelineno-26-41">41</a></span>
<span class="normal"><a href="#__codelineno-26-42">42</a></span>
<span class="normal"><a href="#__codelineno-26-43">43</a></span>
<span class="normal"><a href="#__codelineno-26-44">44</a></span>
<span class="normal"><a href="#__codelineno-26-45">45</a></span>
<span class="normal"><a href="#__codelineno-26-46">46</a></span>
<span class="normal"><a href="#__codelineno-26-47">47</a></span>
<span class="normal"><a href="#__codelineno-26-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">discover_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="sd">    Worker thread function for parallel device discovery.</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="sd">    Loop:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="sd">    1. Get next host from queue (timeout=1.0 prevents hangs)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="sd">    2. Recognize sentinel (None = shutdown signal)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="sd">    3. Check if already visited (prevent duplicate work)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="sd">    4. Execute discovery with up to 3 retries</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="sd">    5. Parse outputs and enqueue new neighbors</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="sd">    6. Always call task_done() or queue.join() will hang</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>            <span class="c1"># Get next device from queue</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>            <span class="n">device_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>            <span class="c1"># Check for shutdown signal</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>            <span class="k">if</span> <span class="n">device_ip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Worker received shutdown signal&quot;</span><span class="p">)</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>                <span class="k">return</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a>            <span class="c1"># Double-check not already processed (race condition protection)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_lock</span><span class="p">:</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a>                <span class="k">if</span> <span class="n">device_ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2"> (already visited)&quot;</span><span class="p">)</span>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a>                    <span class="k">continue</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">device_ip</span><span class="p">)</span>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a>            <span class="c1"># Execute discovery</span>
<a id="__codelineno-26-33" name="__codelineno-26-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discovering: </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-34" name="__codelineno-26-34"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-26-35" name="__codelineno-26-35"></a>                <span class="n">ver_output</span><span class="p">,</span> <span class="n">cdp_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_device_commands</span><span class="p">(</span><span class="n">device_ip</span><span class="p">)</span>
<a id="__codelineno-26-36" name="__codelineno-26-36"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">parse_outputs_and_enqueue_neighbors</span><span class="p">(</span><span class="n">device_ip</span><span class="p">,</span> <span class="n">ver_output</span><span class="p">,</span> <span class="n">cdp_output</span><span class="p">)</span>
<a id="__codelineno-26-37" name="__codelineno-26-37"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-26-38" name="__codelineno-26-38"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to discover </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-39" name="__codelineno-26-39"></a>
<a id="__codelineno-26-40" name="__codelineno-26-40"></a>            <span class="c1"># Mark task as complete</span>
<a id="__codelineno-26-41" name="__codelineno-26-41"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<a id="__codelineno-26-42" name="__codelineno-26-42"></a>
<a id="__codelineno-26-43" name="__codelineno-26-43"></a>        <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
<a id="__codelineno-26-44" name="__codelineno-26-44"></a>            <span class="c1"># Queue is empty, poll again</span>
<a id="__codelineno-26-45" name="__codelineno-26-45"></a>            <span class="k">continue</span>
<a id="__codelineno-26-46" name="__codelineno-26-46"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-26-47" name="__codelineno-26-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker thread error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-48" name="__codelineno-26-48"></a>            <span class="k">continue</span>
</code></pre></div></td></tr></table></div>
<p><strong>Loop:</strong></p>
<ol>
<li>Get next host from queue (timeout=1.0 prevents hangs)</li>
<li>Recognize sentinel (None = shutdown signal)</li>
<li>Check if already visited (prevent duplicate work)</li>
<li>Execute discovery with up to 3 retries</li>
<li>Parse outputs and enqueue new neighbors</li>
<li>Always call <code>task_done()</code> or queue.join() will hang</li>
</ol>
<p><strong>Why Sentinel Pattern?</strong></p>
<ul>
<li>None signals worker to exit gracefully</li>
<li>Main thread sends one sentinel per worker</li>
<li>Coordinated shutdown without races</li>
<li>Clean alternative to threading.Event</li>
</ul>
<p><strong>Why Check If Already Visited?</strong></p>
<ul>
<li>Concurrent workers might both process same IP</li>
<li>Prevent duplicate discovery work</li>
<li>Track with hostname and IP</li>
<li>Race condition: device added to visited but not yet processed</li>
</ul>
<p><strong>Why task_done() Is Critical:</strong></p>
<p>Without <code>task_done()</code>, <code>queue.join()</code> waits forever on main thread. This is a common source of hangs in multi-threaded code!</p>
<h3 id="discovery-orchestration">Discovery Orchestration<a class="headerlink" href="#discovery-orchestration" title="Anchor link to this section">&para;</a></h3>
<h4 id="discover_from_seedsseeds-liststr-none"><code>discover_from_seeds(seeds: List[str]) -&gt; None</code><a class="headerlink" href="#discover_from_seedsseeds-liststr-none" title="Anchor link to this section">&para;</a></h4>
<p>Main orchestration function that kicks off discovery.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span>
<span class="normal"><a href="#__codelineno-27-20">20</a></span>
<span class="normal"><a href="#__codelineno-27-21">21</a></span>
<span class="normal"><a href="#__codelineno-27-22">22</a></span>
<span class="normal"><a href="#__codelineno-27-23">23</a></span>
<span class="normal"><a href="#__codelineno-27-24">24</a></span>
<span class="normal"><a href="#__codelineno-27-25">25</a></span>
<span class="normal"><a href="#__codelineno-27-26">26</a></span>
<span class="normal"><a href="#__codelineno-27-27">27</a></span>
<span class="normal"><a href="#__codelineno-27-28">28</a></span>
<span class="normal"><a href="#__codelineno-27-29">29</a></span>
<span class="normal"><a href="#__codelineno-27-30">30</a></span>
<span class="normal"><a href="#__codelineno-27-31">31</a></span>
<span class="normal"><a href="#__codelineno-27-32">32</a></span>
<span class="normal"><a href="#__codelineno-27-33">33</a></span>
<span class="normal"><a href="#__codelineno-27-34">34</a></span>
<span class="normal"><a href="#__codelineno-27-35">35</a></span>
<span class="normal"><a href="#__codelineno-27-36">36</a></span>
<span class="normal"><a href="#__codelineno-27-37">37</a></span>
<span class="normal"><a href="#__codelineno-27-38">38</a></span>
<span class="normal"><a href="#__codelineno-27-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">discover_from_seeds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seeds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="sd">    Start network discovery from seed devices.</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="sd">        seeds: List of seed device IPs</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting discovery with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span><span class="si">}</span><span class="s2"> seed device(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    <span class="c1"># Add seeds to queue</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">:</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_lock</span><span class="p">:</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>    <span class="c1"># Determine worker count</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a>    <span class="n">worker_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_LIMIT</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a>    <span class="c1"># Start worker threads</span>
<a id="__codelineno-27-20" name="__codelineno-27-20"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="n">worker_count</span><span class="si">}</span><span class="s2"> worker threads&quot;</span><span class="p">)</span>
<a id="__codelineno-27-21" name="__codelineno-27-21"></a>    <span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-27-22" name="__codelineno-27-22"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">worker_count</span><span class="p">):</span>
<a id="__codelineno-27-23" name="__codelineno-27-23"></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discover_worker</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Worker-</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-27-24" name="__codelineno-27-24"></a>        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-27-25" name="__codelineno-27-25"></a>        <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-27-26" name="__codelineno-27-26"></a>
<a id="__codelineno-27-27" name="__codelineno-27-27"></a>    <span class="c1"># Wait for queue to be empty</span>
<a id="__codelineno-27-28" name="__codelineno-27-28"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-27-29" name="__codelineno-27-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Discovery queue empty, shutting down workers...&quot;</span><span class="p">)</span>
<a id="__codelineno-27-30" name="__codelineno-27-30"></a>
<a id="__codelineno-27-31" name="__codelineno-27-31"></a>    <span class="c1"># Send shutdown signals</span>
<a id="__codelineno-27-32" name="__codelineno-27-32"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">worker_count</span><span class="p">):</span>
<a id="__codelineno-27-33" name="__codelineno-27-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Sentinel value</span>
<a id="__codelineno-27-34" name="__codelineno-27-34"></a>
<a id="__codelineno-27-35" name="__codelineno-27-35"></a>    <span class="c1"># Wait for all workers to finish</span>
<a id="__codelineno-27-36" name="__codelineno-27-36"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">workers</span><span class="p">:</span>
<a id="__codelineno-27-37" name="__codelineno-27-37"></a>        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-27-38" name="__codelineno-27-38"></a>
<a id="__codelineno-27-39" name="__codelineno-27-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All workers shut down&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Flow:</strong></p>
<ol>
<li>Add seeds to queue and mark as visited</li>
<li>Start worker threads (count from config)</li>
<li>Wait for queue to empty (<code>queue.join()</code>)</li>
<li>Send shutdown signals (one None per worker)</li>
<li>Wait for workers to finish (<code>thread.join()</code>)</li>
</ol>
<p><strong>Why This Approach:</strong></p>
<ul>
<li>Main thread waits for all work to complete</li>
<li>Graceful shutdown with sentinels</li>
<li>Workers clean up naturally</li>
<li>No orphaned threads</li>
</ul>
<h3 id="dns-resolution">DNS Resolution<a class="headerlink" href="#dns-resolution" title="Anchor link to this section">&para;</a></h3>
<h4 id="resolve_dns_parallel-none"><code>resolve_dns_parallel() -&gt; None</code><a class="headerlink" href="#resolve_dns_parallel-none" title="Anchor link to this section">&para;</a></h4>
<p>After discovery, resolve all discovered hostnames to IPs in parallel.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span>
<span class="normal"><a href="#__codelineno-28-32">32</a></span>
<span class="normal"><a href="#__codelineno-28-33">33</a></span>
<span class="normal"><a href="#__codelineno-28-34">34</a></span>
<span class="normal"><a href="#__codelineno-28-35">35</a></span>
<span class="normal"><a href="#__codelineno-28-36">36</a></span>
<span class="normal"><a href="#__codelineno-28-37">37</a></span>
<span class="normal"><a href="#__codelineno-28-38">38</a></span>
<span class="normal"><a href="#__codelineno-28-39">39</a></span>
<span class="normal"><a href="#__codelineno-28-40">40</a></span>
<span class="normal"><a href="#__codelineno-28-41">41</a></span>
<span class="normal"><a href="#__codelineno-28-42">42</a></span>
<span class="normal"><a href="#__codelineno-28-43">43</a></span>
<span class="normal"><a href="#__codelineno-28-44">44</a></span>
<span class="normal"><a href="#__codelineno-28-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">resolve_dns_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="sd">    Resolve all discovered hostnames to IPs in parallel.</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="sd">    Design:</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="sd">    - ThreadPoolExecutor with 4-32 workers (based on CDP_LIMIT)</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="sd">    - Submit all resolutions concurrently</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="sd">    - Collect results as they complete</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="sd">    - Best-effort - failures are logged but don&#39;t block</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="p">:</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No hostnames to resolve&quot;</span><span class="p">)</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a>        <span class="k">return</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resolving </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="p">)</span><span class="si">}</span><span class="s2"> hostnames...&quot;</span><span class="p">)</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>    <span class="c1"># Determine DNS worker count (min 4, max 32, based on CDP_LIMIT)</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a>    <span class="n">dns_workers</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DNS_MIN_WORKERS</span><span class="p">,</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a>        <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DNS_MAX_WORKERS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_LIMIT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>    <span class="p">)</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_one</span><span class="p">(</span><span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve a single hostname.&quot;&quot;&quot;</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a>            <span class="n">ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resolved </span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2"> ‚Üí </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a>            <span class="k">return</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">ip</span>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to resolve </span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a>            <span class="k">return</span> <span class="n">hostname</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span>
<a id="__codelineno-28-32" name="__codelineno-28-32"></a>
<a id="__codelineno-28-33" name="__codelineno-28-33"></a>    <span class="c1"># Parallel DNS resolution</span>
<a id="__codelineno-28-34" name="__codelineno-28-34"></a>    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">dns_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-28-35" name="__codelineno-28-35"></a>        <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">resolve_one</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span> <span class="n">hostname</span> <span class="k">for</span> <span class="n">hostname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="p">}</span>
<a id="__codelineno-28-36" name="__codelineno-28-36"></a>
<a id="__codelineno-28-37" name="__codelineno-28-37"></a>        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
<a id="__codelineno-28-38" name="__codelineno-28-38"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-28-39" name="__codelineno-28-39"></a>                <span class="n">hostname</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-28-40" name="__codelineno-28-40"></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
<a id="__codelineno-28-41" name="__codelineno-28-41"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">dns_ip</span><span class="p">[</span><span class="n">hostname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip</span>
<a id="__codelineno-28-42" name="__codelineno-28-42"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-28-43" name="__codelineno-28-43"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DNS resolution error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-28-44" name="__codelineno-28-44"></a>
<a id="__codelineno-28-45" name="__codelineno-28-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DNS resolution complete (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dns_ip</span><span class="p">)</span><span class="si">}</span><span class="s2"> resolved)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Design:</strong></p>
<ul>
<li>ThreadPoolExecutor with 4-32 workers (based on CDP_LIMIT)</li>
<li>Submit all resolutions concurrently</li>
<li>Collect results as they complete (don't wait for slowest)</li>
<li>Best-effort - failures are logged but don't block</li>
</ul>
<p><strong>Why Separate from Discovery?</strong></p>
<ul>
<li>DNS lookups are independent</li>
<li>Can run in smaller thread pool (4-32 vs. 10)</li>
<li>Doesn't block discovery if DNS is slow</li>
<li>Runs after discovery completes (no interference)</li>
</ul>
<p><strong>Why ThreadPoolExecutor?</strong></p>
<ul>
<li>Higher-level API than threading.Thread</li>
<li>Automatic worker management</li>
<li>Clean future-based result collection</li>
<li>Built-in exception handling</li>
</ul>
<hr />
<h2 id="excel-reporter-module-excel_reporterpy">üìä Excel Reporter Module (<code>excel_reporter.py</code>)<a class="headerlink" href="#excel-reporter-module-excel_reporterpy" title="Anchor link to this section">&para;</a></h2>
<p>Professional, template-driven Excel report generation.</p>
<h3 id="why-professional-reporting-matters">Why Professional Reporting Matters<a class="headerlink" href="#why-professional-reporting-matters" title="Anchor link to this section">&para;</a></h3>
<p><strong>The Problem:</strong> Raw CSV or unformatted Excel is not useful for business. Reports need context, formatting, branding.</p>
<p><strong>The Solution:</strong> Use a pre-formatted Excel template. Write data into it while preserving all formatting, charts, filters, and branding.</p>
<h3 id="module-architecture_2">Module Architecture<a class="headerlink" href="#module-architecture_2" title="Anchor link to this section">&para;</a></h3>
<p>The <code>excel_reporter.py</code> module exports a single class: <code>ExcelReporter</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span>
<span class="normal"><a href="#__codelineno-29-22">22</a></span>
<span class="normal"><a href="#__codelineno-29-23">23</a></span>
<span class="normal"><a href="#__codelineno-29-24">24</a></span>
<span class="normal"><a href="#__codelineno-29-25">25</a></span>
<span class="normal"><a href="#__codelineno-29-26">26</a></span>
<span class="normal"><a href="#__codelineno-29-27">27</a></span>
<span class="normal"><a href="#__codelineno-29-28">28</a></span>
<span class="normal"><a href="#__codelineno-29-29">29</a></span>
<span class="normal"><a href="#__codelineno-29-30">30</a></span>
<span class="normal"><a href="#__codelineno-29-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="sd">&quot;&quot;&quot;Professional Excel report generation with template preservation.&quot;&quot;&quot;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_workbook</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExcelReporter</span><span class="p">:</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate professional Excel reports from templates.&quot;&quot;&quot;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seeds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="sd">        Initialize Excel reporter.</span>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="sd">        Args:</span>
<a id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="sd">            site_name: Site name for filename and metadata</span>
<a id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="sd">            seeds: List of seed devices for metadata</span>
<a id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-29-24" name="__codelineno-29-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span> <span class="o">=</span> <span class="n">site_name</span>
<a id="__codelineno-29-25" name="__codelineno-29-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span> <span class="o">=</span> <span class="n">seeds</span>
<a id="__codelineno-29-26" name="__codelineno-29-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-29-27" name="__codelineno-29-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-29-28" name="__codelineno-29-28"></a>
<a id="__codelineno-29-29" name="__codelineno-29-29"></a>        <span class="c1"># Generate output filename</span>
<a id="__codelineno-29-30" name="__codelineno-29-30"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
<a id="__codelineno-29-31" name="__codelineno-29-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site_name</span><span class="si">}</span><span class="s2">_CDP_Network_Audit_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
</code></pre></div></td></tr></table></div>
<h3 id="template-driven-approach">Template-Driven Approach<a class="headerlink" href="#template-driven-approach" title="Anchor link to this section">&para;</a></h3>
<h3 id="step-1-copy-template"><strong>Step 1: Copy Template</strong><a class="headerlink" href="#step-1-copy-template" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span>
<span class="normal"><a href="#__codelineno-30-8">8</a></span>
<span class="normal"><a href="#__codelineno-30-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_copy_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy Excel template to output filename.&quot;&quot;&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>    <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_TEMPLATE</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excel template not found: </span><span class="si">{</span><span class="n">template_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">)</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied template to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Preserve metadata (timestamps, permissions) with <code>copy2</code>.</p>
<h3 id="step-2-stamp-metadata"><strong>Step 2: Stamp Metadata</strong><a class="headerlink" href="#step-2-stamp-metadata" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_stamp_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wb</span><span class="p">:</span> <span class="n">load_workbook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="sd">    Stamp metadata into specific cells.</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="sd">        wb: Loaded openpyxl workbook</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>    <span class="n">sheet_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_SHEETS</span><span class="p">[</span><span class="s1">&#39;audit&#39;</span><span class="p">]</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>    <span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>    <span class="c1"># Metadata to stamp</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_METADATA_CELLS</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_METADATA_CELLS</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_METADATA_CELLS</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">),</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_METADATA_CELLS</span><span class="p">[</span><span class="s1">&#39;primary_seed&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_METADATA_CELLS</span><span class="p">[</span><span class="s1">&#39;secondary_seed&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>    <span class="p">}</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>    <span class="c1"># Stamp cells</span>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a>    <span class="k">for</span> <span class="n">cell</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>        <span class="n">ws</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stamped </span><span class="si">{</span><span class="n">cell</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Fill cells B4-B8 with audit metadata (configured in YAML).</p>
<h3 id="step-3-append-data"><strong>Step 3: Append Data</strong><a class="headerlink" href="#step-3-append-data" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span>
<span class="normal"><a href="#__codelineno-32-42">42</a></span>
<span class="normal"><a href="#__codelineno-32-43">43</a></span>
<span class="normal"><a href="#__codelineno-32-44">44</a></span>
<span class="normal"><a href="#__codelineno-32-45">45</a></span>
<span class="normal"><a href="#__codelineno-32-46">46</a></span>
<span class="normal"><a href="#__codelineno-32-47">47</a></span>
<span class="normal"><a href="#__codelineno-32-48">48</a></span>
<span class="normal"><a href="#__codelineno-32-49">49</a></span>
<span class="normal"><a href="#__codelineno-32-50">50</a></span>
<span class="normal"><a href="#__codelineno-32-51">51</a></span>
<span class="normal"><a href="#__codelineno-32-52">52</a></span>
<span class="normal"><a href="#__codelineno-32-53">53</a></span>
<span class="normal"><a href="#__codelineno-32-54">54</a></span>
<span class="normal"><a href="#__codelineno-32-55">55</a></span>
<span class="normal"><a href="#__codelineno-32-56">56</a></span>
<span class="normal"><a href="#__codelineno-32-57">57</a></span>
<span class="normal"><a href="#__codelineno-32-58">58</a></span>
<span class="normal"><a href="#__codelineno-32-59">59</a></span>
<span class="normal"><a href="#__codelineno-32-60">60</a></span>
<span class="normal"><a href="#__codelineno-32-61">61</a></span>
<span class="normal"><a href="#__codelineno-32-62">62</a></span>
<span class="normal"><a href="#__codelineno-32-63">63</a></span>
<span class="normal"><a href="#__codelineno-32-64">64</a></span>
<span class="normal"><a href="#__codelineno-32-65">65</a></span>
<span class="normal"><a href="#__codelineno-32-66">66</a></span>
<span class="normal"><a href="#__codelineno-32-67">67</a></span>
<span class="normal"><a href="#__codelineno-32-68">68</a></span>
<span class="normal"><a href="#__codelineno-32-69">69</a></span>
<span class="normal"><a href="#__codelineno-32-70">70</a></span>
<span class="normal"><a href="#__codelineno-32-71">71</a></span>
<span class="normal"><a href="#__codelineno-32-72">72</a></span>
<span class="normal"><a href="#__codelineno-32-73">73</a></span>
<span class="normal"><a href="#__codelineno-32-74">74</a></span>
<span class="normal"><a href="#__codelineno-32-75">75</a></span>
<span class="normal"><a href="#__codelineno-32-76">76</a></span>
<span class="normal"><a href="#__codelineno-32-77">77</a></span>
<span class="normal"><a href="#__codelineno-32-78">78</a></span>
<span class="normal"><a href="#__codelineno-32-79">79</a></span>
<span class="normal"><a href="#__codelineno-32-80">80</a></span>
<span class="normal"><a href="#__codelineno-32-81">81</a></span>
<span class="normal"><a href="#__codelineno-32-82">82</a></span>
<span class="normal"><a href="#__codelineno-32-83">83</a></span>
<span class="normal"><a href="#__codelineno-32-84">84</a></span>
<span class="normal"><a href="#__codelineno-32-85">85</a></span>
<span class="normal"><a href="#__codelineno-32-86">86</a></span>
<span class="normal"><a href="#__codelineno-32-87">87</a></span>
<span class="normal"><a href="#__codelineno-32-88">88</a></span>
<span class="normal"><a href="#__codelineno-32-89">89</a></span>
<span class="normal"><a href="#__codelineno-32-90">90</a></span>
<span class="normal"><a href="#__codelineno-32-91">91</a></span>
<span class="normal"><a href="#__codelineno-32-92">92</a></span>
<span class="normal"><a href="#__codelineno-32-93">93</a></span>
<span class="normal"><a href="#__codelineno-32-94">94</a></span>
<span class="normal"><a href="#__codelineno-32-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>    <span class="n">cdp_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>    <span class="n">dns_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>    <span class="n">auth_errors</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>    <span class="n">conn_errors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="sd">    Generate Excel report with all data.</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="sd">    Args:</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="sd">        cdp_data: List of CDP neighbor dicts</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="sd">        dns_data: Dict of hostname -&gt; IP mappings</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="sd">        auth_errors: Set of IPs with auth failures</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="sd">        conn_errors: Dict of IP -&gt; error message</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="sd">    Returns:</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="sd">        Path to generated Excel file</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating Excel report...&quot;</span><span class="p">)</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a>    <span class="c1"># Step 1: Copy template</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_template</span><span class="p">()</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a>    <span class="c1"># Step 2: Load workbook</span>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a>    <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">)</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a>    <span class="c1"># Step 3: Stamp metadata</span>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_stamp_metadata</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a>    <span class="c1"># Step 4: Write data to sheets</span>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a>    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">,</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a>        <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">,</span>
<a id="__codelineno-32-35" name="__codelineno-32-35"></a>        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a>        <span class="n">if_sheet_exists</span><span class="o">=</span><span class="s1">&#39;overlay&#39;</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a>    <span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a>        <span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">wb</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a>        <span class="c1"># CDP Audit Data</span>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a>        <span class="k">if</span> <span class="n">cdp_data</span><span class="p">:</span>
<a id="__codelineno-32-42" name="__codelineno-32-42"></a>            <span class="n">df_cdp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cdp_data</span><span class="p">)</span>
<a id="__codelineno-32-43" name="__codelineno-32-43"></a>            <span class="n">df_cdp</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
<a id="__codelineno-32-44" name="__codelineno-32-44"></a>                <span class="n">writer</span><span class="p">,</span>
<a id="__codelineno-32-45" name="__codelineno-32-45"></a>                <span class="n">sheet_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_SHEETS</span><span class="p">[</span><span class="s1">&#39;audit&#39;</span><span class="p">],</span>
<a id="__codelineno-32-46" name="__codelineno-32-46"></a>                <span class="n">startrow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_DATA_START_ROWS</span><span class="p">[</span><span class="s1">&#39;audit&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-32-47" name="__codelineno-32-47"></a>                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-32-48" name="__codelineno-32-48"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-32-49" name="__codelineno-32-49"></a>            <span class="p">)</span>
<a id="__codelineno-32-50" name="__codelineno-32-50"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cdp_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> CDP entries&quot;</span><span class="p">)</span>
<a id="__codelineno-32-51" name="__codelineno-32-51"></a>
<a id="__codelineno-32-52" name="__codelineno-32-52"></a>        <span class="c1"># DNS Resolved Data</span>
<a id="__codelineno-32-53" name="__codelineno-32-53"></a>        <span class="k">if</span> <span class="n">dns_data</span><span class="p">:</span>
<a id="__codelineno-32-54" name="__codelineno-32-54"></a>            <span class="n">df_dns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
<a id="__codelineno-32-55" name="__codelineno-32-55"></a>                <span class="p">{</span><span class="s1">&#39;Hostname&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;IP Address&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
<a id="__codelineno-32-56" name="__codelineno-32-56"></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dns_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-32-57" name="__codelineno-32-57"></a>            <span class="p">])</span>
<a id="__codelineno-32-58" name="__codelineno-32-58"></a>            <span class="n">df_dns</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
<a id="__codelineno-32-59" name="__codelineno-32-59"></a>                <span class="n">writer</span><span class="p">,</span>
<a id="__codelineno-32-60" name="__codelineno-32-60"></a>                <span class="n">sheet_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_SHEETS</span><span class="p">[</span><span class="s1">&#39;dns&#39;</span><span class="p">],</span>
<a id="__codelineno-32-61" name="__codelineno-32-61"></a>                <span class="n">startrow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_DATA_START_ROWS</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-32-62" name="__codelineno-32-62"></a>                <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-32-63" name="__codelineno-32-63"></a>            <span class="p">)</span>
<a id="__codelineno-32-64" name="__codelineno-32-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dns_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> DNS entries&quot;</span><span class="p">)</span>
<a id="__codelineno-32-65" name="__codelineno-32-65"></a>
<a id="__codelineno-32-66" name="__codelineno-32-66"></a>        <span class="c1"># Authentication Errors</span>
<a id="__codelineno-32-67" name="__codelineno-32-67"></a>        <span class="k">if</span> <span class="n">auth_errors</span><span class="p">:</span>
<a id="__codelineno-32-68" name="__codelineno-32-68"></a>            <span class="n">df_auth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-32-69" name="__codelineno-32-69"></a>                <span class="nb">list</span><span class="p">(</span><span class="n">auth_errors</span><span class="p">),</span>
<a id="__codelineno-32-70" name="__codelineno-32-70"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Authentication Errors&#39;</span><span class="p">]</span>
<a id="__codelineno-32-71" name="__codelineno-32-71"></a>            <span class="p">)</span>
<a id="__codelineno-32-72" name="__codelineno-32-72"></a>            <span class="n">df_auth</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
<a id="__codelineno-32-73" name="__codelineno-32-73"></a>                <span class="n">writer</span><span class="p">,</span>
<a id="__codelineno-32-74" name="__codelineno-32-74"></a>                <span class="n">sheet_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_SHEETS</span><span class="p">[</span><span class="s1">&#39;auth_errors&#39;</span><span class="p">],</span>
<a id="__codelineno-32-75" name="__codelineno-32-75"></a>                <span class="n">startrow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_DATA_START_ROWS</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-32-76" name="__codelineno-32-76"></a>                <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-32-77" name="__codelineno-32-77"></a>            <span class="p">)</span>
<a id="__codelineno-32-78" name="__codelineno-32-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">auth_errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> auth errors&quot;</span><span class="p">)</span>
<a id="__codelineno-32-79" name="__codelineno-32-79"></a>
<a id="__codelineno-32-80" name="__codelineno-32-80"></a>        <span class="c1"># Connection Errors</span>
<a id="__codelineno-32-81" name="__codelineno-32-81"></a>        <span class="k">if</span> <span class="n">conn_errors</span><span class="p">:</span>
<a id="__codelineno-32-82" name="__codelineno-32-82"></a>            <span class="n">df_conn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
<a id="__codelineno-32-83" name="__codelineno-32-83"></a>                <span class="p">{</span><span class="s1">&#39;IP Address&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
<a id="__codelineno-32-84" name="__codelineno-32-84"></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">conn_errors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-32-85" name="__codelineno-32-85"></a>            <span class="p">])</span>
<a id="__codelineno-32-86" name="__codelineno-32-86"></a>            <span class="n">df_conn</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
<a id="__codelineno-32-87" name="__codelineno-32-87"></a>                <span class="n">writer</span><span class="p">,</span>
<a id="__codelineno-32-88" name="__codelineno-32-88"></a>                <span class="n">sheet_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_SHEETS</span><span class="p">[</span><span class="s1">&#39;conn_errors&#39;</span><span class="p">],</span>
<a id="__codelineno-32-89" name="__codelineno-32-89"></a>                <span class="n">startrow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">EXCEL_DATA_START_ROWS</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-32-90" name="__codelineno-32-90"></a>                <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-32-91" name="__codelineno-32-91"></a>            <span class="p">)</span>
<a id="__codelineno-32-92" name="__codelineno-32-92"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">conn_errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> connection errors&quot;</span><span class="p">)</span>
<a id="__codelineno-32-93" name="__codelineno-32-93"></a>
<a id="__codelineno-32-94" name="__codelineno-32-94"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úì Report generated: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-32-95" name="__codelineno-32-95"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span>
</code></pre></div></td></tr></table></div>
<p>Use <code>if_sheet_exists="overlay"</code> mode to append without destroying template.</p>
<p><strong>Why This Approach:</strong></p>
<ul>
<li><strong>Template-driven:</strong> Business controls formatting without touching code</li>
<li><strong>Non-destructive:</strong> Data is appended, template is preserved</li>
<li><strong>Professional:</strong> Charts, filters, styling all maintained</li>
<li><strong>Automated:</strong> No manual Excel editing required</li>
<li><strong>Configurable:</strong> Cell locations and sheet names in YAML</li>
</ul>
<p><strong>Key Parameters:</strong></p>
<ul>
<li><code>startrow</code>: Where to start writing data (after headers/metadata)</li>
<li><code>header=False</code>: Don't write column headers (template has them)</li>
<li><code>index=False</code>: Don't write row numbers</li>
<li><code>mode='a'</code>: Append mode</li>
<li><code>if_sheet_exists='overlay'</code>: Write over existing cells without deleting sheet</li>
</ul>
<hr />
<h2 id="cli-module-clipy">üéõÔ∏è CLI Module (<code>cli.py</code>)<a class="headerlink" href="#cli-module-clipy" title="Anchor link to this section">&para;</a></h2>
<p>The command-line interface and main application orchestrator.</p>
<h3 id="module-responsibilities">Module Responsibilities<a class="headerlink" href="#module-responsibilities" title="Anchor link to this section">&para;</a></h3>
<ul>
<li>Parse command-line arguments</li>
<li>Orchestrate the discovery workflow</li>
<li>Display progress and results</li>
<li>Handle user interrupts gracefully</li>
</ul>
<h3 id="main-workflow">Main Workflow<a class="headerlink" href="#main-workflow" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">  1</a></span>
<span class="normal"><a href="#__codelineno-33-2">  2</a></span>
<span class="normal"><a href="#__codelineno-33-3">  3</a></span>
<span class="normal"><a href="#__codelineno-33-4">  4</a></span>
<span class="normal"><a href="#__codelineno-33-5">  5</a></span>
<span class="normal"><a href="#__codelineno-33-6">  6</a></span>
<span class="normal"><a href="#__codelineno-33-7">  7</a></span>
<span class="normal"><a href="#__codelineno-33-8">  8</a></span>
<span class="normal"><a href="#__codelineno-33-9">  9</a></span>
<span class="normal"><a href="#__codelineno-33-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-33-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-33-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-33-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-33-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-33-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-33-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-33-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-33-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-33-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-33-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-33-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-33-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-33-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-33-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-33-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-33-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-33-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-33-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-33-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-33-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-33-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-33-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-33-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-33-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-33-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-33-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-33-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-33-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-33-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-33-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-33-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-33-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-33-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-33-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-33-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-33-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-33-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-33-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-33-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-33-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-33-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-33-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-33-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-33-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-33-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-33-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-33-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-33-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-33-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-33-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-33-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-33-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-33-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-33-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-33-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-33-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-33-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-33-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-33-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-33-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-33-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-33-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-33-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-33-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-33-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-33-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-33-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-33-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-33-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-33-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-33-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-33-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-33-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-33-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-33-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-33-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-33-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-33-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-33-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-33-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-33-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-33-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-33-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-33-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-33-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-33-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-33-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-33-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-33-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-33-100">100</a></span>
<span class="normal"><a href="#__codelineno-33-101">101</a></span>
<span class="normal"><a href="#__codelineno-33-102">102</a></span>
<span class="normal"><a href="#__codelineno-33-103">103</a></span>
<span class="normal"><a href="#__codelineno-33-104">104</a></span>
<span class="normal"><a href="#__codelineno-33-105">105</a></span>
<span class="normal"><a href="#__codelineno-33-106">106</a></span>
<span class="normal"><a href="#__codelineno-33-107">107</a></span>
<span class="normal"><a href="#__codelineno-33-108">108</a></span>
<span class="normal"><a href="#__codelineno-33-109">109</a></span>
<span class="normal"><a href="#__codelineno-33-110">110</a></span>
<span class="normal"><a href="#__codelineno-33-111">111</a></span>
<span class="normal"><a href="#__codelineno-33-112">112</a></span>
<span class="normal"><a href="#__codelineno-33-113">113</a></span>
<span class="normal"><a href="#__codelineno-33-114">114</a></span>
<span class="normal"><a href="#__codelineno-33-115">115</a></span>
<span class="normal"><a href="#__codelineno-33-116">116</a></span>
<span class="normal"><a href="#__codelineno-33-117">117</a></span>
<span class="normal"><a href="#__codelineno-33-118">118</a></span>
<span class="normal"><a href="#__codelineno-33-119">119</a></span>
<span class="normal"><a href="#__codelineno-33-120">120</a></span>
<span class="normal"><a href="#__codelineno-33-121">121</a></span>
<span class="normal"><a href="#__codelineno-33-122">122</a></span>
<span class="normal"><a href="#__codelineno-33-123">123</a></span>
<span class="normal"><a href="#__codelineno-33-124">124</a></span>
<span class="normal"><a href="#__codelineno-33-125">125</a></span>
<span class="normal"><a href="#__codelineno-33-126">126</a></span>
<span class="normal"><a href="#__codelineno-33-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="sd">&quot;&quot;&quot;Command-line interface and main orchestration.&quot;&quot;&quot;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit</span><span class="w"> </span><span class="kn">import</span> <span class="n">validators</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.credentials</span><span class="w"> </span><span class="kn">import</span> <span class="n">CredentialManager</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetworkDiscoverer</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.excel_reporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExcelReporter</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">prompt_for_inputs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="sd">    Orchestrate all interactive input collection.</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="sd">    Returns:</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="sd">        dict with keys: site_name, seeds (list)</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== CDP Network Audit ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a>    <span class="c1"># Site name</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a>    <span class="n">site_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter site name (used in Excel filename, max 50 chars): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">site_name</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Site name must be 1-50 characters&quot;</span><span class="p">)</span>
<a id="__codelineno-33-26" name="__codelineno-33-26"></a>
<a id="__codelineno-33-27" name="__codelineno-33-27"></a>    <span class="c1"># Seed devices</span>
<a id="__codelineno-33-28" name="__codelineno-33-28"></a>    <span class="n">seeds_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter one or more seed device IPs or hostnames (comma-separated): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-33-29" name="__codelineno-33-29"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">seeds_input</span><span class="p">:</span>
<a id="__codelineno-33-30" name="__codelineno-33-30"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one seed device is required&quot;</span><span class="p">)</span>
<a id="__codelineno-33-31" name="__codelineno-33-31"></a>
<a id="__codelineno-33-32" name="__codelineno-33-32"></a>    <span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seeds_input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
<a id="__codelineno-33-33" name="__codelineno-33-33"></a>
<a id="__codelineno-33-34" name="__codelineno-33-34"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-33-35" name="__codelineno-33-35"></a>        <span class="s1">&#39;site_name&#39;</span><span class="p">:</span> <span class="n">site_name</span><span class="p">,</span>
<a id="__codelineno-33-36" name="__codelineno-33-36"></a>        <span class="s1">&#39;seeds&#39;</span><span class="p">:</span> <span class="n">seeds</span>
<a id="__codelineno-33-37" name="__codelineno-33-37"></a>    <span class="p">}</span>
<a id="__codelineno-33-38" name="__codelineno-33-38"></a>
<a id="__codelineno-33-39" name="__codelineno-33-39"></a>
<a id="__codelineno-33-40" name="__codelineno-33-40"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-33-41" name="__codelineno-33-41"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-42" name="__codelineno-33-42"></a><span class="sd">    Main entry point for CDP Network Audit.</span>
<a id="__codelineno-33-43" name="__codelineno-33-43"></a>
<a id="__codelineno-33-44" name="__codelineno-33-44"></a><span class="sd">    Returns:</span>
<a id="__codelineno-33-45" name="__codelineno-33-45"></a><span class="sd">        Exit code (0 for success, 1 for failure)</span>
<a id="__codelineno-33-46" name="__codelineno-33-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-33-47" name="__codelineno-33-47"></a>    <span class="c1"># Set up logging</span>
<a id="__codelineno-33-48" name="__codelineno-33-48"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.logging_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_logging</span>
<a id="__codelineno-33-49" name="__codelineno-33-49"></a>    <span class="n">setup_logging</span><span class="p">()</span>
<a id="__codelineno-33-50" name="__codelineno-33-50"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-33-51" name="__codelineno-33-51"></a>
<a id="__codelineno-33-52" name="__codelineno-33-52"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-33-53" name="__codelineno-33-53"></a>        <span class="c1"># Step 1: Validate prerequisites</span>
<a id="__codelineno-33-54" name="__codelineno-33-54"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=== CDP Network Audit Tool ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-55" name="__codelineno-33-55"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validators</span><span class="o">.</span><span class="n">validate_all</span><span class="p">():</span>
<a id="__codelineno-33-56" name="__codelineno-33-56"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pre-flight validation failed&quot;</span><span class="p">)</span>
<a id="__codelineno-33-57" name="__codelineno-33-57"></a>            <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-33-58" name="__codelineno-33-58"></a>
<a id="__codelineno-33-59" name="__codelineno-33-59"></a>        <span class="c1"># Step 2: Collect user inputs</span>
<a id="__codelineno-33-60" name="__codelineno-33-60"></a>        <span class="n">inputs</span> <span class="o">=</span> <span class="n">prompt_for_inputs</span><span class="p">()</span>
<a id="__codelineno-33-61" name="__codelineno-33-61"></a>        <span class="n">site_name</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span>
<a id="__codelineno-33-62" name="__codelineno-33-62"></a>        <span class="n">seeds</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;seeds&#39;</span><span class="p">]</span>
<a id="__codelineno-33-63" name="__codelineno-33-63"></a>
<a id="__codelineno-33-64" name="__codelineno-33-64"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Site: </span><span class="si">{</span><span class="n">site_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-65" name="__codelineno-33-65"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seeds: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-66" name="__codelineno-33-66"></a>
<a id="__codelineno-33-67" name="__codelineno-33-67"></a>        <span class="c1"># Step 3: Collect credentials</span>
<a id="__codelineno-33-68" name="__codelineno-33-68"></a>        <span class="n">cred_manager</span> <span class="o">=</span> <span class="n">CredentialManager</span><span class="p">()</span>
<a id="__codelineno-33-69" name="__codelineno-33-69"></a>        <span class="n">credentials</span> <span class="o">=</span> <span class="n">cred_manager</span><span class="o">.</span><span class="n">collect_all_credentials</span><span class="p">()</span>
<a id="__codelineno-33-70" name="__codelineno-33-70"></a>
<a id="__codelineno-33-71" name="__codelineno-33-71"></a>        <span class="c1"># Step 4: Determine jump host</span>
<a id="__codelineno-33-72" name="__codelineno-33-72"></a>        <span class="n">jump_host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">JUMP_HOST</span>
<a id="__codelineno-33-73" name="__codelineno-33-73"></a>        <span class="k">if</span> <span class="n">jump_host</span><span class="p">:</span>
<a id="__codelineno-33-74" name="__codelineno-33-74"></a>            <span class="n">use_jump</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Use jump host &#39;</span><span class="si">{</span><span class="n">jump_host</span><span class="si">}</span><span class="s2">&#39;? [Y/n]: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-33-75" name="__codelineno-33-75"></a>            <span class="k">if</span> <span class="n">use_jump</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
<a id="__codelineno-33-76" name="__codelineno-33-76"></a>                <span class="n">jump_host</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-33-77" name="__codelineno-33-77"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-33-78" name="__codelineno-33-78"></a>            <span class="n">jump_host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter jump host IP/hostname (blank for direct): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-33-79" name="__codelineno-33-79"></a>
<a id="__codelineno-33-80" name="__codelineno-33-80"></a>        <span class="k">if</span> <span class="n">jump_host</span><span class="p">:</span>
<a id="__codelineno-33-81" name="__codelineno-33-81"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using jump host: </span><span class="si">{</span><span class="n">jump_host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-82" name="__codelineno-33-82"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-33-83" name="__codelineno-33-83"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using direct connections (no jump host)&quot;</span><span class="p">)</span>
<a id="__codelineno-33-84" name="__codelineno-33-84"></a>
<a id="__codelineno-33-85" name="__codelineno-33-85"></a>        <span class="c1"># Step 5: Execute discovery</span>
<a id="__codelineno-33-86" name="__codelineno-33-86"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Starting Network Discovery ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-87" name="__codelineno-33-87"></a>        <span class="n">discoverer</span> <span class="o">=</span> <span class="n">NetworkDiscoverer</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">jump_host</span><span class="p">)</span>
<a id="__codelineno-33-88" name="__codelineno-33-88"></a>        <span class="n">discoverer</span><span class="o">.</span><span class="n">discover_from_seeds</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
<a id="__codelineno-33-89" name="__codelineno-33-89"></a>
<a id="__codelineno-33-90" name="__codelineno-33-90"></a>        <span class="c1"># Step 6: DNS resolution</span>
<a id="__codelineno-33-91" name="__codelineno-33-91"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Resolving Hostnames ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-92" name="__codelineno-33-92"></a>        <span class="n">discoverer</span><span class="o">.</span><span class="n">resolve_dns_parallel</span><span class="p">()</span>
<a id="__codelineno-33-93" name="__codelineno-33-93"></a>
<a id="__codelineno-33-94" name="__codelineno-33-94"></a>        <span class="c1"># Step 7: Generate report</span>
<a id="__codelineno-33-95" name="__codelineno-33-95"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Generating Excel Report ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-96" name="__codelineno-33-96"></a>        <span class="n">reporter</span> <span class="o">=</span> <span class="n">ExcelReporter</span><span class="p">(</span><span class="n">site_name</span><span class="p">,</span> <span class="n">seeds</span><span class="p">)</span>
<a id="__codelineno-33-97" name="__codelineno-33-97"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span>
<a id="__codelineno-33-98" name="__codelineno-33-98"></a>            <span class="n">cdp_data</span><span class="o">=</span><span class="n">discoverer</span><span class="o">.</span><span class="n">cdp_neighbor_details</span><span class="p">,</span>
<a id="__codelineno-33-99" name="__codelineno-33-99"></a>            <span class="n">dns_data</span><span class="o">=</span><span class="n">discoverer</span><span class="o">.</span><span class="n">dns_ip</span><span class="p">,</span>
<a id="__codelineno-33-100" name="__codelineno-33-100"></a>            <span class="n">auth_errors</span><span class="o">=</span><span class="n">discoverer</span><span class="o">.</span><span class="n">authentication_errors</span><span class="p">,</span>
<a id="__codelineno-33-101" name="__codelineno-33-101"></a>            <span class="n">conn_errors</span><span class="o">=</span><span class="n">discoverer</span><span class="o">.</span><span class="n">connection_errors</span>
<a id="__codelineno-33-102" name="__codelineno-33-102"></a>        <span class="p">)</span>
<a id="__codelineno-33-103" name="__codelineno-33-103"></a>
<a id="__codelineno-33-104" name="__codelineno-33-104"></a>        <span class="c1"># Step 8: Display summary</span>
<a id="__codelineno-33-105" name="__codelineno-33-105"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-33-106" name="__codelineno-33-106"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DISCOVERY COMPLETE&quot;</span><span class="p">)</span>
<a id="__codelineno-33-107" name="__codelineno-33-107"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-33-108" name="__codelineno-33-108"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discovered devices:  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discoverer</span><span class="o">.</span><span class="n">visited</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-109" name="__codelineno-33-109"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CDP entries:         </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discoverer</span><span class="o">.</span><span class="n">cdp_neighbor_details</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-110" name="__codelineno-33-110"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DNS resolved:        </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discoverer</span><span class="o">.</span><span class="n">dns_ip</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-111" name="__codelineno-33-111"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auth errors:         </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discoverer</span><span class="o">.</span><span class="n">authentication_errors</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-112" name="__codelineno-33-112"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection errors:   </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discoverer</span><span class="o">.</span><span class="n">connection_errors</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-113" name="__codelineno-33-113"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Report saved to:     </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-114" name="__codelineno-33-114"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-115" name="__codelineno-33-115"></a>
<a id="__codelineno-33-116" name="__codelineno-33-116"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-33-117" name="__codelineno-33-117"></a>
<a id="__codelineno-33-118" name="__codelineno-33-118"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-33-119" name="__codelineno-33-119"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Discovery interrupted by user&quot;</span><span class="p">)</span>
<a id="__codelineno-33-120" name="__codelineno-33-120"></a>        <span class="k">return</span> <span class="mi">130</span>
<a id="__codelineno-33-121" name="__codelineno-33-121"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-33-122" name="__codelineno-33-122"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Fatal error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-33-123" name="__codelineno-33-123"></a>        <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-33-124" name="__codelineno-33-124"></a>
<a id="__codelineno-33-125" name="__codelineno-33-125"></a>
<a id="__codelineno-33-126" name="__codelineno-33-126"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-33-127" name="__codelineno-33-127"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Execution Flow:</strong></p>
<ol>
<li>Set up logging (<code>logging_setup.py</code>)</li>
<li>Run validators (<code>validators.py</code>)</li>
<li>Collect user inputs (site name, seeds)</li>
<li>Collect credentials (<code>credentials.py</code>)</li>
<li>Determine jump host (from config or prompt)</li>
<li>Execute discovery (<code>discovery.py</code>)</li>
<li>Resolve DNS in parallel</li>
<li>Generate Excel report (<code>excel_reporter.py</code>)</li>
<li>Display summary and exit</li>
</ol>
<p><strong>Error Handling:</strong></p>
<ul>
<li>Keyboard interrupt (Ctrl+C) returns exit code 130</li>
<li>Validation failures return exit code 1</li>
<li>Exceptions are logged with full traceback</li>
</ul>
<hr />
<h2 id="package-entry-point-__main__py">‚ö° Package Entry Point (<code>__main__.py</code>)<a class="headerlink" href="#package-entry-point-__main__py" title="Anchor link to this section">&para;</a></h2>
<p>The package entry point enables <code>python -m cdp_audit</code> execution.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span>
<span class="normal"><a href="#__codelineno-34-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="sd">&quot;&quot;&quot;Package entry point for python -m cdp_audit.&quot;&quot;&quot;</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>    <span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why This File?</strong></p>
<ul>
<li>Enables package-based execution</li>
<li>Python looks for <code>__main__.py</code> when you run <code>python -m &lt;package&gt;</code></li>
<li>Clean separation: <code>cli.py</code> has the logic, <code>__main__.py</code> is just the entry point</li>
<li>Follows Python packaging best practices</li>
</ul>
<hr />
<h2 id="configuration-access-app_configpy">üõ†Ô∏è Configuration Access (<code>app_config.py</code>)<a class="headerlink" href="#configuration-access-app_configpy" title="Anchor link to this section">&para;</a></h2>
<p>Centralized configuration access point for all modules.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span>
<span class="normal"><a href="#__codelineno-35-6">6</a></span>
<span class="normal"><a href="#__codelineno-35-7">7</a></span>
<span class="normal"><a href="#__codelineno-35-8">8</a></span>
<span class="normal"><a href="#__codelineno-35-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="sd">&quot;&quot;&quot;Centralized configuration access for all modules.&quot;&quot;&quot;</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ProgramFiles.config_files.config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="c1"># Create a single Config instance for the entire application</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="c1"># This module is imported by other modules to access configuration</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="c1"># Example: from cdp_audit.app_config import config</span>
</code></pre></div></td></tr></table></div>
<p><strong>Why This Module?</strong></p>
<ul>
<li><strong>Single source of truth:</strong> All modules import from here</li>
<li><strong>Lazy initialization:</strong> Config is only loaded once</li>
<li><strong>Easy mocking:</strong> Tests can replace this module to inject test config</li>
<li><strong>Clean imports:</strong> <code>from cdp_audit.app_config import config</code> instead of creating Config() everywhere</li>
</ul>
<hr />
<h2 id="logging-setup-logging_setuppy">üìù Logging Setup (<code>logging_setup.py</code>)<a class="headerlink" href="#logging-setup-logging_setuppy" title="Anchor link to this section">&para;</a></h2>
<p>Bootstrap logging for the entire application.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span>
<span class="normal"><a href="#__codelineno-36-28">28</a></span>
<span class="normal"><a href="#__codelineno-36-29">29</a></span>
<span class="normal"><a href="#__codelineno-36-30">30</a></span>
<span class="normal"><a href="#__codelineno-36-31">31</a></span>
<span class="normal"><a href="#__codelineno-36-32">32</a></span>
<span class="normal"><a href="#__codelineno-36-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="sd">&quot;&quot;&quot;Logging configuration bootstrap.&quot;&quot;&quot;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging.config</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="sd">    Configure logging for the application.</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="sd">    - If logging.conf exists, use it</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="sd">    - Otherwise, configure basic console logging</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>    <span class="n">logging_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;LOGGING_CONFIG&quot;</span><span class="p">,</span> <span class="s2">&quot;ProgramFiles/config_files/logging.conf&quot;</span><span class="p">)</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>    <span class="n">logging_config</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">logging_config_path</span><span class="p">)</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>    <span class="k">if</span> <span class="n">logging_config</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">fileConfig</span><span class="p">(</span><span class="n">logging_config</span><span class="p">,</span> <span class="n">disable_existing_loggers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logging configured from: </span><span class="si">{</span><span class="n">logging_config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a>            <span class="k">return</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not load logging config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a>    <span class="c1"># Fall back to basic console logging</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a>        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<a id="__codelineno-36-30" name="__codelineno-36-30"></a>        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a>        <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
<a id="__codelineno-36-32" name="__codelineno-36-32"></a>    <span class="p">)</span>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using basic console logging&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Features:</strong></p>
<ul>
<li>Tries to load <code>logging.conf</code> if it exists</li>
<li>Falls back to basic console logging</li>
<li>Respects <code>LOGGING_CONFIG</code> environment variable</li>
<li>Non-blocking: failures don't crash the app</li>
</ul>
<hr />
<h2 id="quick-start-using-the-launcher-recommended">üöÄ Quick Start: Using the Launcher (Recommended)<a class="headerlink" href="#quick-start-using-the-launcher-recommended" title="Anchor link to this section">&para;</a></h2>
<p>The repository includes a <strong>professional Windows batch launcher</strong> (<code>run.bat</code>) that provides the easiest way to run the tool.</p>
<h3 id="why-use-the-launcher">Why Use the Launcher?<a class="headerlink" href="#why-use-the-launcher" title="Anchor link to this section">&para;</a></h3>
<ul>
<li><strong>Zero configuration required</strong> - Just double-click or run from command line</li>
<li><strong>Automatic validation</strong> - Checks for Python environment and required files before execution</li>
<li><strong>Helpful diagnostics</strong> - Clear error messages if something is missing</li>
<li><strong>Professional interface</strong> - Clean output with status indicators and progress messages</li>
<li><strong>Safe execution</strong> - Validates environment before running the script</li>
</ul>
<h3 id="using-runbat">Using run.bat<a class="headerlink" href="#using-runbat" title="Anchor link to this section">&para;</a></h3>
<p><strong>Option 1: Double-click</strong></p>
<p>Simply double-click <code>run.bat</code> in Windows Explorer to launch the tool with default behavior.</p>
<p><strong>Option 2: Command Line</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>run.bat
</code></pre></div></td></tr></table></div>
<p>This runs the CDP Network Audit with all default settings from <code>config.yaml</code>.</p>
<h3 id="what-the-launcher-does">What the Launcher Does<a class="headerlink" href="#what-the-launcher-does" title="Anchor link to this section">&para;</a></h3>
<p>1 <strong>Validates the environment:</strong>
   - Checks that the <code>portable_env</code> virtual environment exists
   - Verifies Python executable is present
   - Confirms <code>cdp_audit</code> package exists
   - Validates required TextFSM templates are present
   - Validates Excel template exists</p>
<ol>
<li><strong>Provides clear feedback:</strong></li>
<li>Shows [OK] for successful checks</li>
<li>Shows [WARNING] for missing optional files</li>
<li>Shows [ERROR] for critical missing components</li>
<li>
<p>Displays helpful troubleshooting tips on failure</p>
</li>
<li>
<p><strong>Runs the tool:</strong></p>
</li>
<li>Activates the virtual environment</li>
<li>Executes <code>python -m cdp_audit</code></li>
<li>Captures and displays the exit code</li>
<li>Provides common troubleshooting tips if errors occur</li>
</ol>
<h3 id="example-output">Example Output<a class="headerlink" href="#example-output" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span>
<span class="normal"><a href="#__codelineno-38-23">23</a></span>
<span class="normal"><a href="#__codelineno-38-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>================================================================================
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>                    CDP NETWORK AUDIT TOOL
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>================================================================================
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>Starting validation checks...
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>[OK] Python Environment: Found at portable_env\Scripts\python.exe
<a id="__codelineno-38-8" name="__codelineno-38-8"></a>[OK] CDP Audit Package: Found at cdp_audit\__main__.py
<a id="__codelineno-38-9" name="__codelineno-38-9"></a>[OK] Required support files found
<a id="__codelineno-38-10" name="__codelineno-38-10"></a>[OK] All validation checks passed
<a id="__codelineno-38-11" name="__codelineno-38-11"></a>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a>================================================================================
<a id="__codelineno-38-13" name="__codelineno-38-13"></a>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a>Running CDP Network Audit...
<a id="__codelineno-38-15" name="__codelineno-38-15"></a>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a>================================================================================
<a id="__codelineno-38-17" name="__codelineno-38-17"></a>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a>[CDP Audit output appears here]
<a id="__codelineno-38-19" name="__codelineno-38-19"></a>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a>================================================================================
<a id="__codelineno-38-21" name="__codelineno-38-21"></a>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a>[SUCCESS] Script completed successfully
<a id="__codelineno-38-23" name="__codelineno-38-23"></a>
<a id="__codelineno-38-24" name="__codelineno-38-24"></a>================================================================================
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="how-to-run-interactive-flow">üöÄ How to Run (Interactive Flow)<a class="headerlink" href="#how-to-run-interactive-flow" title="Anchor link to this section">&para;</a></h2>
<ol>
<li>Ensure templates and Excel file exist under <code>ProgramFiles/...</code> (see above).</li>
<li>(Optional) Customize <code>config.yaml</code> with your organization's defaults.</li>
<li>(Optional) Set environment variables as needed for runtime overrides.</li>
<li>Run:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a>python<span class="w"> </span>-m<span class="w"> </span>cdp_audit
</code></pre></div></td></tr></table></div>
<ol>
<li>Follow prompts:</li>
<li>Site name (used in the output filename)</li>
<li>Seed devices (comma-separated IPv4 / resolvable hostnames)</li>
<li>Primary credentials (reads from CredMan if present; else prompts; optional save)</li>
<li>Fallback password (username from <code>config.yaml</code>; reads from CredMan if present; else prompts; optional save)</li>
<li>Jump server (from <code>config.yaml</code>, env var, or prompt; blank = direct)</li>
</ol>
<p>The tool validates/normalizes seeds to IP addresses, de-duplicates them, then starts the threaded discovery.</p>
<hr />
<h2 id="what-gets-collected">üß™ What Gets Collected<a class="headerlink" href="#what-gets-collected" title="Anchor link to this section">&para;</a></h2>
<p>For each visited device the tool attempts to collect:</p>
<ul>
<li><code>show version</code> (hostname, serials, uptime) ‚Äî for local context.</li>
<li><code>show cdp neighbors detail</code> ‚Äî parsed into structured rows.</li>
<li>DNS resolution for all discovered hostnames (best-effort), in parallel.</li>
</ul>
<h3 id="discovery-heuristics">Discovery Heuristics<a class="headerlink" href="#discovery-heuristics" title="Anchor link to this section">&para;</a></h3>
<ul>
<li>Only Switch-capable CDP entries (and not hosts) with a management IP are queued as crawl candidates.</li>
<li>Deduplication is performed by hostname and IP to reduce churn.</li>
<li>Each target is retried up to 3 times for transient connectivity issues.</li>
</ul>
<hr />
<h2 id="jump-server-behavior">üåê Jump Server Behavior<a class="headerlink" href="#jump-server-behavior" title="Anchor link to this section">&para;</a></h2>
<ul>
<li>Set <code>jump_host</code> in the <code>network</code> section of <code>config.yaml</code> to specify a default jump host.</li>
<li>Alternatively, use the <code>CDP_JUMP_SERVER</code> environment variable to override at runtime.</li>
<li>If empty, you will be prompted during runtime; leaving it blank uses direct device connections.</li>
<li>The jump is created with Paramiko and a <code>direct-tcpip</code> channel; Netmiko is then bound to that channel (no local listener required).</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Host key policy defaults to a warning (accepts unknown keys but logs a warning). For production environments, prefer strict host key checking via <code>known_hosts</code> management.</p>
<p><strong>Tip:</strong> Configure your jump server in <code>config.yaml</code> (<code>jump_host: "192.0.2.10"</code>) for permanent use, or leave it empty to be prompted each time for flexibility.</p>
</blockquote>
<hr />
<h2 id="excel-report-output">üìä Excel Report Output<a class="headerlink" href="#excel-report-output" title="Anchor link to this section">&para;</a></h2>
<p>An output file named <code>&lt;site_name&gt;_CDP_Network_Audit_&lt;timestamp&gt;.xlsx</code> is created by copying the template.</p>
<h3 id="sheets">Sheets<a class="headerlink" href="#sheets" title="Anchor link to this section">&para;</a></h3>
<ul>
<li><strong>Audit</strong> ‚Äî Main CDP dataset. Also stamped with metadata:</li>
<li><code>B4</code>: Site name</li>
<li><code>B5</code>: Date</li>
<li><code>B6</code>: Time</li>
<li><code>B7</code>: Primary seed</li>
<li><code>B8</code>: Secondary seed (or "N/A")</li>
<li><strong>DNS Resolved</strong> ‚Äî Two columns: <code>Hostname</code>, <code>IP Address</code></li>
<li><strong>Authentication Errors</strong> ‚Äî One column: <code>Authentication Errors</code> (IP list)</li>
<li><strong>Connection Errors</strong> ‚Äî Two columns: <code>IP Address</code>, <code>Error</code></li>
</ul>
<h3 id="columns-in-audit-data-rows">Columns in Audit (Data Rows)<a class="headerlink" href="#columns-in-audit-data-rows" title="Anchor link to this section">&para;</a></h3>
<p><code>LOCAL_HOST</code>, <code>LOCAL_IP</code>, <code>LOCAL_PORT</code>, <code>LOCAL_SERIAL</code>, <code>LOCAL_UPTIME</code>, <code>DESTINATION_HOST</code>, <code>REMOTE_PORT</code>, <code>MANAGEMENT_IP</code>, <code>PLATFORM</code>.</p>
<blockquote>
<p><strong>Note:</strong> The template governs formatting/filters/charts (if any). The writer appends data starting at the appropriate row offsets to preserve the layout.</p>
</blockquote>
<hr />
<h2 id="key-design-patterns">üîë Key Design Patterns<a class="headerlink" href="#key-design-patterns" title="Anchor link to this section">&para;</a></h2>
<h3 id="pattern-1-modular-package-structure">Pattern 1: Modular Package Structure<a class="headerlink" href="#pattern-1-modular-package-structure" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1"># Clean imports from package modules</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.credentials</span><span class="w"> </span><span class="kn">import</span> <span class="n">CredentialManager</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetworkDiscoverer</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Each module has a single responsibility. Changes to one don't affect others.</p>
<h3 id="pattern-2-centralized-configuration">Pattern 2: Centralized Configuration<a class="headerlink" href="#pattern-2-centralized-configuration" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span>
<span class="normal"><a href="#__codelineno-41-4">4</a></span>
<span class="normal"><a href="#__codelineno-41-5">5</a></span>
<span class="normal"><a href="#__codelineno-41-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># All modules import from app_config</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cdp_audit.app_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="c1"># Single source of truth</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="n">jump_host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">JUMP_HOST</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="n">timeout</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>
</code></pre></div></td></tr></table></div>
<p>Configuration is centralized and consistent across all modules.</p>
<h3 id="pattern-3-thread-safe-data-accumulation">Pattern 3: Thread-Safe Data Accumulation<a class="headerlink" href="#pattern-3-thread-safe-data-accumulation" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Only one thread updates shared data at a time.</p>
<h3 id="pattern-4-graceful-worker-shutdown">Pattern 4: Graceful Worker Shutdown<a class="headerlink" href="#pattern-4-graceful-worker-shutdown" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span>
<span class="normal"><a href="#__codelineno-43-5">5</a></span>
<span class="normal"><a href="#__codelineno-43-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">):</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>    <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Sentinel</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="c1"># In worker</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>    <span class="k">return</span>  <span class="c1"># Exit gracefully</span>
</code></pre></div></td></tr></table></div>
<p>Coordinated shutdown without race conditions.</p>
<h3 id="pattern-5-retry-with-fallback-credentials">Pattern 5: Retry with Fallback Credentials<a class="headerlink" href="#pattern-5-retry-with-fallback-credentials" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">primary_user</span><span class="p">,</span> <span class="n">primary_pass</span><span class="p">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="k">except</span> <span class="n">AuthenticationException</span><span class="p">:</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">fallback_user</span><span class="p">,</span> <span class="n">fallback_pass</span><span class="p">)</span>  <span class="c1"># Fallback</span>
</code></pre></div></td></tr></table></div>
<p>Maximizes success rate with two-credential strategy.</p>
<h3 id="pattern-6-resource-cleanup-in-finally">Pattern 6: Resource Cleanup in Finally<a class="headerlink" href="#pattern-6-resource-cleanup-in-finally" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span>
<span class="normal"><a href="#__codelineno-45-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">()</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a>    <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>  <span class="c1"># ALWAYS happens</span>
</code></pre></div></td></tr></table></div>
<p>Prevents resource leaks even on exceptions.</p>
<h3 id="pattern-7-template-driven-reporting">Pattern 7: Template-Driven Reporting<a class="headerlink" href="#pattern-7-template-driven-reporting" title="Anchor link to this section">&para;</a></h3>
<p>Copy ‚Üí stamp metadata ‚Üí append data using overlay mode.</p>
<h3 id="pattern-8-fail-fast-validation">Pattern 8: Fail-Fast Validation<a class="headerlink" href="#pattern-8-fail-fast-validation" title="Anchor link to this section">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">validators</span><span class="o">.</span><span class="n">validate_all</span><span class="p">():</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Catch problems before expensive operations begin.</p>
<hr />
<h2 id="logging">üß∞ Logging<a class="headerlink" href="#logging" title="Anchor link to this section">&para;</a></h2>
<ul>
<li>Logging is configured via <code>logging_setup.py</code> module</li>
<li>If a <code>logging.conf</code> file is present, logging is configured via <code>logging.config.fileConfig()</code></li>
<li>Otherwise, a basic console logger is configured at INFO with timestamps</li>
<li>You can set <code>LOGGING_CONFIG</code> environment variable to point to an INI file anywhere</li>
<li>Each module logs with its own name for easy filtering</li>
</ul>
<hr />
<h2 id="errors-retry-behavior">üßØ Errors &amp; Retry Behavior<a class="headerlink" href="#errors-retry-behavior" title="Anchor link to this section">&para;</a></h2>
<ul>
<li><strong>Authentication failures</strong>: the host is recorded under Authentication Errors</li>
<li><strong>Connectivity/timeouts</strong>: the host is recorded under Connection Errors with the last error tag (e.g., <code>NetmikoTimeoutException</code>, <code>SSHException</code>, <code>socket.timeout</code>)</li>
<li><strong>Retries</strong>: up to 3 attempts for each device before recording a connection error</li>
<li><strong>Graceful exit</strong>: workers always <code>task_done()</code> to avoid queue hangs</li>
</ul>
<hr />
<h2 id="performance">üìà Performance<a class="headerlink" href="#performance" title="Anchor link to this section">&para;</a></h2>
<ul>
<li>Worker threads = <code>CDP_LIMIT</code> (default 10)</li>
<li>DNS resolution runs in a small parallel pool after discovery</li>
<li>Use a conservative limit on older/CPU-bound platforms; increase on fast links</li>
</ul>
<hr />
<h2 id="security-considerations">üîí Security Considerations<a class="headerlink" href="#security-considerations" title="Anchor link to this section">&para;</a></h2>
<ul>
<li>Prefer Credential Manager (Windows) or other secret stores instead of plaintext</li>
<li>Ensure jump host is hardened; consider strict host key verification</li>
<li>Output workbooks can contain sensitive topology data ‚Äî share on a need-to-know basis</li>
</ul>
<hr />
<h2 id="exit-codes">‚ùå Exit Codes<a class="headerlink" href="#exit-codes" title="Anchor link to this section">&para;</a></h2>
<ul>
<li><strong>0</strong> ‚Äî Success</li>
<li><strong>1</strong> ‚Äî Required TextFSM or Excel template missing / invalid / fatal error</li>
<li><strong>130</strong> ‚Äî Interrupted by user (Ctrl+C)</li>
</ul>
<hr />
<h2 id="example-session">‚úÖ Example Session<a class="headerlink" href="#example-session" title="Anchor link to this section">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span>
<span class="normal"><a href="#__codelineno-47-24">24</a></span>
<span class="normal"><a href="#__codelineno-47-25">25</a></span>
<span class="normal"><a href="#__codelineno-47-26">26</a></span>
<span class="normal"><a href="#__codelineno-47-27">27</a></span>
<span class="normal"><a href="#__codelineno-47-28">28</a></span>
<span class="normal"><a href="#__codelineno-47-29">29</a></span>
<span class="normal"><a href="#__codelineno-47-30">30</a></span>
<span class="normal"><a href="#__codelineno-47-31">31</a></span>
<span class="normal"><a href="#__codelineno-47-32">32</a></span>
<span class="normal"><a href="#__codelineno-47-33">33</a></span>
<span class="normal"><a href="#__codelineno-47-34">34</a></span>
<span class="normal"><a href="#__codelineno-47-35">35</a></span>
<span class="normal"><a href="#__codelineno-47-36">36</a></span>
<span class="normal"><a href="#__codelineno-47-37">37</a></span>
<span class="normal"><a href="#__codelineno-47-38">38</a></span>
<span class="normal"><a href="#__codelineno-47-39">39</a></span>
<span class="normal"><a href="#__codelineno-47-40">40</a></span>
<span class="normal"><a href="#__codelineno-47-41">41</a></span>
<span class="normal"><a href="#__codelineno-47-42">42</a></span>
<span class="normal"><a href="#__codelineno-47-43">43</a></span>
<span class="normal"><a href="#__codelineno-47-44">44</a></span>
<span class="normal"><a href="#__codelineno-47-45">45</a></span>
<span class="normal"><a href="#__codelineno-47-46">46</a></span>
<span class="normal"><a href="#__codelineno-47-47">47</a></span>
<span class="normal"><a href="#__codelineno-47-48">48</a></span>
<span class="normal"><a href="#__codelineno-47-49">49</a></span>
<span class="normal"><a href="#__codelineno-47-50">50</a></span>
<span class="normal"><a href="#__codelineno-47-51">51</a></span>
<span class="normal"><a href="#__codelineno-47-52">52</a></span>
<span class="normal"><a href="#__codelineno-47-53">53</a></span>
<span class="normal"><a href="#__codelineno-47-54">54</a></span>
<span class="normal"><a href="#__codelineno-47-55">55</a></span>
<span class="normal"><a href="#__codelineno-47-56">56</a></span>
<span class="normal"><a href="#__codelineno-47-57">57</a></span>
<span class="normal"><a href="#__codelineno-47-58">58</a></span>
<span class="normal"><a href="#__codelineno-47-59">59</a></span>
<span class="normal"><a href="#__codelineno-47-60">60</a></span>
<span class="normal"><a href="#__codelineno-47-61">61</a></span>
<span class="normal"><a href="#__codelineno-47-62">62</a></span>
<span class="normal"><a href="#__codelineno-47-63">63</a></span>
<span class="normal"><a href="#__codelineno-47-64">64</a></span>
<span class="normal"><a href="#__codelineno-47-65">65</a></span>
<span class="normal"><a href="#__codelineno-47-66">66</a></span>
<span class="normal"><a href="#__codelineno-47-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>=== CDP Network Audit ===
<a id="__codelineno-47-2" name="__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a>Enter site name (used in Excel filename, max 50 chars): HQ-Campus
<a id="__codelineno-47-4" name="__codelineno-47-4"></a>Enter one or more seed device IPs or hostnames (comma-separated): 192.0.2.11, core-sw-1
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a>=== Credential Collection ===
<a id="__codelineno-47-7" name="__codelineno-47-7"></a>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a>Collecting primary credentials (used for jump and devices)...
<a id="__codelineno-47-9" name="__codelineno-47-9"></a>Enter primary username: netadmin
<a id="__codelineno-47-10" name="__codelineno-47-10"></a>Enter primary password: ********
<a id="__codelineno-47-11" name="__codelineno-47-11"></a>Store credentials in Credential Manager as &#39;MyApp/ADM&#39;? [y/N]: y
<a id="__codelineno-47-12" name="__codelineno-47-12"></a>‚úì Credentials saved to Credential Manager: MyApp/ADM
<a id="__codelineno-47-13" name="__codelineno-47-13"></a>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a>Collecting fallback credentials (username: answer)...
<a id="__codelineno-47-15" name="__codelineno-47-15"></a>Using fallback username from config: answer
<a id="__codelineno-47-16" name="__codelineno-47-16"></a>Enter &#39;answer&#39; password: ********
<a id="__codelineno-47-17" name="__codelineno-47-17"></a>Store credentials in Credential Manager as &#39;MyApp/Answer&#39;? [y/N]: y
<a id="__codelineno-47-18" name="__codelineno-47-18"></a>‚úì Credentials saved to Credential Manager: MyApp/Answer
<a id="__codelineno-47-19" name="__codelineno-47-19"></a>
<a id="__codelineno-47-20" name="__codelineno-47-20"></a>Use jump host &#39;192.0.2.10&#39;? [Y/n]: 
<a id="__codelineno-47-21" name="__codelineno-47-21"></a>
<a id="__codelineno-47-22" name="__codelineno-47-22"></a>=== Running Pre-Flight Validation ===
<a id="__codelineno-47-23" name="__codelineno-47-23"></a>
<a id="__codelineno-47-24" name="__codelineno-47-24"></a>‚úì CDP Template found: ProgramFiles/textfsm/cisco_ios_show_cdp_neighbors_detail.textfsm
<a id="__codelineno-47-25" name="__codelineno-47-25"></a>‚úì Version Template found: ProgramFiles/textfsm/cisco_ios_show_version.textfsm
<a id="__codelineno-47-26" name="__codelineno-47-26"></a>‚úì Excel template valid: ProgramFiles/config_files/1 - CDP Network Audit _ Template.xlsx
<a id="__codelineno-47-27" name="__codelineno-47-27"></a>
<a id="__codelineno-47-28" name="__codelineno-47-28"></a>‚úì All validation checks passed
<a id="__codelineno-47-29" name="__codelineno-47-29"></a>
<a id="__codelineno-47-30" name="__codelineno-47-30"></a>=== Starting Network Discovery ===
<a id="__codelineno-47-31" name="__codelineno-47-31"></a>
<a id="__codelineno-47-32" name="__codelineno-47-32"></a>INFO Starting discovery with 2 seed device(s)
<a id="__codelineno-47-33" name="__codelineno-47-33"></a>INFO Starting 10 worker threads
<a id="__codelineno-47-34" name="__codelineno-47-34"></a>INFO Discovering: 192.0.2.11
<a id="__codelineno-47-35" name="__codelineno-47-35"></a>INFO ‚úì Successfully collected data from 192.0.2.11
<a id="__codelineno-47-36" name="__codelineno-47-36"></a>INFO Queued for discovery: access-sw-01 (192.0.2.50)
<a id="__codelineno-47-37" name="__codelineno-47-37"></a>INFO Queued for discovery: access-sw-02 (192.0.2.51)
<a id="__codelineno-47-38" name="__codelineno-47-38"></a>... (more discovery logs) ...
<a id="__codelineno-47-39" name="__codelineno-47-39"></a>INFO Discovery queue empty, shutting down workers...
<a id="__codelineno-47-40" name="__codelineno-47-40"></a>INFO All workers shut down
<a id="__codelineno-47-41" name="__codelineno-47-41"></a>
<a id="__codelineno-47-42" name="__codelineno-47-42"></a>=== Resolving Hostnames ===
<a id="__codelineno-47-43" name="__codelineno-47-43"></a>
<a id="__codelineno-47-44" name="__codelineno-47-44"></a>INFO Resolving 42 hostnames...
<a id="__codelineno-47-45" name="__codelineno-47-45"></a>INFO DNS resolution complete (42 resolved)
<a id="__codelineno-47-46" name="__codelineno-47-46"></a>
<a id="__codelineno-47-47" name="__codelineno-47-47"></a>=== Generating Excel Report ===
<a id="__codelineno-47-48" name="__codelineno-47-48"></a>
<a id="__codelineno-47-49" name="__codelineno-47-49"></a>INFO Generating Excel report...
<a id="__codelineno-47-50" name="__codelineno-47-50"></a>INFO Copied template to: HQ-Campus_CDP_Network_Audit_20260214_143022.xlsx
<a id="__codelineno-47-51" name="__codelineno-47-51"></a>INFO Wrote 314 CDP entries
<a id="__codelineno-47-52" name="__codelineno-47-52"></a>INFO Wrote 42 DNS entries
<a id="__codelineno-47-53" name="__codelineno-47-53"></a>INFO Wrote 1 auth errors
<a id="__codelineno-47-54" name="__codelineno-47-54"></a>INFO Wrote 3 connection errors
<a id="__codelineno-47-55" name="__codelineno-47-55"></a>INFO ‚úì Report generated: HQ-Campus_CDP_Network_Audit_20260214_143022.xlsx
<a id="__codelineno-47-56" name="__codelineno-47-56"></a>
<a id="__codelineno-47-57" name="__codelineno-47-57"></a>============================================================
<a id="__codelineno-47-58" name="__codelineno-47-58"></a>DISCOVERY COMPLETE
<a id="__codelineno-47-59" name="__codelineno-47-59"></a>============================================================
<a id="__codelineno-47-60" name="__codelineno-47-60"></a>Discovered devices:  42
<a id="__codelineno-47-61" name="__codelineno-47-61"></a>CDP entries:         314
<a id="__codelineno-47-62" name="__codelineno-47-62"></a>DNS resolved:        42
<a id="__codelineno-47-63" name="__codelineno-47-63"></a>Auth errors:         1
<a id="__codelineno-47-64" name="__codelineno-47-64"></a>Connection errors:   3
<a id="__codelineno-47-65" name="__codelineno-47-65"></a>
<a id="__codelineno-47-66" name="__codelineno-47-66"></a>Report saved to:     HQ-Campus_CDP_Network_Audit_20260214_143022.xlsx
<a id="__codelineno-47-67" name="__codelineno-47-67"></a>============================================================
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="customization-points">üõ†Ô∏è Customization Points<a class="headerlink" href="#customization-points" title="Anchor link to this section">&para;</a></h2>
<ul>
<li><strong>User settings</strong>: Edit <code>config.yaml</code> to customize worker threads, timeouts, jump server, credential targets, and fallback username</li>
<li><strong>Template paths</strong>: Adjust in <code>config.yaml</code> under the <code>file_paths</code> section</li>
<li><strong>Queueing heuristics</strong> (which neighbors to crawl): Modify <code>parse_outputs_and_enqueue_neighbors()</code> in <code>discovery.py</code></li>
<li><strong>Retry counts / timeouts</strong>: Configure in <code>config.yaml</code> under <code>network</code> or override via environment variables</li>
<li><strong>Logging</strong>: Provide a <code>logging.conf</code> that matches your standards (path configurable via <code>LOGGING_CONFIG</code> env var)</li>
<li><strong>Fallback account</strong>: Set <code>cdp_fallback_username</code> in <code>config.yaml</code> (under <code>credentials</code>) to match your local admin account naming</li>
<li><strong>Excel formatting</strong>: Customize cell locations and sheet names in <code>config.yaml</code> under <code>excel</code></li>
</ul>
<p><strong>Example config.yaml Customization:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="nt">credentials</span><span class="p">:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">  </span><span class="nt">cdp_fallback_username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localadmin&quot;</span><span class="w">  </span><span class="c1"># Change from default &#39;answer&#39;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">  </span><span class="nt">cred_target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NetworkAudit/Primary&quot;</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">  </span><span class="nt">alt_creds</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NetworkAudit/Fallback&quot;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="nt">network</span><span class="p">:</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="w">  </span><span class="nt">jump_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bastion.corp.local&quot;</span><span class="w">  </span><span class="c1"># Set your default jump host</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="w">  </span><span class="nt">default_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">                 </span><span class="c1"># Increase concurrent workers</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="w">  </span><span class="nt">default_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">               </span><span class="c1"># Increase timeout for slower networks</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="nt">excel</span><span class="p">:</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="w">  </span><span class="nt">metadata_cells</span><span class="p">:</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="w">    </span><span class="nt">site_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;C5&quot;</span><span class="w">  </span><span class="c1"># Move metadata to different cells</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="w">    </span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;C6&quot;</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="learning-outcomes">üéì Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Anchor link to this section">&para;</a></h2>
<p>After studying this code, you should understand:</p>
<p>‚úÖ <strong>Modular Python packaging</strong> ‚Äî How to structure a package with <code>__main__.py</code> and proper imports<br />
‚úÖ <strong>Concurrent programming</strong> ‚Äî How thread pools and locks prevent race conditions<br />
‚úÖ <strong>SSH tunneling</strong> ‚Äî How direct-tcpip channels work and why they're safer<br />
‚úÖ <strong>Credential management</strong> ‚Äî OS-level credential stores vs. plaintext files<br />
‚úÖ <strong>TextFSM parsing</strong> ‚Äî How to extract structured data from CLI output<br />
‚úÖ <strong>Error handling</strong> ‚Äî Retry strategies and graceful degradation<br />
‚úÖ <strong>Excel automation</strong> ‚Äî Template-driven reporting with data overlay<br />
‚úÖ <strong>Network discovery</strong> ‚Äî CDP heuristics and neighbor crawling logic<br />
‚úÖ <strong>Configuration management</strong> ‚Äî YAML config with environment variable overrides<br />
‚úÖ <strong>Separation of concerns</strong> ‚Äî Single-responsibility modules for maintainability  </p>
<hr />
<h2 id="distribution-execution">üöÄ Distribution &amp; Execution<a class="headerlink" href="#distribution-execution" title="Anchor link to this section">&para;</a></h2>
<p>Consistent with the <strong>Nautomation Prime</strong> delivery model, this tool is available in multiple formats:</p>
<ul>
<li>
<p><strong>Zero-Install Portable Bundle:</strong> A self-contained package including the Python interpreter and all libraries (Netmiko, Pandas, TextFSM) for use on restricted Windows jump boxes.</p>
</li>
<li>
<p><strong>Scheduled Docker Appliance:</strong> A pre-built container designed for autonomous execution and periodic auditing.</p>
</li>
<li>
<p><strong>Installable Package:</strong> Can be installed with <code>pip install -e .</code> for development or packaged for PyPI distribution.</p>
</li>
</ul>
<hr />
<h2 id="repository-downloads">üìÅ Repository &amp; Downloads<a class="headerlink" href="#repository-downloads" title="Anchor link to this section">&para;</a></h2>
<p>Ready to audit your own network? Access the hardened source code and pre-configured templates below.</p>
<ul>
<li><strong><a href="https://github.com/Nautomation-Prime/Cisco_CDP_Network_Audit"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></span> View Full Repository</a></strong>: Access the code, TextFSM templates, and Excel master.</li>
<li><strong><a href="https://github.com/Nautomation-Prime/Cisco_CDP_Network_Audit/archive/refs/heads/main.zip"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7z"/></svg></span> Download Latest Release</a></strong>: Get a clean ZIP of the production-ready files.</li>
</ul>
<hr />
<h2 id="performance-tuning">üìà Performance Tuning<a class="headerlink" href="#performance-tuning" title="Anchor link to this section">&para;</a></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">Configuration</th>
<th style="text-align: left;">Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Fast LAN, many devices</td>
<td style="text-align: left;"><code>CDP_LIMIT=20</code>, <code>CDP_TIMEOUT=5</code></td>
<td style="text-align: left;">High concurrency, short timeouts work</td>
</tr>
<tr>
<td style="text-align: left;">Slow WAN link</td>
<td style="text-align: left;"><code>CDP_LIMIT=5</code>, <code>CDP_TIMEOUT=30</code></td>
<td style="text-align: left;">Fewer threads prevent overwhelming network; higher timeout for round-trip delay</td>
</tr>
<tr>
<td style="text-align: left;">Mixed (some LAN, some WAN)</td>
<td style="text-align: left;"><code>CDP_LIMIT=10</code>, <code>CDP_TIMEOUT=10</code></td>
<td style="text-align: left;">Balanced defaults</td>
</tr>
<tr>
<td style="text-align: left;">Device with high CPU</td>
<td style="text-align: left;"><code>CDP_LIMIT=3-5</code></td>
<td style="text-align: left;">Fewer threads prevent overwhelming device</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="next-steps">üé¨ Next Steps<a class="headerlink" href="#next-steps" title="Anchor link to this section">&para;</a></h2>
<ol>
<li><strong>Clone the repository:</strong> <code>git clone https://github.com/Nautomation-Prime/Cisco_CDP_Network_Audit</code></li>
<li><strong>Install dependencies:</strong> <code>pip install -r requirements.txt</code></li>
<li><strong>Customize config.yaml</strong> to match your environment:</li>
<li>Set <code>jump_host</code> under <code>network</code> section</li>
<li>Customize <code>cdp_fallback_username</code> under <code>credentials</code> section</li>
<li>Adjust <code>default_limit</code> and <code>default_timeout</code> under <code>network</code> section</li>
<li>Configure credential targets if different from defaults</li>
<li><strong>Read the README</strong> for installation and configuration details</li>
<li><strong>Set up credentials</strong> in Windows Credential Manager (or let the script prompt you on first run)</li>
<li><strong>Run your first discovery:</strong> <code>python -m cdp_audit</code></li>
<li><strong>Review the Excel output</strong> to understand the report format</li>
</ol>
<p>Once comfortable, customize the discovery heuristics and template for your specific topology.</p>
<p><strong>Example config.yaml for Enterprise Use:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span>
<span class="normal"><a href="#__codelineno-49-11">11</a></span>
<span class="normal"><a href="#__codelineno-49-12">12</a></span>
<span class="normal"><a href="#__codelineno-49-13">13</a></span>
<span class="normal"><a href="#__codelineno-49-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nt">network</span><span class="p">:</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">  </span><span class="nt">jump_host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bastion.corp.example.com&quot;</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">  </span><span class="nt">default_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w">        </span><span class="c1"># Faster discovery for large environments</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">  </span><span class="nt">default_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">      </span><span class="c1"># Accommodate slower WAN links</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="nt">credentials</span><span class="p">:</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="w">  </span><span class="nt">cdp_fallback_username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;svc_network&quot;</span><span class="w">  </span><span class="c1"># Enterprise service account</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="w">  </span><span class="nt">cred_target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NetworkAudit/Primary&quot;</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">  </span><span class="nt">alt_creds</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NetworkAudit/Fallback&quot;</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="nt">excel</span><span class="p">:</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="w">  </span><span class="nt">sheets</span><span class="p">:</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a><span class="w">    </span><span class="nt">audit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Network</span><span class="nv"> </span><span class="s">Audit&quot;</span><span class="w">  </span><span class="c1"># Customize sheet names</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="w">    </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DNS</span><span class="nv"> </span><span class="s">Resolution&quot;</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="license">üìã License<a class="headerlink" href="#license" title="Anchor link to this section">&para;</a></h2>
<p>GNU General Public License v3.0</p>
<h2 id="author">üë§ Author<a class="headerlink" href="#author" title="Anchor link to this section">&para;</a></h2>
<p>Christopher Davies</p>
<hr />
<blockquote>
<p><strong>Mission Statement:</strong> To empower engineers through Python-driven transparency and provide enterprises with hardened automation that eliminates error and accelerates growth.</p>
</blockquote>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 14, 2026 08:59:40 UTC">February 14, 2026</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ¬© 2026 Christopher Davies T/A Nautomation Prime ‚Äî Not affiliated with Cisco Systems, Inc.<br> Empowering Network Automation Professionals ¬∑ Built with Material for MkDocs

    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/company/nautomationprime" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Nautomation-Prime" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:nautomationprime.f3wfe@simplelogin.com" target="_blank" rel="noopener" title="Contact Nautomation Prime" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.indexes", "toc.integrate", "content.code.copy", "content.code.annotate", "content.tooltips", "search.share", "search.suggest", "search.highlight", "search.stemmer", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>